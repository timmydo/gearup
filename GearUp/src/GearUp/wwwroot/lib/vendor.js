var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){(c||!hasProp(a,e))&&(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c,d=a.length;for(b=0;d>b;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(1===b&&(".."===a[2]||".."===a[0]))break;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=c&&c.split("/"),q=p,r=x.map,s=r&&r["*"];if(a&&"."===a.charAt(0)&&(c?(q=p.slice(0,p.length-1),a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),a=q.concat(a),b(a),a=a.join("/")):0===a.indexOf("./")&&(a=a.substring(2))),d&&r&&(p||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),p)for(i=p.length;i>0;i-=1)if(f=getOwn(r,p.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName?(b.parentNode.removeChild(b),!0):void 0})}function e(a){var b=getOwn(x.paths,a);return b&&isArray(b)&&b.length>1?(b.shift(),u.require.undef(a),u.require([a]),!0):void 0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):c(a,l,e):(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(apsp.apply(B,[B.length,0].concat(globalDefQueue)),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(g){a=g}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad&&req.onResourceLoad(u,this.map,this.depMaps)),l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&i(a,"error",bind(this,this.errback))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);return e(b.id)?void 0:j(makeError("scripterror","Script error for: "+b.id,a,[b.id]))}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){return"interactive"===a.readyState?interactiveScript=a:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.11",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return b.type=a.scriptType||"text/javascript",b.charset="utf-8",b.async=!0,b},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){return head||(head=a.parentNode),dataMain=a.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(a){a.extend(a.fn,{validate:function(b){if(!this.length)return void(b&&b.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var c=a.data(this[0],"validator");return c?c:(this.attr("novalidate","novalidate"),c=new a.validator(b,this[0]),a.data(this[0],"validator",c),c.settings.onsubmit&&(this.validateDelegate(":submit","click",function(b){c.settings.submitHandler&&(c.submitButton=b.target),a(b.target).hasClass("cancel")&&(c.cancelSubmit=!0),void 0!==a(b.target).attr("formnovalidate")&&(c.cancelSubmit=!0)}),this.submit(function(b){function d(){var d;return c.settings.submitHandler?(c.submitButton&&(d=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)),c.settings.submitHandler.call(c,c.currentForm,b),c.submitButton&&d.remove(),!1):!0}return c.settings.debug&&b.preventDefault(),c.cancelSubmit?(c.cancelSubmit=!1,d()):c.form()?c.pendingRequest?(c.formSubmitted=!0,!1):d():(c.focusInvalid(),!1)})),c)},valid:function(){if(a(this[0]).is("form"))return this.validate().form();var b=!0,c=a(this[0].form).validate();return this.each(function(){b=b&&c.element(this)}),b},removeAttrs:function(b){var c={},d=this;return a.each(b.split(/\s/),function(a,b){c[b]=d.attr(b),d.removeAttr(b)}),c},rules:function(b,c){var d=this[0];if(b){var e=a.data(d.form,"validator").settings,f=e.rules,g=a.validator.staticRules(d);switch(b){case"add":a.extend(g,a.validator.normalizeRule(c)),delete g.messages,f[d.name]=g,c.messages&&(e.messages[d.name]=a.extend(e.messages[d.name],c.messages));break;case"remove":if(!c)return delete f[d.name],g;var h={};return a.each(c.split(/\s/),function(a,b){h[b]=g[b],delete g[b]}),h}}var i=a.validator.normalizeRules(a.extend({},a.validator.classRules(d),a.validator.attributeRules(d),a.validator.dataRules(d),a.validator.staticRules(d)),d);if(i.required){var j=i.required;delete i.required,i=a.extend({required:j},i)}return i}}),a.extend(a.expr[":"],{blank:function(b){return!a.trim(""+a(b).val())},filled:function(b){return!!a.trim(""+a(b).val())},unchecked:function(b){return!a(b).prop("checked")}}),a.validator=function(b,c){this.settings=a.extend(!0,{},a.validator.defaults,b),this.currentForm=c,this.init()},a.validator.format=function(b,c){return 1===arguments.length?function(){var c=a.makeArray(arguments);return c.unshift(b),a.validator.format.apply(this,c)}:(arguments.length>2&&c.constructor!==Array&&(c=a.makeArray(arguments).slice(1)),c.constructor!==Array&&(c=[c]),a.each(c,function(a,c){b=b.replace(new RegExp("\\{"+a+"\\}","g"),function(){return c})}),b)},a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(a){this.lastActive=a,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(a)).hide())},onfocusout:function(a){this.checkable(a)||!(a.name in this.submitted)&&this.optional(a)||this.element(a)},onkeyup:function(a,b){(9!==b.which||""!==this.elementValue(a))&&(a.name in this.submitted||a===this.lastElement)&&this.element(a)},onclick:function(a){a.name in this.submitted?this.element(a):a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).addClass(c).removeClass(d):a(b).addClass(c).removeClass(d)},unhighlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).removeClass(c).addClass(d)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function b(b){var c=a.data(this[0].form,"validator"),d="on"+b.type.replace(/^validate/,"");c.settings[d]&&c.settings[d].call(c,this[0],b)}this.labelContainer=a(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm),this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var c=this.groups={};a.each(this.settings.groups,function(b,d){"string"==typeof d&&(d=d.split(/\s/)),a.each(d,function(a,d){c[d]=b})});var d=this.settings.rules;a.each(d,function(b,c){d[b]=a.validator.normalizeRule(c)}),a(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",b).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",b),this.settings.invalidHandler&&a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),a.extend(this.submitted,this.errorMap),this.invalid=a.extend({},this.errorMap),this.valid()||a(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(b){b=this.validationTargetFor(this.clean(b)),this.lastElement=b,this.prepareElement(b),this.currentElements=a(b);var c=this.check(b)!==!1;return c?delete this.invalid[b.name]:this.invalid[b.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),c},showErrors:function(b){if(b){a.extend(this.errorMap,b),this.errorList=[];for(var c in b)this.errorList.push({message:b[c],element:this.findByName(c)[0]});this.successList=a.grep(this.successList,function(a){return!(a.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){a.fn.resetForm&&a(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b=0;for(var c in a)b++;return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}},findLastActive:function(){var b=this.lastActive;return b&&1===a.grep(this.errorList,function(a){return a.element.name===b.name}).length&&b},elements:function(){var b=this,c={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&b.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in c||!b.objectLength(a(this).rules())?!1:(c[this.name]=!0,!0)})},clean:function(b){return a(b)[0]},errors:function(){var b=this.settings.errorClass.replace(" ",".");return a(this.settings.errorElement+"."+b,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=a([]),this.toHide=a([]),this.currentElements=a([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset(),this.toHide=this.errorsFor(a)},elementValue:function(b){var c=a(b).attr("type"),d=a(b).val();return"radio"===c||"checkbox"===c?a("input[name='"+a(b).attr("name")+"']:checked").val():"string"==typeof d?d.replace(/\r/g,""):d},check:function(b){b=this.validationTargetFor(this.clean(b));var c,d=a(b).rules(),e=!1,f=this.elementValue(b);for(var g in d){var h={method:g,parameters:d[g]};try{if(c=a.validator.methods[g].call(this,f,b,h.parameters),"dependency-mismatch"===c){e=!0;continue}if(e=!1,"pending"===c)return void(this.toHide=this.toHide.not(this.errorsFor(b)));if(!c)return this.formatAndAdd(b,h),!1}catch(i){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+b.id+", check the '"+h.method+"' method.",i),i}}return e?void 0:(this.objectLength(d)&&this.successList.push(b),!0)},customDataMessage:function(b,c){return a(b).data("msg-"+c.toLowerCase())||b.attributes&&a(b).attr("data-msg-"+c.toLowerCase())},customMessage:function(a,b){var c=this.settings.messages[a];return c&&(c.constructor===String?c:c[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a];return void 0},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customDataMessage(b,c),!this.settings.ignoreTitle&&b.title||void 0,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(b,c){var d=this.defaultMessage(b,c.method),e=/\$?\{(\d+)\}/g;"function"==typeof d?d=d.call(this,c.parameters,b):e.test(d)&&(d=a.validator.format(d.replace(e,"{$1}"),c.parameters)),this.errorList.push({message:d,element:b}),this.errorMap[b.name]=d,this.submitted[b.name]=d},addWrapper:function(a){return this.settings.wrapper&&(a=a.add(a.parent(this.settings.wrapper))),a},defaultShowErrors:function(){var a,b;for(a=0;this.errorList[a];a++){var c=this.errorList[a];this.settings.highlight&&this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass),this.showLabel(c.element,c.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight)for(a=0,b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,c){var d=this.errorsFor(b);d.length?(d.removeClass(this.settings.validClass).addClass(this.settings.errorClass),d.html(c)):(d=a("<"+this.settings.errorElement+">").attr("for",this.idOrName(b)).addClass(this.settings.errorClass).html(c||""),this.settings.wrapper&&(d=d.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(d).length||(this.settings.errorPlacement?this.settings.errorPlacement(d,a(b)):d.insertAfter(b))),!c&&this.settings.success&&(d.text(""),"string"==typeof this.settings.success?d.addClass(this.settings.success):this.settings.success(d,b)),this.toShow=this.toShow.add(d)},errorsFor:function(b){var c=this.idOrName(b);return this.errors().filter(function(){return a(this).attr("for")===c})},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(a){return this.checkable(a)&&(a=this.findByName(a.name).not(this.settings.ignore)[0]),a},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(b){return a(this.currentForm).find("[name='"+b+"']")},getLength:function(b,c){switch(c.nodeName.toLowerCase()){case"select":return a("option:selected",c).length;case"input":if(this.checkable(c))return this.findByName(c.name).filter(":checked").length}return b.length},depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):!0},dependTypes:{"boolean":function(a){return a},string:function(b,c){return!!a(b,c.form).length},"function":function(a,b){return a(b)}},optional:function(b){var c=this.elementValue(b);return!a.validator.methods.required.call(this,c,b)&&"dependency-mismatch"},startRequest:function(a){this.pending[a.name]||(this.pendingRequest++,this.pending[a.name]=!0)},stopRequest:function(b,c){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[b.name],c&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(a(this.currentForm).submit(),this.formSubmitted=!1):!c&&0===this.pendingRequest&&this.formSubmitted&&(a(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:!0,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(b,c){b.constructor===String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(b){var c={},d=a(b).attr("class");return d&&a.each(d.split(" "),function(){this in a.validator.classRuleSettings&&a.extend(c,a.validator.classRuleSettings[this])}),c},attributeRules:function(b){var c={},d=a(b),e=d[0].getAttribute("type");for(var f in a.validator.methods){var g;"required"===f?(g=d.get(0).getAttribute(f),""===g&&(g=!0),g=!!g):g=d.attr(f),/min|max/.test(f)&&(null===e||/number|range|text/.test(e))&&(g=Number(g)),g?c[f]=g:e===f&&"range"!==e&&(c[f]=!0)}return c.maxlength&&/-1|2147483647|524288/.test(c.maxlength)&&delete c.maxlength,c},dataRules:function(b){var c,d,e={},f=a(b);for(c in a.validator.methods)d=f.data("rule-"+c.toLowerCase()),void 0!==d&&(e[c]=d);return e},staticRules:function(b){var c={},d=a.data(b.form,"validator");return d.settings.rules&&(c=a.validator.normalizeRule(d.settings.rules[b.name])||{}),c},normalizeRules:function(b,c){return a.each(b,function(d,e){if(e===!1)return void delete b[d];if(e.param||e.depends){var f=!0;switch(typeof e.depends){case"string":f=!!a(e.depends,c.form).length;break;case"function":f=e.depends.call(c,c)}f?b[d]=void 0!==e.param?e.param:!0:delete b[d]}}),a.each(b,function(d,e){b[d]=a.isFunction(e)?e(c):e}),a.each(["minlength","maxlength"],function(){b[this]&&(b[this]=Number(b[this]))}),a.each(["rangelength","range"],function(){var c;b[this]&&(a.isArray(b[this])?b[this]=[Number(b[this][0]),Number(b[this][1])]:"string"==typeof b[this]&&(c=b[this].split(/[\s,]+/),b[this]=[Number(c[0]),Number(c[1])]))
}),a.validator.autoCreateRanges&&(b.min&&b.max&&(b.range=[b.min,b.max],delete b.min,delete b.max),b.minlength&&b.maxlength&&(b.rangelength=[b.minlength,b.maxlength],delete b.minlength,delete b.maxlength)),b},normalizeRule:function(b){if("string"==typeof b){var c={};a.each(b.split(/\s/),function(){c[this]=!0}),b=c}return b},addMethod:function(b,c,d){a.validator.methods[b]=c,a.validator.messages[b]=void 0!==d?d:a.validator.messages[b],c.length<3&&a.validator.addClassRules(b,a.validator.normalizeRule(b))},methods:{required:function(b,c,d){if(!this.depend(d,c))return"dependency-mismatch";if("select"===c.nodeName.toLowerCase()){var e=a(c).val();return e&&e.length>0}return this.checkable(c)?this.getLength(b,c)>0:a.trim(b).length>0},email:function(a,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},url:function(a,b){return this.optional(b)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a).toString())},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9 \-]+/.test(a))return!1;var c=0,d=0,e=!1;a=a.replace(/\D/g,"");for(var f=a.length-1;f>=0;f--){var g=a.charAt(f);d=parseInt(g,10),e&&(d*=2)>9&&(d-=9),c+=d,e=!e}return c%10===0},minlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||e>=d},maxlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||d>=e},rangelength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||e>=d[0]&&e<=d[1]},min:function(a,b,c){return this.optional(b)||a>=c},max:function(a,b,c){return this.optional(b)||c>=a},range:function(a,b,c){return this.optional(b)||a>=c[0]&&a<=c[1]},equalTo:function(b,c,d){var e=a(d);return this.settings.onfocusout&&e.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(c).valid()}),b===e.val()},remote:function(b,c,d){if(this.optional(c))return"dependency-mismatch";var e=this.previousValue(c);if(this.settings.messages[c.name]||(this.settings.messages[c.name]={}),e.originalMessage=this.settings.messages[c.name].remote,this.settings.messages[c.name].remote=e.message,d="string"==typeof d&&{url:d}||d,e.old===b)return e.valid;e.old=b;var f=this;this.startRequest(c);var g={};return g[c.name]=b,a.ajax(a.extend(!0,{url:d,mode:"abort",port:"validate"+c.name,dataType:"json",data:g,success:function(d){f.settings.messages[c.name].remote=e.originalMessage;var g=d===!0||"true"===d;if(g){var h=f.formSubmitted;f.prepareElement(c),f.formSubmitted=h,f.successList.push(c),delete f.invalid[c.name],f.showErrors()}else{var i={},j=d||f.defaultMessage(c,"remote");i[c.name]=e.message=a.isFunction(j)?j(b):j,f.invalid[c.name]=!0,f.showErrors(i)}e.valid=g,f.stopRequest(c,g)}},d)),"pending"}}}),a.format=a.validator.format}(jQuery),function(a){var b={};if(a.ajaxPrefilter)a.ajaxPrefilter(function(a,c,d){var e=a.port;"abort"===a.mode&&(b[e]&&b[e].abort(),b[e]=d)});else{var c=a.ajax;a.ajax=function(d){var e=("mode"in d?d:a.ajaxSettings).mode,f=("port"in d?d:a.ajaxSettings).port;return"abort"===e?(b[f]&&b[f].abort(),b[f]=c.apply(this,arguments),b[f]):c.apply(this,arguments)}}}(jQuery),function(a){a.extend(a.fn,{validateDelegate:function(b,c,d){return this.bind(c,function(c){var e=a(c.target);return e.is(b)?d.apply(e,arguments):void 0})}})}(jQuery),function(a){function b(a,b,c){a.rules[b]=c,a.message&&(a.messages[b]=a.message)}function c(a){return a.replace(/^\s+|\s+$/g,"").split(/\s*,\s*/g)}function d(a){return a.replace(/([!"#$%&'()*+,./:;<=>?@\[\\\]^`{|}~])/g,"\\$1")}function e(a){return a.substr(0,a.lastIndexOf(".")+1)}function f(a,b){return 0===a.indexOf("*.")&&(a=a.replace("*.",b)),a}function g(b,c){var e=a(this).find("[data-valmsg-for='"+d(c[0].name)+"']"),f=e.attr("data-valmsg-replace"),g=f?a.parseJSON(f)!==!1:null;e.removeClass("field-validation-valid").addClass("field-validation-error"),b.data("unobtrusiveContainer",e),g?(e.empty(),b.removeClass("input-validation-error").appendTo(e)):b.hide()}function h(b,c){var d=a(this).find("[data-valmsg-summary=true]"),e=d.find("ul");e&&e.length&&c.errorList.length&&(e.empty(),d.addClass("validation-summary-errors").removeClass("validation-summary-valid"),a.each(c.errorList,function(){a("<li />").html(this.message).appendTo(e)}))}function i(b){var c=b.data("unobtrusiveContainer"),d=c.attr("data-valmsg-replace"),e=d?a.parseJSON(d):null;c&&(c.addClass("field-validation-valid").removeClass("field-validation-error"),b.removeData("unobtrusiveContainer"),e&&c.empty())}function j(){var b=a(this);b.data("validator").resetForm(),b.find(".validation-summary-errors").addClass("validation-summary-valid").removeClass("validation-summary-errors"),b.find(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error").removeData("unobtrusiveContainer").find(">*").removeData("unobtrusiveContainer")}function k(b){var c=a(b),d=c.data(n),e=a.proxy(j,b),f=m.unobtrusive.options||{},k=function(c,d){var e=f[c];e&&a.isFunction(e)&&e.apply(b,d)};return d||(d={options:{errorClass:f.errorClass||"input-validation-error",errorElement:f.errorElement||"span",errorPlacement:function(){g.apply(b,arguments),k("errorPlacement",arguments)},invalidHandler:function(){h.apply(b,arguments),k("invalidHandler",arguments)},messages:{},rules:{},success:function(){i.apply(b,arguments),k("success",arguments)}},attachValidation:function(){c.off("reset."+n,e).on("reset."+n,e).validate(this.options)},validate:function(){return c.validate(),c.valid()}},c.data(n,d)),d}var l,m=a.validator,n="unobtrusiveValidation";m.unobtrusive={adapters:[],parseElement:function(b,c){var d,e,f,g=a(b),h=g.parents("form")[0];h&&(d=k(h),d.options.rules[b.name]=e={},d.options.messages[b.name]=f={},a.each(this.adapters,function(){var c="data-val-"+this.name,d=g.attr(c),i={};void 0!==d&&(c+="-",a.each(this.params,function(){i[this]=g.attr(c+this)}),this.adapt({element:b,form:h,message:d,params:i,rules:e,messages:f}))}),a.extend(e,{__dummy__:!0}),!c&&d.attachValidation())},parse:function(b){var c=a(b),d=c.parents().addBack().filter("form").add(c.find("form")).has("[data-val=true]");c.find("[data-val=true]").each(function(){m.unobtrusive.parseElement(this,!0)}),d.each(function(){var a=k(this);a&&a.attachValidation()})}},l=m.unobtrusive.adapters,l.add=function(a,b,c){return c||(c=b,b=[]),this.push({name:a,params:b,adapt:c}),this},l.addBool=function(a,c){return this.add(a,function(d){b(d,c||a,!0)})},l.addMinMax=function(a,c,d,e,f,g){return this.add(a,[f||"min",g||"max"],function(a){var f=a.params.min,g=a.params.max;f&&g?b(a,e,[f,g]):f?b(a,c,f):g&&b(a,d,g)})},l.addSingleVal=function(a,c,d){return this.add(a,[c||"val"],function(e){b(e,d||a,e.params[c])})},m.addMethod("__dummy__",function(){return!0}),m.addMethod("regex",function(a,b,c){var d;return this.optional(b)?!0:(d=new RegExp(c).exec(a),d&&0===d.index&&d[0].length===a.length)}),m.addMethod("nonalphamin",function(a,b,c){var d;return c&&(d=a.match(/\W/g),d=d&&d.length>=c),d}),m.methods.extension?(l.addSingleVal("accept","mimtype"),l.addSingleVal("extension","extension")):l.addSingleVal("extension","extension","accept"),l.addSingleVal("regex","pattern"),l.addBool("creditcard").addBool("date").addBool("digits").addBool("email").addBool("number").addBool("url"),l.addMinMax("length","minlength","maxlength","rangelength").addMinMax("range","min","max","range"),l.addMinMax("minlength","minlength").addMinMax("maxlength","minlength","maxlength"),l.add("equalto",["other"],function(c){var g=e(c.element.name),h=c.params.other,i=f(h,g),j=a(c.form).find(":input").filter("[name='"+d(i)+"']")[0];b(c,"equalTo",j)}),l.add("required",function(a){("INPUT"!==a.element.tagName.toUpperCase()||"CHECKBOX"!==a.element.type.toUpperCase())&&b(a,"required",!0)}),l.add("remote",["url","type","additionalfields"],function(g){var h={url:g.params.url,type:g.params.type||"GET",data:{}},i=e(g.element.name);a.each(c(g.params.additionalfields||g.element.name),function(b,c){var e=f(c,i);h.data[e]=function(){return a(g.form).find(":input").filter("[name='"+d(e)+"']").val()}}),b(g,"remote",h)}),l.add("password",["min","nonalphamin","regex"],function(a){a.params.min&&b(a,"minlength",a.params.min),a.params.nonalphamin&&b(a,"nonalphamin",a.params.nonalphamin),a.params.regex&&b(a,"regex",a.params.regex)}),a(function(){m.unobtrusive.parse(document)})}(jQuery),function(a,b){var c=function(){return b(a)};"object"==typeof exports&&"object"==typeof module?module.exports=c():"function"==typeof define&&define.amd?define(c):breeze=c()}(this,function(a){"use strict";function b(a,b){for(var c in a)eb(a,c)&&b(c,a[c])}function c(a,b){var c=[];for(var d in a)if(eb(a,d)){var e=b?b(d,a[d]):a[d];void 0!==e&&c.push(e)}return c}function d(a,b){for(var c in a)if(eb(a,c)){var d=a[c];if(b(c,d))return{key:c,value:d}}return null}function e(a,b){var c=f(a,b);return null==c?!0:!(!c.writable&&!c.set)}function f(a,b){if(!gb)return null;if(a.hasOwnProperty(b))return Object.getOwnPropertyDescriptor(a,b);var c=Object.getPrototypeOf(a);return null==c?null:f(c,b)}function g(a,b){return function(c){return c[a]===b}}function h(a){return function(b){return b[a]}}function i(a){var b=[];for(var c in a)eb(a,c)&&b.push(a[c]);return b}function j(a,b,c){if(!b)return a;if(c)c.forEach(function(c){a[c]=b[c]});else for(var d in b)eb(b,d)&&(a[d]=b[d]);return a}function k(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c]);return a}function l(a,b){return b.defaultInstance=k(new b(a),b.defaultInstance),a}function m(a,b,c){c=c||{};for(var d in b){var e=d.split(","),f=b[d];e.some(function(b){if(!(b in a))return!1;var d=a[b];return"function"==typeof d?!1:d==f?!0:Array.isArray(d)&&0===d.length?!0:("function"==typeof f?d=f(d):"object"==typeof d&&d&&d.parentEnum&&(d=d.name),void 0===d?!0:(c[e[0]]=d,!0))})}return c}function n(a,b){if(a!==Object(a))return a;if(a._$visited)return void 0;if(a.toJSON){var c=a.toJSON();if(c!==Object(c))return c;if(c!==a)return n(c);a=c}a._$visited=!0;var d;if(a instanceof Array)d=a.map(function(a){return n(a,b)});else if("function"==typeof a)d=void 0;else{d={};for(var e in a)if("_$visited"!==e){var f=a[e];b&&(f=b(e,f),void 0===f)||(f=n(f),void 0!==f&&(d[e]=f))}}return delete a._$visited,d}function o(a,b){var c={},d=a.length;return b.forEach(function(b){for(var e=0;d>e;e++){var f=a[e];if(f){var g=f[b];if(void 0!==g){c[b]=g;break}}}}),c}function p(a){return null==a?[]:Array.isArray(a)?a:[a]}function q(a,b,c){if(c=null==c?!0:c,null==a)return a;var d;return Array.isArray(a)?(d=[],a.forEach(function(a,e){var f=b(a,e);(null!=f||c)&&(d[e]=f)})):d=b(a),d}function r(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return a[c];return null}function s(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return c;return-1}function t(a,b){var c=a.indexOf(b);-1===c&&a.push(b)}function u(a,b,c){for(var d=K(b)?b:void 0,e=a.length-1,f=!1,g=e;g>=0;g--)if((d?d(a[g]):a[g]===b)&&(a.splice(g,1),f=!0,!c))return!0;return f}function v(a,b,c){for(var d=[],e=Math.min(a.length,b.length),f=0;e>f;++f)d.push(c(a[f],b[f]));return d}function w(a,b,c){if(!a||!b)return!1;if(a.length!==b.length)return!1;for(var d=0;d<a.length;d++)if(Array.isArray(a[d])){if(!w(a[d],b[d]))return!1}else if(c){if(!c(a[d],b[d]))return!1}else if(a[d]!==b[d])return!1;return!0}function x(a,b){var c=a[b];return c||(c=[],a[b]=c),c}function y(a,b){for(var c=a.split(";"),d=0,e=c.length;e>d;d++){var f=z(c[d]);if(f)return f}if(b)throw new Error("Unable to initialize "+a+".  "+b)}function z(b){var c=a.window;if(c){var d=c[b];if(d)return d;var e=c.require;if(e){if(e.defined)return e.defined(b)?e(b):void 0;try{return e(b)}catch(f){return}}}}function A(a,b,c,d){var e=a[b];if(c===e)return d();a[b]=c;try{return d()}finally{void 0===e?delete a[b]:a[b]=e}}function B(a,b,c){var d;try{return d=a(),c()}catch(e){throw"object"==typeof d&&(d.error=e),e}finally{b(d)}}function C(a){return function(){for(var b=fb(arguments),c="",d=b.length,e=null;d--;)e=b[d],c+=e===Object(e)?JSON.stringify(e):e,a.memoize||(a.memoize={});return c in a.memoize?a.memoize[c]:a.memoize[c]=a.apply(this,b)}}function D(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function E(a){if("string"!=typeof a)throw new Error("Invalid ISO8601 duration '"+a+"'");var b=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(a);if(!b)throw new Error("Invalid ISO8601 duration '"+a+"'");for(var c=[2,3,4,6,7,8],d=[31104e3,2592e3,86400,3600,60,1],e=0,f=0;6>f;f++){var g=b[c[f]];g=g?+g.replace(/[A-Za-z]+/g,""):0,e+=g*d[f]}return e}function F(){}function G(a){return a}function H(a){return null===a?"null":void 0===a?"undefined":Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function I(a){return"date"===H(a)&&!isNaN(a.getTime())}function J(a){var b=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/;return"string"==typeof a&&b.test(a)}function K(a){return"function"===H(a)}function L(a){return"string"==typeof a}function M(a){return"object"==typeof a}function N(a){return"string"==typeof a&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(a)}function O(a){return"string"==typeof a&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(a)}function P(a){if(null===a||void 0===a)return!0;for(var b in a)if(eb(a,b))return!1;return!0}function Q(a){return!isNaN(parseFloat(a))&&isFinite(a)}function R(a,b){return a?""==b||null==b?!0:0===a.indexOf(b,0):!1}function S(a,b){return a?""==b||null==b?!0:-1!==a.indexOf(b,a.length-b.length):!1}function T(a){var b=arguments,c=RegExp("%([1-"+(arguments.length-1)+"])","g");return a.replace(c,function(a,c){return b[c]})}function U(a){var b=Function.call;return function(){return b.apply(a,arguments)}}function V(a,b,c){void 0===b&&(b=null);var d=c(),e=a.dataType;if(e&&e.parse&&(b=Array.isArray(b)&&!a.isScalar?b.map(function(a){return e.parse(a,typeof a)}):e.parse(b,typeof b)),!(b===d||e&&e.isDate&&b&&d&&b.valueOf()===d.valueOf())){var f,g=this.entityAspect;if(g)f=a.name;else{var h=this.complexAspect;if(!h)return void c(b);g=h.getEntityAspect(),f=h.getPropertyPath(a.name)}var i=g._inProcess=g._inProcess||[];if(!(i.indexOf(a)>=0)){i.push(a);try{var j={parent:this,property:a,newValue:b,oldValue:d,propertyName:f,entityAspect:g};a.isComplexProperty?X(j,c):a.isDataProperty?W(j,c):Y(j,c),Z(j)}finally{i.pop()}}}}function W(a,b){var c=a.parent,d=a.property,e=a.entityAspect,f=a.oldValue,g=a.newValue,h=e.entityManager,i=c.entityType;if(!d.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(e.entityState.isUnchangedOrModified()){var j=d.name,k=c.entityAspect||c.complexAspect;void 0===k.originalValues[j]&&(k.originalValues[j]=void 0!==f?f:d.defaultValue)}if(d.isPartOfKey&&h&&!h.isLoading){var l=i.keyProperties,m=l.map(function(a){return a===d?g:c.getProperty(a.name)}),n=new xb(i,m);if(h.findEntityByKey(n))throw new Error("An entity with this key is already in the cache: "+n.toString());var o=c.entityAspect.getKey(),p=h._findEntityGroup(i);p._replaceKey(o,n)}var q=d.relatedNavigationProperty;if(q&&h)if(null!=g){var r=new xb(q.entityType,[g]),s=h.findEntityByKey(r);s?c.setProperty(q.name,s):(h._unattachedChildrenMap.addChild(r,q,c),c.setProperty(q.name,null))}else c.setProperty(q.name,null);else if(d.inverseNavigationProperty&&h&&!h._inKeyFixup){var t=d.inverseNavigationProperty;if(null!=f&&(r=new xb(t.parentType,[f]),s=h.findEntityByKey(r)))if(t.isScalar)s.setProperty(t.name,null);else{var u=s.getProperty(t.name);u.splice(u.indexOf(c),1)}null!=g&&(r=new xb(t.parentType,[g]),s=h.findEntityByKey(r),s?t.isScalar?s.setProperty(t.name,c):s.getProperty(t.name).push(c):h._unattachedChildrenMap.addChild(r,t,c))}if(b(g),$(a),d.isPartOfKey){var v=i.keyProperties.indexOf(d);i.navigationProperties.forEach(function(a){var b=a.inverse,d=b?b.foreignKeyNames:a.invForeignKeyNames;if(0!==d.length){var e=c.getProperty(a.name),f=d[v];if(a.isScalar){if(!e)return;e.setProperty(f,g)}else e.forEach(function(a){a.setProperty(f,g)})}}),h&&i.inverseForeignKeyProperties.forEach(function(a){null==a.relatedNavigationProperty.inverse&&h._updateFkVal(a,f,g)}),e.getKey(!0)}}function X(a,b){var c=a.property,d=a.oldValue,e=a.newValue,f=c.dataType;if(!c.isScalar)throw new Error(T("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",c.name,c.parentType.name));if(!e)throw new Error(T("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",c.name,c.dataType.name));if(!d){var g=f.getCtor();d=new g,b(d)}f.dataProperties.forEach(function(a){var b=a.name,c=e.getProperty(b);d.setProperty(b,c)})}function Y(a,b){var c=a.parent,d=a.property,e=a.entityAspect,f=a.oldValue,g=a.newValue;if(!d.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");var h=e.entityManager,i=d.inverse;if(null!=g){var j=g.entityAspect;if(h){if(j.entityState.isDetached())h.isLoading||h.attachEntity(g,yb.Added);else if(j.entityManager!==h)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}else j&&j.entityManager&&(h=j.entityManager,h.isLoading||h.attachEntity(e.entity,yb.Added))}if(i)if(i.isScalar)null!=f&&f.setProperty(i.name,null),null!=g&&g.setProperty(i.name,c);else{if(null!=f){var k=f.getProperty(i.name),l=k.indexOf(c);-1!==l&&k.splice(l,1)}if(null!=g){var m=g.getProperty(i.name);m.push(c)}}else if(d.invForeignKeyNames&&h&&!h._inKeyFixup){var n=d.invForeignKeyNames;if(null!=g){var o=c.entityAspect.getKey().values;n.forEach(function(a,b){g.setProperty(a,o[b])})}else null!=f&&n.forEach(function(a){var b=f.entityType.getProperty(a);b.isPartOfKey||f.setProperty(a,null)})}if(b(g),$(a),d.relatedDataProperties){var p=e.entityState;if(null==g&&(p.isDetached()||f.entityAspect.entityState.isDetached()))return;if(p.isDeleted())return;var q=d.entityType.keyProperties;q.forEach(function(a,b){var e=d.relatedDataProperties[b];if(g||!e.isPartOfKey){var f=g?g.getProperty(a.name):e.defaultValue;c.setProperty(e.name,f)}})}}function Z(a){var b=a.entityAspect,c=b.entityManager,d=b.entity,e={entity:d,parent:a.parent,property:a.property,propertyName:a.propertyName,oldValue:a.oldValue,newValue:a.newValue};c?c.isLoading||c.isRejectingChanges||(b.propertyChanged.publish(e),c.entityChanged.publish({entityAction:ub.PropertyChange,entity:d,args:e})):b.propertyChanged.publish(e)}function $(a){var b=a.entityAspect,c=b.entityManager;if(null!=c&&!c.isLoading){var d=a.property;b.entityState.isUnchanged()&&!d.isUnmapped&&b.setModified(),c.validationOptions.validateOnPropertyChange&&b._validateProperty(a.newValue,{entity:b.entity,property:d,propertyName:a.propertyName,oldValue:a.oldValue})}}function _(a){return a.indexOf(":#")>=0}function ab(a,b){return a+":#"+b}function bb(a,b,c){if(b)if(Array.isArray(b))b.forEach(a._addPropertyCore.bind(a));else{if("object"!=typeof b)throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(var d in b)if(eb(b,d)){var e=b[d];e.name=d;var f=new c(e);a._addPropertyCore(f)}}}function cb(a,b){var c=Array.isArray(b)?b:b.split(".");if(1===c.length)return a.getProperty(b);var d=a;return c.some(function(a){return d=d.getProperty(a),null==d}),d}var db={version:"1.5.2",metadataVersion:"1.0.5"},eb=U(Object.prototype.hasOwnProperty),fb=U(Array.prototype.slice),gb=function(){try{return!!Object.getPrototypeOf&&Object.defineProperty({},"x",{})}catch(a){return!1}}();Object.create||(Object.create=function(a){var b=function(){};return b.prototype=a,new b});var hb={};hb.__isES5Supported=gb,hb.objectForEach=b,hb.extend=j,hb.propEq=g,hb.pluck=h,hb.arrayEquals=w,hb.arrayFirst=r,hb.arrayIndexOf=s,hb.arrayRemoveItem=u,hb.arrayZip=v,hb.requireLib=y,hb.using=A,hb.memoize=C,hb.getUuid=D,hb.durationToSeconds=E,hb.isDate=I,hb.isGuid=N,hb.isDuration=O,hb.isFunction=K,hb.isEmpty=P,hb.isNumeric=Q,hb.stringStartsWith=R,hb.stringEndsWith=S,hb.formatString=T,hb.getPropertyDescriptor=f,hb.toJSONSafe=n,hb.parent=db,db.core=hb;var ib=function(){function a(a,b){return null==b?!1:"string"==typeof b&&b.length>0}function b(a,b){return null==b?!1:typeof b===a.typeName?!0:!1}function c(a,b){return null==b?!1:b instanceof a.type}function d(a,b){return null==b?!1:void 0!==b[a.propertyName]}function e(a,b){return null==b?!1:a.enumType.contains(b)}function f(a,b){return a.allowNull?void 0!==b:null!=b}function g(a,b){if(null==b)return!0;var c=a.prevContext;return c?c.fn(c,b):!0}function h(a,b){var c=a.prevContext,d=c?" or it "+l(c,b):"";return"is optional"+d}function i(a,b){if(!Array.isArray(b))return!1;if(a.mustNotBeEmpty&&0===b.length)return!1;var c=a.prevContext;return c?b.every(function(a){return c.fn(c,a)}):!0}function k(a,b){var c=a.mustNotBeEmpty?"a nonEmpty array":"an array",d=a.prevContext,e=d?" where each element "+l(d,b):"";return" must be "+c+e}function l(a,b){var c=a.msg;return"function"==typeof c&&(c=c(a,b)),c}function m(a,b){if(a._context){for(var c=a._context;null!=c.prevContext;)c=c.prevContext;if(null===c.prevContext)return c.prevContext=b,a;if(null!=b.prevContext)throw new Error("Illegal construction - use 'or' to combine checks");b.prevContext=a._context}return n(a,b)}function n(a,b){return a._contexts[a._contexts.length-1]=b,a._context=b,a}function o(a){var b=a._contexts;return null==b[b.length-1]&&b.pop(),0===b.length?void 0:b.some(function(b){return b.fn(b,a.v)})}function p(a,b){throw new Error(T("Error configuring an instance of '%1'. %2",a&&a._$typeName||"object",b))}var q=function(a,b){this.v=a,this.name=b,this._contexts=[null]},r=q.prototype;return r.isObject=function(){return this.isTypeOf("object")},r.isBoolean=function(){return this.isTypeOf("boolean")},r.isString=function(){return this.isTypeOf("string")},r.isNonEmptyString=function(){return m(this,{fn:a,msg:"must be a nonEmpty string"})},r.isNumber=function(){return this.isTypeOf("number")},r.isFunction=function(){return this.isTypeOf("function")},r.isTypeOf=function(a){return m(this,{fn:b,typeName:a,msg:T("must be a '%1'",a)})},r.isInstanceOf=function(a,b){return b=b||a.prototype._$typeName,m(this,{fn:c,type:a,typeName:b,msg:T("must be an instance of '%1'",b)})},r.hasProperty=function(a){return m(this,{fn:d,propertyName:a,msg:T("must have a '%1' property ",a)})},r.isEnumOf=function(a){return m(this,{fn:e,enumType:a,msg:T("must be an instance of the '%1' enumeration",a.name)})},r.isRequired=function(a){return m(this,{fn:f,allowNull:a,msg:"is required"})},r.isOptional=function(){var a={fn:g,prevContext:null,msg:h};return m(this,a)},r.isNonEmptyArray=function(){return this.isArray(!0)},r.isArray=function(a){var b={fn:i,mustNotBeEmpty:a,prevContext:null,msg:k};return m(this,b)},r.or=function(){return this._contexts.push(null),this._context=null,this},r.check=function(a){var b=o(this);if(void 0!==b){if(!b)throw new Error(this.getMessage());return void 0!==this.v?this.v:a}},r._addContext=function(a){return m(this,a)},r.getMessage=function(){var a=this,b=this._contexts.map(function(b){return l(b,a.v)}).join(", or it ");return T(this.MESSAGE_PREFIX,this.name)+" "+b},r.withDefault=function(a){return this.defaultValue=a,this},r.whereParam=function(a){return this.parent.whereParam(a)},r.applyAll=function(a,b){var c=a._$typeName,d=c&&this.parent.config._$typeName===c,e=j({},this.parent.config);if(this.parent.params.forEach(function(c){d||delete e[c.name];try{c.check()}catch(f){p(a,f.message)}!b&&c._applyOne(a)}),!d)for(var f in e)void 0!==e[f]&&p(a,T("Unknown property: '%1'.",f))},r._applyOne=function(a){void 0!==this.v?a[this.name]=this.v:void 0!==this.defaultValue&&(a[this.name]=this.defaultValue)},r.MESSAGE_PREFIX="The '%1' parameter ",q}(),jb=function(a,b){return new ib(a,b)},kb=function(){var a=function(a){if("object"!=typeof a)throw new Error("Configuration parameter should be an object, instead it is a: "+typeof a);this.config=a,this.params=[]},b=a.prototype;return b.whereParam=function(a){var b=new ib(this.config[a],a);return b.parent=this,this.params.push(b),b},a}(),lb=function(a){return new kb(a)};hb.Param=ib,hb.assertParam=jb,hb.assertConfig=lb;var mb=function(){function a(){}var b=function(b,c){this.name=b;var d=new a(c);d.parentEnum=this,this._symbolPrototype=d,c&&Object.keys(c).forEach(function(a){d[a]=c[a]})},c=b.prototype;return b.isSymbol=function(b){return b instanceof a},c.fromName=function(a){return this[a]},c.addSymbol=function(a){var b=Object.create(this._symbolPrototype);return a&&Object.keys(a).forEach(function(c){b[c]=a[c]}),setTimeout(function(){b.getName()},0),b},c.resolveSymbols=function(){this.getSymbols().forEach(function(a){return a.getName()})},c.getSymbols=function(){return this.getNames().map(function(a){return this[a]},this)},c.getNames=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&("name"===b||"_"===b.substr(0,1)||K(this[b])||a.push(b));return a},c.contains=function(b){return b instanceof a?this[b.getName()]===b:!1},a.prototype.getName=function(){if(!this.name){var a=this;this.name=r(this.parentEnum.getNames(),function(b){return a.parentEnum[b]===a})}return this.name},a.prototype.toString=function(){return this.getName()},a.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},b}();hb.Enum=mb;var nb=function(){function a(a,c,d){var e=a._subscribers;return e?void e.forEach(function(e){try{e.callback(c)}catch(f){f.context="unable to publish on topic: "+a.name,d?d(f):a._defaultErrorCallback?a._defaultErrorCallback(f):b(f)}}):!0}function b(){}var c={},d=1,e=function(a,b,d){jb(a,"eventName").isNonEmptyString().check(),jb(b,"publisher").isObject().check(),this.name=a,c[a]=!0,this.publisher=b,d&&(this._defaultErrorCallback=d)},f=e.prototype;return f.publish=function(b,c,d){return e._isEnabled(this.name,this.publisher)?(c===!0?setTimeout(a,0,this,b,d):a(this,b,d),!0):!1},f.publishAsync=function(a,b){this.publish(a,!0,b)},f.subscribe=function(a){this._subscribers||(this._subscribers=[]);var b=d;return this._subscribers.push({unsubKey:b,callback:a}),++d,b},f.unsubscribe=function(a){if(!this._subscribers)return!1;var b=this._subscribers,c=s(b,function(b){return b.unsubKey===a});return-1!==c?(b.splice(c,1),0===b.length&&(this._subscribers=null),!0):!1},f.clear=function(){this._subscribers=null},e.bubbleEvent=function(a,b){a._getEventParent=b},e.enable=function(a,b,c){jb(a,"eventName").isNonEmptyString().check(),jb(b,"obj").isObject().check(),jb(c,"isEnabled").isBoolean().isOptional().or().isFunction().check(),b._$eventMap||(b._$eventMap={}),b._$eventMap[a]=c},e.isEnabled=function(a,b){if(jb(a,"eventName").isNonEmptyString().check(),jb(b,"obj").isObject().check(),void 0===b._getEventParent)throw new Error("This object does not support event enabling/disabling");return e._isEnabled(b,a)},e._isEnabled=function(a,b){var c=null,d=b._$eventMap;if(d&&(c=d[a]),null!=c)return"function"==typeof c?c(b):!!c;var f=b._getEventParent&&b._getEventParent();return f?e._isEnabled(a,f):!0},e}();hb.Event=nb;var ob=function(){function a(a,b,c){var d=b.defaultInstance;return d||(d=new b.ctor,b.defaultInstance=d,d._$impl=b),d.initialize(),c&&(a.defaultInstance=d),e.interfaceInitialized.publish({interfaceName:a.name,instance:d,isDefault:!0}),d.checkForRecomposition&&e.interfaceInitialized.subscribe(function(a){d.checkForRecomposition(a)}),d}function b(a){var b=a.toLowerCase(),c=d(e.interfaceRegistry||{},function(a){return a.toLowerCase()===b});if(!c)throw new Error("Unknown interface name: "+a);return c.value}var e={};e.functionRegistry={},e.typeRegistry={},e.objectRegistry={},e.interfaceInitialized=new nb("interfaceInitialized",e);var f=function(a){this.name=a,this.defaultInstance=null,this._implMap={}};return f.prototype.registerCtor=function(a,b){this._implMap[a.toLowerCase()]={ctor:b,defaultInstance:null}},f.prototype.getImpl=function(a){return this._implMap[a.toLowerCase()]},f.prototype.getFirstImpl=function(){var a=d(this._implMap,function(){return!0});return a?a.value:null},e.interfaceRegistry={ajax:new f("ajax"),modelLibrary:new f("modelLibrary"),dataService:new f("dataService"),uriBuilder:new f("uriBuilder")},e.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},e.setProperties=function(a){lb(a).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(a),a.remoteAccessImplementation&&e.initializeAdapterInstance("dataService",a.remoteAccessImplementation),a.trackingImplementation&&e.initializeAdapterInstance("modelLibrary",a.trackingImplementation),a.ajaxImplementation&&e.initializeAdapterInstance("ajax",a.ajaxImplementation)},e.registerAdapter=function(a,c){jb(a,"interfaceName").isNonEmptyString().check(),jb(c,"adapterCtor").isFunction().check();var d=new c,e=d.name;if(!e)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");var f=b(a);f.registerCtor(e,c)},e.getAdapter=function(a,c){var d=b(a);if(c){var e=d.getImpl(c);return e?e.ctor:null}return d.defaultInstance?d.defaultInstance._$impl.ctor:null
},e.initializeAdapterInstances=function(a){return lb(a).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().whereParam("uriBuilder").isOptional().applyAll(this,!1),c(a,e.initializeAdapterInstance)},e.initializeAdapterInstance=function(c,d,e){e=void 0===e?!0:e,jb(c,"interfaceName").isNonEmptyString().check(),jb(d,"adapterName").isNonEmptyString().check(),jb(e,"isDefault").isBoolean().check();var f=b(c),g=f.getImpl(d);if(!g)throw new Error("Unregistered adapter.  Interface: "+c+" AdapterName: "+d);return a(f,g,e)},e.getAdapterInstance=function(c,d){var e,f=b(c),g=null==d||""==d;if(g){if(f.defaultInstance)return f.defaultInstance;e=f.getFirstImpl()}else e=f.getImpl(d);return e?e.defaultInstance?e.defaultInstance:a(f,e,g):null},e.registerFunction=function(a,b){jb(a,"fn").isFunction().check(),jb(b,"fnName").isString().check(),a.prototype._$fnName=b,e.functionRegistry[b]=a},e.getRegisteredFunction=function(a){return e.functionRegistry[a]},e._storeObject=function(a,b,c){var d=("string"==typeof b?b:b.prototype._$typeName)+"."+c;e.objectRegistry[d]=a},e._fetchObject=function(a,b){if(!b)return void 0;var c=("string"==typeof a?a:a.prototype._$typeName)+"."+b,d=e.objectRegistry[c];if(!d)throw new Error("Unable to locate a registered object by the name: "+c);return d},e.registerType=function(a,b){jb(a,"ctor").isFunction().check(),jb(b,"typeName").isString().check(),a.prototype._$typeName=b,e.typeRegistry[b]=a},e.stringifyPad="",e}(),pb=ob.interfaceRegistry.modelLibrary;hb.config=ob,db.config=ob;var qb=function(){function a(a){var b=a.getEntityAspect();b.entityState.isUnchanged()&&b.setModified(),b.entityState.isModified()&&!a._origValues&&(a._origValues=a.slice(0))}function b(a,b){a._processAdds(b),d(a,"arrayChanged",{array:a,added:b})}function c(a,b){a._processRemoves(b),d(a,"arrayChanged",{array:a,removed:b})}function d(a,b,c){var d=a._getPendingPubs();d?a._pendingArgs?e(a._pendingArgs,c):(a._pendingArgs=c,d.push(function(){a[b].publish(a._pendingArgs),a._pendingArgs=null})):a[b].publish(c)}function e(a,b){for(var c in b)if("array"!==c&&a.hasOwnProperty(c)){var d=b[c],e=a[c];if(e){if(!Array.isArray(e))throw new Error("Cannot combine non array args");Array.prototype.push.apply(e,d)}else a[c]=d}}function f(a,b,c){a.parent=b,a.parentProperty=c}var g={};return g.push=function(){if(this._inProgress)return-1;var a=this._getGoodAdds(fb(arguments));if(!a.length)return this.length;this._beforeChange();var c=Array.prototype.push.apply(this,a);return b(this,a),c},g._push=function(){if(this._inProgress)return-1;var a=fb(arguments);this._beforeChange();var c=Array.prototype.push.apply(this,a);return b(this,a),c},g.unshift=function(){var a=this._getGoodAdds(fb(arguments));if(!a.length)return this.length;this._beforeChange();var c=Array.prototype.unshift.apply(this,a);return b(this,fb(a)),c},g.pop=function(){this._beforeChange();var a=Array.prototype.pop.apply(this);return c(this,[a]),a},g.shift=function(){this._beforeChange();var a=Array.prototype.shift.apply(this);return c(this,[a]),a},g.splice=function(){var a=this._getGoodAdds(fb(arguments,2)),d=fb(arguments,0,2).concat(a);this._beforeChange();var e=Array.prototype.splice.apply(this,d);return c(this,e),a.length&&b(this,a),e},g.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},g._getEventParent=function(){return this.getEntityAspect()},g._getPendingPubs=function(){var a=this.getEntityAspect().entityManager;return a&&a._pendingPubs},g._beforeChange=function(){},{mixin:g,publish:d,updateEntityState:a,initializeParent:f}}(),rb=function(){function a(a,b,c,d,e){for(d=+a[b=a.length-1],e=0;b--;)c=+a[b],d+=++e%2?2*c%10+(c>4):c;return!(d%10)}function c(a,b,c,d){c&&(n.messageTemplates[a]=c);var e="string"==typeof b?new RegExp(b):b,f=function(a){return null==a||""===a?!0:"string"!=typeof a?!1:e.test(a)};return new n(a,f,d)}function d(a,b,c){return b?a.replace(/%([^%]+)%/g,function(a,d){var e;return e=c?b.hasOwnProperty(d)?b[d]:"":b[d],null!=e?K(e)?e(b):e:""}):a}function e(a,b,c,d){var e=d&&d.messageTemplate||n.messageTemplates[a];return e||(n.messageTemplates[a]=T("'%displayName%' must be an integer between the values of %1 and %2",b,c)),function(){var e=function(a,d){return null==a?!0:("string"==typeof a&&d&&d.allowString&&(a=parseInt(a,0)),"number"!=typeof a||isNaN(a)||Math.floor(a)!==a?!1:null!=b&&b>a?!1:null!=c&&a>c?!1:!0)};return new n(a,e,d)}}var f=-32768,g=32767,h=-2147483648,i=2147483647,k=0,l=255,m={displayName:function(a){return a.property?a.property.resolveProperty("displayName")||a.propertyName||a.property.name:"Value"}},n=function(a,b,c){this._baseContext=c||{},this._baseContext.name=a,c=j(Object.create(m),this._baseContext),c.messageTemplate=c.messageTemplate||n.messageTemplates[a],this.name=a,this.valFn=b,this.context=c},o=n.prototype;return o._$typeName="Validator",o.validate=function(a,b){var c;c=b?j(Object.create(this.context),b):this.context,this.currentContext=c;try{return this.valFn(a,c)?null:(c.value=a,new sb(this,c,this.getMessage()))}catch(d){return new sb(this,c,"Exception occured while executing this validator: "+this.name)}},o.getMessage=function(){try{var a=this.currentContext,b=a.message;return b?"function"==typeof b?b(a):b:a.messageTemplate?d(a.messageTemplate,a):"invalid value: "+(this.name||"{unnamed validator}")}catch(c){return"Unable to format error message"+c.toString()}},o.toJSON=function(){return this._baseContext},n.fromJSON=function(a){if(Array.isArray(a))return a.map(function(a){return n.fromJSON(a)});var b="Validator."+a.name,c=ob.getRegisteredFunction(b);if(!c)throw new Error("Unable to locate a validator named:"+a.name);return c(a)},n.register=function(a){ob.registerFunction(function(){return a},"Validator."+a.name)},n.registerFactory=function(a,b){ob.registerFunction(a,"Validator."+b)},n.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},n.required=function(a){var b=function(a,b){return"string"==typeof a?b&&b.allowEmptyStrings?!0:a.length>0:null!=a};return new n("required",b,a)},n.maxLength=function(a){var b=function(a,b){return null==a?!0:"string"!=typeof a?!1:a.length<=b.maxLength};return new n("maxLength",b,a)},n.stringLength=function(a){var b=function(a,b){return null==a?!0:"string"!=typeof a?!1:null!=b.minLength&&a.length<b.minLength?!1:null!=b.maxLength&&a.length>b.maxLength?!1:!0};return new n("stringLength",b,a)},n.string=function(){var a=function(a){return null==a?!0:"string"==typeof a};return new n("string",a)},n.guid=function(){var a=function(a){return null==a?!0:N(a)};return new n("guid",a)},n.duration=function(){var a=function(a){return null==a?!0:O(a)};return new n("duration",a)},n.number=n["double"]=n.single=function(a){var b=function(a,b){return null==a?!0:("string"==typeof a&&b&&b.allowString&&(a=parseFloat(a,10)),"number"==typeof a&&!isNaN(a))};return new n("number",b,a)},n.integer=n.int64=function(a){var b=function(a,b){return null==a?!0:("string"==typeof a&&b&&b.allowString&&(a=parseInt(a,10)),"number"==typeof a&&!isNaN(a)&&Math.floor(a)===a)};return new n("integer",b,a)},n.int32=function(a){return e("int32",h,i,a)()},n.int16=function(a){return e("int16",f,g,a)()},n["byte"]=function(a){return e("byte",k,l,a)()},n.bool=function(){var a=function(a){return null==a?!0:a===!0||a===!1};return new n("bool",a)},n.none=function(){var a=function(){return!0};return new n("none",a)},n.date=function(){var a=function(a){if(null==a)return!0;if("string"!=typeof a)return I(a);try{return!isNaN(Date.parse(a))}catch(b){return!1}};return new n("date",a)},n.creditCard=function(b){function c(b){return null==b||""===b?!0:"string"!=typeof b?!1:(b=b.replace(/(\-|\s)/g,""),!b||/\D/.test(b)?!1:a(b))}return new n("creditCard",c,b)},n.regularExpression=function(a){function b(a,b){if(null==a||""===a)return!0;if("string"!=typeof a)return!1;try{var c=new RegExp(b.expression)}catch(d){throw new Error("Missing or invalid expression parameter to regExp validator")}return c.test(a)}return new n("regularExpression",b,a)},n.emailAddress=function(a){var b=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;return c("emailAddress",b,null,a)},n.phone=function(a){var b=/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/;return c("phone",b,null,a)},n.url=function(a){var b=/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;return c("url",b,null,a)},n.makeRegExpValidator=c,b(n,function(a,b){"function"==typeof b&&"fromJSON"!==a&&"register"!==a&&"registerFactory"!==a&&"makeRegExpValidator"!==a&&ob.registerFunction(b,"Validator."+a)}),n}(),sb=function(){var a=function b(a,c,d,e){jb(a,"validator").isOptional().isInstanceOf(rb).check(),jb(d,"errorMessage").isNonEmptyString().check(),jb(e,"key").isOptional().isNonEmptyString().check(),this.validator=a,c=c||{},this.context=c,this.errorMessage=d,this.property=c.property,this.propertyName=c.propertyName||c.property&&c.property.name,this.key=e?e:b.getKey(a||d,this.propertyName),this.isServerError=!1};return a.getKey=function(a,b){return(a.name||a)+(b?":"+b:"")},a}();db.Validator=rb,db.ValidationError=sb;var tb=function(){function a(a,b){return b&&lb(b).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(a),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="ValidationOptions",c.using=function(b){if(!b)return this;var c=new tb(this);return a(c,b),c},c.setAsDefault=function(){return l(this,b)},b.defaultInstance=new b({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),b}();db.ValidationOptions=tb,db.makeComplexArray=function(){function a(a,b){return b.filter(function(b){return b.parent!==a.parent})}function b(a,b){b.forEach(function(b){if(null!=b.parent)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");e(b,a)})}function c(a,b){b.forEach(function(b){d(b,a)})}function d(a,b){var c=a.complexAspect;return c.parent!==b.parent?null:(c.parent=null,c.parentProperty=null,c)}function e(a,b){var c=a.complexAspect;return c.parent===b.parent?null:(c.parent=b.parent,c.parentProperty=b.parentProperty,c)}function f(a,b,c){return qb.initializeParent(a,b,c),a.arrayChanged=new nb("arrayChanged",a),j(a,qb.mixin),j(a,g)}var g={};return g._getGoodAdds=function(b){return a(this,b)},g._beforeChange=function(){qb.updateEntityState(this)},g._processAdds=function(a){b(this,a)},g._processRemoves=function(a){c(this,a)},g._rejectChanges=function(){if(this._origValues){var a=this;this.forEach(function(b){d(b,a)}),this.length=0,this._origValues.forEach(function(b){a.push(b)})}},g._acceptChanges=function(){this._origValues=null},f}();var ub=function(){var a={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},b=new mb("EntityAction",a);return b.Attach=b.addSymbol({isAttach:!0}),b.AttachOnQuery=b.addSymbol({isAttach:!0}),b.AttachOnImport=b.addSymbol({isAttach:!0}),b.Detach=b.addSymbol({isDetach:!0}),b.MergeOnQuery=b.addSymbol({isModification:!0}),b.MergeOnImport=b.addSymbol({isModification:!0}),b.MergeOnSave=b.addSymbol({isModification:!0}),b.PropertyChange=b.addSymbol({isModification:!0}),b.EntityStateChange=b.addSymbol(),b.AcceptChanges=b.addSymbol(),b.RejectChanges=b.addSymbol({isModification:!0}),b.Clear=b.addSymbol({isDetach:!0}),b.resolveSymbols(),b}();db.EntityAction=ub;var vb=function(){function a(b){var c=b.entityAspect||b.complexAspect,d=b.entityType||b.complexType,e=c.originalValues;for(var f in e)b.setProperty(f,e[f]);d.complexProperties.forEach(function(c){var d=b.getProperty(c.name);c.isScalar?a(d):(d._rejectChanges(),d.forEach(a))})}function c(a){var b=a.entityAspect||a.complexAspect;b.originalValues={};var d=a.entityType||a.complexType;d.complexProperties.forEach(function(b){var d=a.getProperty(b.name);b.isScalar?c(d):(d._acceptChanges(),d.forEach(c))})}function d(a,b){var c=!0,e=a.entityType||a.complexType,f=a.entityAspect||a.complexAspect,h=a.entityAspect||a.complexAspect.getEntityAspect(),i={entity:h.entity};return void 0!==b&&(i.index=b),e.getProperties().forEach(function(b){var e=a.getProperty(b.name),g=b.getAllValidators();g.length>0&&(i.property=b,i.propertyName=f.getPropertyPath(b.name),c=h._validateProperty(e,i)&&c),b.isComplexProperty&&(c=b.isScalar?d(e)&&c:e.reduce(function(a,b,c){return d(b,c)&&a},c))}),e.getAllValidators().forEach(function(b){c=g(h,b,a)&&c}),c}function e(a,b){var c=b.isDeleted();c?f(a):A(a.entityAspect.entityManager,"isLoading",!0,function(){f(a)})}function f(a){a.entityType.navigationProperties.forEach(function(b){var c=b.inverse,d=a.getProperty(b.name);if(b.isScalar){if(d){if(c)if(c.isScalar)d.setProperty(c.name,null);else{var e=d.getProperty(c.name);e.length&&u(e,a)}a.setProperty(b.name,null)}}else c&&d.slice(0).forEach(function(a){c.isScalar&&a.setProperty(c.name,null)}),d.length=0})}function g(a,b,c,d){var e=b.validate(c,d);if(e)return a._addValidationError(e),!1;var f=sb.getKey(b,d?d.propertyName:null);return a._removeValidationError(f),!0}var h=function k(a){if(null===a){var b=k._nullInstance;if(b)return b;k._nullInstance=this}else{if(void 0===a)throw new Error("The EntityAspect ctor requires an entity as its only argument.");if(a.entityAspect)return a.entityAspect}if(!(this instanceof k))return new k(a);if(this.entity=a,this.entityGroup=null,this.entityManager=null,this.entityState=yb.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new nb("validationErrorsChanged",this),this.propertyChanged=new nb("propertyChanged",this),null!=a){a.entityAspect=this;var c=a.entityType||a._$entityType;if(!c){var d=a.prototype._$typeName;throw new Error(d?"Metadata for this entityType has not yet been resolved: "+d:"This entity is not registered as a valid EntityType")}var e=c.getEntityCtor();pb.getDefaultInstance().startTracking(a,e.prototype)}},j=h.prototype;return nb.bubbleEvent(j,function(){return this.entityManager}),j.getKey=function(a){if(a=jb(a,"forceRefresh").isBoolean().isOptional().check(!1),a||!this._entityKey){var b=this.entity.entityType,c=b.keyProperties,d=c.map(function(a){return this.entity.getProperty(a.name)},this);this._entityKey=new xb(b,d)}return this._entityKey},j.acceptChanges=function(){this._checkOperation("acceptChanges");var a=this.entityManager;this.entityState.isDeleted()?a.detachEntity(this.entity):this.setUnchanged(),a.entityChanged.publish({entityAction:ub.AcceptChanges,entity:this.entity})},j.rejectChanges=function(){this._checkOperation("rejectChanges");var b=this.entity,c=this.entityManager;A(c,"isRejectingChanges",!0,function(){a(b)}),this.entityState.isAdded()?(c.detachEntity(b),c._notifyStateChange(b,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(b),this.setUnchanged(),this.propertyChanged.publish({entity:b,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:ub.RejectChanges,entity:b}))},j.getPropertyPath=function(a){return a},j.setAdded=function(){return this.setEntityState(yb.Added)},j.setUnchanged=function(){return this.setEntityState(yb.Unchanged)},j.setModified=function(){return this.setEntityState(yb.Modified)},j.setDeleted=function(){return this.setEntityState(yb.Deleted)},j.setDetached=function(){return this.setEntityState(yb.Detached)},j.setEntityState=function(a){if(this.entityState===a)return!1;if(this._checkOperation("setEntityState"),this.entityState.isDetached())throw new Error("You cannot set the 'entityState' of an entity when it is detached - except by first attaching it to an EntityManager");var b=this.entity,d=this.entityManager,f=!0;if(a===yb.Unchanged)c(b),delete this.hasTempKey,f=!1;else if(a===yb.Added)c(b);else if(a===yb.Deleted){if(this.entityState.isAdded())return this.setEntityState(yb.Detached),!0;this.entityState=yb.Deleted,e(b,yb.Deleted)}else if(a===yb.Modified);else if(a===yb.Detached){var g=this.entityGroup;if(!g)return!1;g.detachEntity(b),this.entityState=a,e(b,yb.Detached),this._detach(),d.entityChanged.publish({entityAction:ub.Detach,entity:b}),f=!1}return this.entityState=a,d._notifyStateChange(b,f),!0},j.loadNavigationProperty=function(a,b,c){var d=this.entity,e=d.entityType._checkNavProperty(a),f=Ob.fromEntityNavigation(d,e),g=d.entityAspect.entityManager.executeQuery(f),h=this;return g.then(function(a){return h._markAsLoaded(e.name),b&&b(a),Cb.resolve(a)},function(a){return c&&c(a),Cb.reject(a)})},j.markNavigationPropertyAsLoaded=function(a){var b=this.entity.entityType._checkNavProperty(a);this._markAsLoaded(b.name)},j.isNavigationPropertyLoaded=function(a){var b=this.entity.entityType._checkNavProperty(a);return b.isScalar&&null!=this.entity.getProperty(b.name)?!0:this._loadedNps&&this._loadedNps.indexOf(b.name)>=0},j._markAsLoaded=function(a){this._loadedNps=this._loadedNps||[],t(this._loadedNps,a)},j.validateEntity=function(){var a=!0;return this._processValidationOpAndPublish(function(b){a=d(b.entity)}),a},j.validateProperty=function(a,b){var c=this.getPropertyValue(a);return c&&c.complexAspect?d(c):(b=b||{},b.entity=this.entity,"string"==typeof a?(b.property=this.entity.entityType.getProperty(a,!0),b.propertyName=a):(b.property=a,b.propertyName=a.name),this._validateProperty(c,b))},j.getValidationErrors=function(a){jb(a,"property").isOptional().isEntityProperty().or().isString().check();var b=i(this._validationErrors);if(a){var c="string"==typeof a?a:a.name;b=b.filter(function(a){return a.property&&(a.property.name===c||-1!=c.indexOf(".")&&a.propertyName==c)})}return b},j.addValidationError=function(a){jb(a,"validationError").isInstanceOf(sb).check(),this._processValidationOpAndPublish(function(b){b._addValidationError(a)})},j.removeValidationError=function(a){jb(a,"validationErrorOrKey").isString().or().isInstanceOf(sb).or().isInstanceOf(rb).check();var b="string"==typeof a?a:a.key;this._processValidationOpAndPublish(function(a){a._removeValidationError(b)})},j.clearValidationErrors=function(){this._processValidationOpAndPublish(function(a){b(a._validationErrors,function(b,c){c&&(delete a._validationErrors[b],a._pendingValidationResult.removed.push(c))}),a.hasValidationErrors=!P(a._validationErrors)})},j.getParentKey=function(a){var b=a.foreignKeyNames;if(0===b.length)return null;var c=this,d=b.map(function(a){return c.entity.getProperty(a)});return new xb(a.entityType,d)},j.getPropertyValue=function(a){jb(a,"property").isString().or().isEntityProperty().check();var b;if("string"==typeof a){var c=a.trim().split("."),d=c.shift();for(b=this.entity,b=b.getProperty(d);c.length>0;)d=c.shift(),b=b.getProperty(d)}else{if(!(a.parentType instanceof Fb))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");b=this.entity.getProperty(a.name)}return b},j._checkOperation=function(a){if(this.isBeingSaved)throw new Error("Cannot perform a '"+a+"' on an entity that is in the process of being saved");return this},j._detach=function(){this.entityGroup=null,this.entityManager=null,this.entityState=yb.Detached,this.originalValues={},this._validationErrors={},this.hasValidationErrors=!1,this.validationErrorsChanged.clear(),this.propertyChanged.clear()},j._validateProperty=function(a,b){var c=!0;return this._processValidationOpAndPublish(function(d){b.property.getAllValidators().forEach(function(e){c=g(d,e,a,b)&&c})}),c},j._processValidationOpAndPublish=function(a){if(this._pendingValidationResult)a(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]},a(this),(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=void 0}},j._addValidationError=function(a){this._validationErrors[a.key]=a,this.hasValidationErrors=!0,this._pendingValidationResult.added.push(a)},j._removeValidationError=function(a){var b=this._validationErrors[a];b&&(delete this._validationErrors[a],this.hasValidationErrors=!P(this._validationErrors),this._pendingValidationResult.removed.push(b))},h}(),wb=function(){var a=function c(a,b,d){if(!a)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(a.complexAspect)return a.complexAspect;if(!(this instanceof c))return new c(a,b,d);this.complexObject=a,a.complexAspect=this,this.originalValues={},null!=b&&(this.parent=b,this.parentProperty=d);var e=a.complexType;if(!e){var f=a.prototype._$typeName;throw new Error(f?"Metadata for this complexType has not yet been resolved: "+f:"This entity is not registered as a valid ComplexType")}var g=e.getCtor();pb.getDefaultInstance().startTracking(a,g.prototype)},b=a.prototype;return b.getEntityAspect=function(){var a=this.parent;if(!a)return new vb(null);for(var b=a.entityAspect;a&&!b;)a=a.complexAspect&&a.complexAspect.parent,b=a&&a.entityAspect;return b||new vb(null)},b.getPropertyPath=function(a){var b=this.parent;if(!b)return null;var c=b.complexAspect||b.entityAspect;return c.getPropertyPath(this.parentProperty.name+"."+a)},a}();db.EntityAspect=vb,db.ComplexAspect=wb;var xb=function(){function a(a){return a.join(b)}var b=":::",c=function(b,c){jb(b,"entityType").isInstanceOf(Fb).check();var d=b.getSelfAndSubtypes();d.length>1&&(this._subtypes=d.filter(function(a){return a.isAbstract===!1})),Array.isArray(c)||(c=fb(arguments,1)),this.entityType=b,b.keyProperties.forEach(function(a,b){a.dataType===zb.Guid&&(c[b]=c[b]&&c[b].toLowerCase())}),this.values=c,this._keyInGroup=a(c)};c._$typeName="EntityKey";var d=c.prototype;return d.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},c.fromJSON=function(a,b){var c=b._getEntityType(a.entityType,!0);return new xb(c,a.values)},d.equals=function(a){return a instanceof xb?this.entityType===a.entityType&&w(this.values,a.values):!1},d.toString=function(a){return(a||this.entityType).name+"-"+this._keyInGroup},c.equals=function(a,b){return a instanceof xb?a.equals(b):!1},d._isEmpty=function(){return 0===this.values.join("").length},c.createKeyString=a,c}();db.EntityKey=xb;var yb=function(){var a={isUnchanged:function(){return this===b.Unchanged},isAdded:function(){return this===b.Added},isModified:function(){return this===b.Modified},isDeleted:function(){return this===b.Deleted},isDetached:function(){return this===b.Detached},isUnchangedOrModified:function(){return this===b.Unchanged||this===b.Modified},isAddedModifiedOrDeleted:function(){return this===b.Added||this===b.Modified||this===b.Deleted}},b=new mb("EntityState",a);return b.Unchanged=b.addSymbol(),b.Added=b.addSymbol(),b.Modified=b.addSymbol(),b.Deleted=b.addSymbol(),b.Detached=b.addSymbol(),b.resolveSymbols(),b}();db.EntityState=yb,db.makePrimitiveArray=function(){function a(a,c,d){return qb.initializeParent(a,c,d),a.arrayChanged=new nb("arrayChanged",a),j(a,qb.mixin),j(a,b)}var b={};return b._getGoodAdds=function(a){return a},b._beforeChange=function(){var a=this.getEntityAspect();a.entityState.isUnchanged()&&a.setModified(),a.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},b._processAdds=function(){},b._processRemoves=function(){},b._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},b._acceptChanges=function(){this._origValues=null},a}(),db.makeRelationArray=function(){function a(a,b){var c=d(a,b);if(!c.length)return c;var e=a.parentEntity,f=e.entityAspect.entityManager;return f&&!f.isLoading&&c.forEach(function(b){if(b.entityAspect.entityState.isDetached()){a._inProgress=!0;try{f.attachEntity(b,yb.Added)}finally{a._inProgress=!1}}}),c}function b(a,b){var c=a.parentEntity,d=a.navigationProperty,e=a._addsInProcess,f=d.inverse,g=e.length;try{b.forEach(function(a){if(e.push(a),f)a.setProperty(f.name,c);else{var b=c.entityType.keyProperties;d.invForeignKeyNames.forEach(function(d,e){a.setProperty(d,c.getProperty(b[e].name))})}})}finally{e.splice(g,b.length)}}function c(a,b){var c=a.navigationProperty.inverse;c&&b.forEach(function(a){a.setProperty(c.name,null)})}function d(a,b){var c,d=a.parentEntity,e=a.navigationProperty,f=e.inverse;if(f)c=b.filter(function(b){if(a._addsInProcess.indexOf(b)>=0)return!1;var c=b.getProperty(f.name);return c!==d});else{var g=e.invForeignKeyNames,h=d.entityType.keyProperties;c=b.filter(function(b){return a._addsInProcess.indexOf(b)>=0?!1:g.some(function(a,c){var e=h[c].name,f=d.getProperty(e),g=b.getProperty(a);return f!==g})})}return c}function e(a,b,c){return a.parentEntity=b,a.navigationProperty=c,a.arrayChanged=new nb("arrayChanged",a),a._addsInProcess=[],j(a,qb.mixin),j(a,f)}var f={};return f.load=function(a,b){var c=this.parentEntity,d=Ob.fromEntityNavigation(this.parentEntity,this.navigationProperty),e=c.entityAspect.entityManager;return e.executeQuery(d,a,b)},f._getEventParent=function(){return this.parentEntity.entityAspect},f._getPendingPubs=function(){var a=this.parentEntity.entityAspect.entityManager;return a&&a._pendingPubs},f._getGoodAdds=function(b){return a(this,b)},f._processAdds=function(a){b(this,a)},f._processRemoves=function(a){c(this,a)},e}();var zb=function(){function a(a,b){throw a=T(a,b),new Error(a)}function b(a){switch(a){case y.String:return rb.string;case y.Int64:return rb.int64;case y.Int32:return rb.int32;case y.Int16:return rb.int16;case y.Decimal:return rb.number;case y.Double:return rb.number;case y.Single:return rb.number;case y.DateTime:return rb.date;case y.DateTimeOffset:return rb.date;case y.Boolean:return rb.bool;case y.Guid:return rb.guid;case y.Byte:return rb["byte"];case y.Binary:return rb.none;case y.Time:return rb.duration;case y.Undefined:return rb.none}}var c,d={},e=function(){c={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1}};e();var f=function(){return c.stringPrefix+g().toString()},g=function(){var a=c.nextNumber;return c.nextNumber+=c.nextNumberIncrement,a},h=function(){return D()},i=function(){return new Date},j=function(a){return null==a?a:a.toString()},k=function(a,b){if("string"===b){var c=a.trim();if(""===c)return null;var d=parseInt(c,10);return isNaN(d)?a:d}return"number"===b?Math.round(a):a},l=function(a,b){if("string"===b){var c=a.trim();if(""===c)return null;var d=parseFloat(c);return isNaN(d)?a:d}return a},m=function(a,b){var c;if("string"===b){var d=a.trim();return""===d?null:(c=new Date(Date.parse(d)),I(c)?c:a)}return"number"===b?(c=new Date(a),I(c)?c:a):a},n=function(a,b){if("string"===b){var c=a.trim().toLowerCase();return"false"===c||""===c?!1:"true"===c?!0:a}return a},o=function(a){return null==a?null:"'"+a.replace(/'/g,"''")+"'"},p=function(a){return null==a?null:"string"==typeof a?parseInt(a,10):a},q=function(a){return function(b){return null==b?null:("string"==typeof b&&(b=parseFloat(b)),b+a)}},r=function(b){if(null==b)return null;try{return"datetime'"+b.toISOString()+"'"}catch(c){a("'%1' is not a valid dateTime",b)}},s=function(b){if(null==b)return null;try{return"datetimeoffset'"+b.toISOString()+"'"}catch(c){a("'%1' is not a valid dateTime",b)}},t=function(b){return null==b?null:(O(b)||a("'%1' is not a valid ISO 8601 duration",b),"time'"+b+"'")},u=function(b){return null==b?null:(N(b)||a("'%1' is not a valid guid",b),"guid'"+b+"'")},v=function(a){return null==a?null:"string"==typeof a?"true"===a.trim().toLowerCase():!!a},w=function(a){return null==a?a:"binary'"+a+"'"},x=function(a){return a},y=new mb("DataType",d);y.String=y.addSymbol({defaultValue:"",parse:j,fmtOData:o,getNext:f}),y.Int64=y.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:k,fmtOData:q("L"),getNext:g}),y.Int32=y.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:k,fmtOData:p,getNext:g}),y.Int16=y.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:k,fmtOData:p,getNext:g}),y.Byte=y.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:k,fmtOData:p}),y.Decimal=y.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,isFloat:!0,parse:l,fmtOData:q("m"),getNext:g}),y.Double=y.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:l,fmtOData:q("d"),getNext:g}),y.Single=y.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:l,fmtOData:q("f"),getNext:g}),y.DateTime=y.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:m,fmtOData:r,getNext:i}),y.DateTimeOffset=y.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:m,fmtOData:s,getNext:i}),y.Time=y.addSymbol({defaultValue:"PT0S",fmtOData:t}),y.Boolean=y.addSymbol({defaultValue:!1,parse:n,fmtOData:v}),y.Guid=y.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:u,getNext:h}),y.Binary=y.addSymbol({defaultValue:null,fmtOData:w}),y.Undefined=y.addSymbol({defaultValue:void 0,fmtOData:x}),y.resolveSymbols(),y.getComparableFn=function(a){return a&&a.isDate?function(a){return a&&a.getTime()
}:a===y.Time?function(a){return a&&E(a)}:function(a){return a}},y.fromEdmDataType=function(a){var b=null,c=a.split(".");if(c.length>1){var d=c[1];b="image"===d?y.Byte:2===c.length?y.fromName(d)||y.Undefined:y.String}return b},y.fromValue=function(a){if(I(a))return y.DateTime;switch(typeof a){case"string":return N(a)?y.Guid:O(a)&&a.length>3?y.Time:J(a)?y.DateTime:y.String;case"boolean":return y.Boolean;case"number":return y.Double}return y.Undefined};var z=/.\d{3}$/;return y.parseTimeFromServer=function(a){if("string"==typeof a)return a;if(a&&"Edm.Time"===a.__edmType){var b=Math.floor(a.ms/1e3);return"PT"+b+"S"}return a},y.parseDateAsUTC=function(a){if("string"==typeof a){var b=z.test(a);a=b?a+"Z":a}return a=new Date(Date.parse(a))},y.parseDateFromServer=y.parseDateAsUTC,y.parseRawValue=function(a,b){return void 0===a?void 0:(b.isDate&&a?I(a)||(a=y.parseDateFromServer(a)):b===y.Binary?a&&void 0!==a.$value&&(a=a.$value):b===y.Time&&(a=y.parseTimeFromServer(a)),a)},y.constants=c,y._resetConstants=e,y.getSymbols().forEach(function(a){a.validatorCtor=b(a)}),y}();db.DataType=zb;var Ab=function(){function a(a,b){return b&&(lb(b).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("uriBuilderName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(Bb).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(a),a.serviceName=a.serviceName&&Ab._normalizeServiceName(a.serviceName),a.adapterInstance=a.adapterName&&ob.getAdapterInstance("dataService",a.adapterName),a.uriBuilder=a.uriBuilderName&&ob.getAdapterInstance("uriBuilder",a.uriBuilderName)),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="DataService",c.using=function(b){if(!b)return this;var c=new Ab(this);return a(c,b)},b.resolve=function(a){a.push({hasServerMetadata:!0,useJsonp:!1});var b=new Ab(o(a,["serviceName","adapterName","uriBuilderName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!b.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return b.adapterInstance=b.adapterInstance||ob.getAdapterInstance("dataService",b.adapterName),b.jsonResultsAdapter=b.jsonResultsAdapter||b.adapterInstance.jsonResultsAdapter,b.uriBuilder=b.uriBuilder||ob.getAdapterInstance("uriBuilder",b.uriBuilderName),b},b._normalizeServiceName=function(a){return a=a.trim(),"/"!==a.substr(-1)?a+"/":a},c.toJSON=function(){return m(this,{serviceName:null,adapterName:null,uriBuilderName:null,hasServerMetadata:null,jsonResultsAdapter:function(a){return a&&a.name},useJsonp:null})},b.fromJSON=function(a){return a.jsonResultsAdapter=ob._fetchObject(Bb,a.jsonResultsAdapter),new Ab(a)},c.qualifyUrl=function(a){var b=this.serviceName;return hb.stringEndsWith(b,"/")&&(b=b.substr(0,b.length-1)),a="/"+a,hb.stringEndsWith(b,a)||(b+=a),b},b}(),Bb=function(){function a(a){return a.results}var b=function(b){if(1!==arguments.length)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");lb(b).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(a).whereParam("visitNode").isFunction().applyAll(this),ob._storeObject(this,c._$typeName,this.name)},c=b.prototype;return c._$typeName="JsonResultsAdapter",b}();db.DataService=Ab,db.JsonResultsAdapter=Bb;var Cb=z("Q");Cb||(Cb=function(){var a="Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q";throw new Error(a)},Cb.defer=Cb.resolve=Cb.reject=Cb),db.config.setQ=function(a){db.Q=Cb=a},db.Q=Cb;var Db=function(){function a(a){var b=[];for(var c in a){var d=a[c];c===d.name&&b.push(a[c])}return b}function b(a,b,c){var e=ab(b.shortName,b.namespace),g=a._getEntityType(e,!0);if(g)return c?d(g,b):g;var h={shortName:b.shortName,namespace:b.namespace,isAbstract:b.isAbstract,autoGeneratedKeyType:Jb.fromName(b.autoGeneratedKeyType),defaultResourceName:b.defaultResourceName,custom:b.custom};if(g=b.isComplexType?new Gb(h):new Fb(h),b.baseTypeName){g.baseTypeName=b.baseTypeName;var i=a._getEntityType(b.baseTypeName,!0);i?f(a,b,g,i):x(a._deferredTypes,b.baseTypeName).push({json:b,stype:g})}else f(a,b,g);return g}function d(a,b){return b.custom&&(a.custom=b.custom),e(a,b.dataProperties),e(a,b.navigationProperties),a}function e(a,b){b&&b.forEach(function(b){var c=b.name;if(!c){if(!b.nameOnServer)throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes");c=a.metadataStore.namingConvention.serverPropertyNameToClient(b.nameOnServer,{})}if(b.custom){var d=a.getProperty(c,!0);d.custom=b.custom}})}function f(a,b,c){b.validators&&(c.validators=b.validators.map(rb.fromJSON)),b.dataProperties.forEach(function(a){c._addPropertyCore(Hb.fromJSON(a))});var d=!b.isComplexType;d&&b.navigationProperties&&b.navigationProperties.forEach(function(a){c._addPropertyCore(Ib.fromJSON(a))}),a.addEntityType(c);var e=a._deferredTypes,g=e[c.name];g&&(g.forEach(function(b){f(a,b.json,b.stype)}),delete e[c.name])}function g(a,b,c){if(_(b))return b;var d=a._shortNameMap[b];if(!d&&c)throw new Error("Unable to locate 'entityTypeName' of: "+b);return d}var h=0,i=function(a){a=a||{},lb(a).whereParam("namingConvention").isOptional().isInstanceOf(Mb).withDefault(Mb.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(Lb).withDefault(Lb.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this),this.dataServices=[],this._resourceEntityTypeMap={},this._structuralTypeMap={},this._shortNameMap={},this._ctorRegistry={},this._incompleteTypeMap={},this._incompleteComplexTypeMap={},this._id=h++,this.metadataFetched=new nb("metadataFetched",this)},k=i.prototype;return k._$typeName="MetadataStore",nb.bubbleEvent(k,null),i.ANONTYPE_PREFIX="_IB_",k.setProperties=function(a){lb(a).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)},k.addDataService=function(a,b){jb(a,"dataService").isInstanceOf(Ab).check(),jb(b,"shouldOverwrite").isBoolean().isOptional().check();var c=this._getDataServiceIndex(a.serviceName);if(c>=0){if(!b)throw new Error("A dataService with this name '"+a.serviceName+"' already exists in this MetadataStore");this.dataServices[c]=a}else this.dataServices.push(a)},k._getDataServiceIndex=function(a){return s(this.dataServices,function(b){return b.serviceName===a})},k.addEntityType=function(a){if(a instanceof Fb||a instanceof Gb||(a=a.isComplexType?new Gb(a):new Fb(a)),!a.isComplexType){if(a.baseTypeName&&!a.baseEntityType){var b=this._getEntityType(a.baseTypeName,!0);a._updateFromBase(b)}if(0===a.keyProperties.length&&!a.isAbstract)throw new Error("Unable to add "+a.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.")}if(a.metadataStore=this,!a.isAnonymous){if(this._structuralTypeMap[a.name])throw new Error("Type "+a.name+" already exists in this MetadataStore.");this._structuralTypeMap[a.name]=a,this._shortNameMap[a.shortName]=a.name}if(a.getProperties().forEach(function(b){a._updateNames(b),b.isUnmapped||a._mappedPropertiesCount++}),a._updateCps(),!a.isComplexType){a._updateNps();var c=a.defaultResourceName||a.baseEntityType&&a.baseEntityType.defaultResourceName;c&&!this.getEntityTypeNameForResourceName(c)&&this.setEntityTypeForResourceName(c,a.name),a.defaultResourceName=c,a.getEntityCtor()}},k.exportMetadata=function(){var a=JSON.stringify({metadataVersion:db.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:c(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,ob.stringifyPad);return a},k.importMetadata=function(a,c){jb(c,"allowMerge").isOptional().isBoolean().check(),this._deferredTypes={};var d="string"==typeof a?JSON.parse(a):a;if(d.schema)return Eb.parse(this,d.schema,d.altMetadata);if(d.metadataVersion&&d.metadataVersion!==db.metadataVersion){var e=T("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",d.metadataVersion,db.metadataVersion);throw new Error(e)}var f=d.namingConvention,g=d.localQueryComparisonOptions;if(this.isEmpty())this.namingConvention=ob._fetchObject(Mb,f)||this.namingConvention,this.localQueryComparisonOptions=ob._fetchObject(Lb,g)||this.localQueryComparisonOptions;else{if(f&&this.namingConvention.name!==f)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(g&&this.localQueryComparisonOptions.name!==g)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}var h=this;d.dataServices&&d.dataServices.forEach(function(a){a=Ab.fromJSON(a),h.addDataService(a,!0)});this._structuralTypeMap;return d.structuralTypes&&d.structuralTypes.forEach(function(a){b(h,a,c)}),j(this._resourceEntityTypeMap,d.resourceEntityTypeMap),j(this._incompleteTypeMap,d.incompleteTypeMap),this},i.importMetadata=function(a){var b=new Db;return b.importMetadata(a),b},k.hasMetadataFor=function(a){return!!this.getDataService(a)},k.getDataService=function(a){return jb(a,"serviceName").isString().check(),a=Ab._normalizeServiceName(a),r(this.dataServices,function(b){return b.serviceName===a})},k.fetchMetadata=function(a,b,c){try{if(jb(a,"dataService").isString().or().isInstanceOf(Ab).check(),jb(b,"callback").isFunction().isOptional().check(),jb(c,"errorCallback").isFunction().isOptional().check(),"string"==typeof a&&(a=this.getDataService(a)||new Ab({serviceName:a})),a=Ab.resolve([a]),this.hasMetadataFor(a.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+a.serviceName);var d=this;return a.adapterInstance.fetchMetadata(this,a).then(function(c){return d.metadataFetched.publish({metadataStore:d,dataService:a,rawMetadata:c}),b&&b(c),Cb.resolve(c)},function(a){return c&&c(a),Cb.reject(a)})}catch(e){return Cb.reject(e)}},k.trackUnmappedType=function(a,b){jb(a,"entityCtor").isFunction().check(),jb(b,"interceptor").isFunction().isOptional().check();var c=new Fb(this);c._setCtor(a,b)},k.registerEntityTypeCtor=function(a,b,c,d){jb(a,"structuralTypeName").isString().check(),jb(b,"aCtor").isFunction().isOptional().check(),jb(c,"initFn").isOptional().isFunction().or().isString().check(),jb(d,"noTrackingFn").isOptional().isFunction().check();var e=g(this,a,!1),f=e||a;if(this._ctorRegistry[f]={ctor:b,initFn:c,noTrackingFn:d},e){var h=this._structuralTypeMap[e];h&&h.getCtor(!0)}},k.isEmpty=function(){return P(this._structuralTypeMap)},k.getEntityType=function(a,b){return jb(a,"structuralTypeName").isString().check(),jb(b,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(a,b)},k._getEntityType=function(a,b){var c=g(this,a,!1),d=this._structuralTypeMap[c];if(!d){if(b)return null;var e=T("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",a);throw new Error(e)}if(d.length){var f=d.join(",");throw new Error("There are multiple types with this 'shortName': "+f)}return d},k.getEntityTypes=function(){return a(this._structuralTypeMap)},k.getIncompleteNavigationProperties=function(){return c(this._incompleteTypeMap,function(a,b){return b})},k.getEntityTypeNameForResourceName=function(a){return jb(a,"resourceName").isString().check(),this._resourceEntityTypeMap[a]},k.setEntityTypeForResourceName=function(a,b){jb(a,"resourceName").isString().check(),jb(b,"entityTypeOrName").isInstanceOf(Fb).or().isString().check();var c;c=b instanceof Fb?b.name:g(this,b,!0),this._resourceEntityTypeMap[a]=c;var d=this._getEntityType(c,!0);d&&!d.defaultResourceName&&(d.defaultResourceName=a)},k._checkEntityType=function(a){if(!a.entityType){var b=a.prototype._$typeName;if(!b)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");var c=this._getEntityType(b);c&&(a.entityType=c)}},i}(),Eb=function(){function a(a,c,e){a._entityTypeResourceMap={},p(c).forEach(function(c){if(c.cSpaceOSpaceMapping){var e=JSON.parse(c.cSpaceOSpaceMapping),f={};e.forEach(function(a){f[a[0]]=a[1]}),c.cSpaceOSpaceMapping=f}c.entityContainer&&p(c.entityContainer).forEach(function(b){p(b.entitySet).forEach(function(b){var d=q(b.entityType,c).typeName;a.setEntityTypeForResourceName(b.name,d),a._entityTypeResourceMap[d]=b.name})}),c.complexType&&p(c.complexType).forEach(function(b){d(b,c,a)}),c.entityType&&p(c.entityType).forEach(function(d){b(d,c,a)})});var f=a.getIncompleteNavigationProperties();if(f.length>0){var g=f.map(function(a){return a.parentType.name+":"+a.name}).join(", ");throw new Error("Incomplete navigation properties: "+g)}return e&&a.importMetadata(e,!0),a}function b(a,b,d){var e=a.name,f=s(e,b),g=new Fb({shortName:e,namespace:f,isAbstract:a["abstract"]&&"true"===a["abstract"]});if(a.baseType){var h=q(a.baseType,b).typeName;g.baseTypeName=h;var i=d._getEntityType(h,!0);if(i)c(g,a,b,d);else{var j=d._deferredTypes[h];j||(j=[],d._deferredTypes[h]=j),j.push({entityType:g,csdlEntityType:a})}}else c(g,a,b,d);return g}function c(a,b,d,f){var g=b.key?p(b.key.propertyRef).map(h("name")):[];p(b.property).forEach(function(b){e(a,b,d,g)}),p(b.navigationProperty).forEach(function(b){i(a,b,d)}),f.addEntityType(a),a.defaultResourceName=f._entityTypeResourceMap[a.name];var j=f._deferredTypes,k=j[a.name];k&&(k.forEach(function(a){c(a.entityType,a.csdlEntityType,d,f)}),delete j[a.name])}function d(a,b,c){var d=a.name,f=s(d,b),g=new Gb({shortName:d,namespace:f});return p(a.property).forEach(function(a){e(g,a,b)}),c.addEntityType(g),g}function e(a,b,c,d){var e,h=b.type.split(".");return"Edm"===h[0]&&2===h.length?e=f(a,b,d):j(b,c)?(e=f(a,b,d),e&&(e.enumType=b.type)):e=g(a,b,c),e&&(a._addPropertyCore(e),m(e)),e}function f(a,b,c){var d=zb.fromEdmDataType(b.type);if(null==d)return a.warnings.push("Unable to recognize DataType for property: "+b.name+" DateType: "+b.type),null;var e="true"===b.nullable||null==b.nullable,f=null!=c&&c.indexOf(b.name)>=0;f&&a.autoGeneratedKeyType===Jb.None&&n(b)&&(a.autoGeneratedKeyType=Jb.Identity);var g=b.maxLength;g=null==g||"Max"===g?null:parseInt(g,10);var h=new Hb({nameOnServer:b.name,dataType:d,isNullable:e,isPartOfKey:f,maxLength:g,defaultValue:b.defaultValue,concurrencyMode:b.concurrencyMode});return d===zb.Undefined&&(h.rawTypeName=b.type),h}function g(a,b,c){var d=q(b.type,c).typeName,e=new Hb({nameOnServer:b.name,complexTypeName:d,isNullable:!1});return e}function i(a,b,c){var d=o(b,c),e=r(d.end,function(a){return a.role===b.toRole}),f="*"!==e.multiplicity,g=q(e.type,c).typeName,i=d.referentialConstraint;if(i||"*"!=d.end[0].multiplicity||"*"!=d.end[1].multiplicity){var j={nameOnServer:b.name,entityTypeName:g,isScalar:f,associationName:d.name};if(i){var k=i.principal,l=i.dependent,m=p(l.propertyRef),n=m.map(h("name"));b.fromRole===k.role?j.invForeignKeyNamesOnServer=n:j.foreignKeyNamesOnServer=n}var s=new Ib(j);return a._addPropertyCore(s),s}}function j(a,b){return b.enumType?k(a,b):b.extensions?l(a,b):!1}function k(a,b){var c=p(b.enumType),d=a.type.split("."),e=d[d.length-1];return c.some(function(a){return a.name===e})}function l(a,b){var c=b.extensions.filter(function(a){return"EnumType"===a.name}),d=a.type.split("."),e=d[d.length-1];return c.some(function(a){return a.attributes.some(function(a){return"Name"===a.name&&a.value===e})})}function m(a){var b;if(a.isNullable||a.validators.push(rb.required()),!a.isComplexProperty){if(a.dataType===zb.String)if(a.maxLength){var c={maxLength:a.maxLength};b=rb.maxLength(c)}else b=rb.string();else b=a.dataType.validatorCtor();a.validators.push(b)}}function n(a){var b=r(Object.keys(a),function(a){return a.indexOf("StoreGeneratedPattern")>=0});if(b)return"Identity"===a[b];var c=a.extensions;if(!c)return!1;var d=r(c,function(a){return"StoreGeneratedPattern"===a.name&&"Identity"===a.value});return!!d}function o(a,b){var c=q(a.relationship,b).shortTypeName,d=b.association;if(!d)return null;Array.isArray(d)||(d=[d]);var e=r(d,function(a){return a.name===c});return e}function q(a,b){if(!a)return null;if(R(a,Db.ANONTYPE_PREFIX))return{shortTypeName:a,namespace:"",typeName:a,isAnonymous:!0};var c=a.split(",")[0],d=c.split(".");if(d.length>1){var e=d[d.length-1],f=null;if(b&&(f=s(e,b)),!f){var g=d.slice(0,d.length-1);f=g.join(".")}return{shortTypeName:e,namespace:f,typeName:ab(e,f)}}return{shortTypeName:a,namespace:"",typeName:a}}function s(a,b){var c,d=b.cSpaceOSpaceMapping;if(d){var e=d[b.namespace+"."+a];if(c=e&&e.substr(0,e.length-(a.length+1)))return c}return b.entityType||"Default"!=b.namespace?b.namespace:null}var t=C(function(a){return a&&q(a).typeName});return{parse:a,normalizeTypeName:t}}(),Fb=function(){function a(a,b){return a.entityAspect||a.complexAspect?a.getProperty(b.name):a[b.name]}function b(a){var b=a.name.replace(/\W/g,"_");return Function("return function "+b+"(){}")()}function c(a){return a.filter(function(a){return null==a.baseProperty})}function d(a,b,c){var d=c+"OnServer",e=b[c];if(e&&e.length){var f=p(e).map(function(c){var d=a.clientPropertyNameToServer(c,b),e=a.serverPropertyNameToClient(d,b);if(c!==e)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+c+"-->"+e);return d});b[d]=Array.isArray(e)?f:f[0]}else{var g=b[d];if(!g||0===g.length)return;var h=p(g).map(function(c){var d=a.serverPropertyNameToClient(c,b),e=a.clientPropertyNameToServer(d,b);if(c!==e)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+c+"-->"+e);return d});b[c]=Array.isArray(g)?h:h[0]}}function f(a,b){var c=b._getEntityType(a.complexTypeName,!0);if(!c)return!1;if(!(c instanceof Gb))throw new Error("Unable to resolve ComplexType with the name: "+a.complexTypeName+" for the property: "+property.name);return a.dataType=c,a.defaultValue=null,!0}function i(a,b){if(a.entityType)return!0;var c=b._getEntityType(a.entityTypeName,!0);if(c)a.entityType=c,a._resolveNp();else{var d=x(b._incompleteTypeMap,a.entityTypeName);t(d,a)}return!!c}function j(a,b){var c=a.getPropertyNames(),d=pb.getDefaultInstance(),f=d.getTrackablePropertyNames(b);f.forEach(function(d){if(-1===c.indexOf(d)){var f=b[d];try{"function"==typeof f&&(f=f())}catch(g){}var h=zb.fromValue(f),i=new Hb({name:d,dataType:h,isNullable:!0,isUnmapped:!0});i.isSettable=e(b,d),a.subtypes?a.getSelfAndSubtypes().forEach(function(a){a._addPropertyCore(new Hb(i))}):a._addPropertyCore(i)}})}var k=0,l=function(a){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===a._$typeName?(this.metadataStore=a,this.shortName="Anon_"+ ++k,this.namespace="",this.isAnonymous=!0):lb(a).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(Jb).isOptional().withDefault(Jb.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this),this.name=ab(this.shortName,this.namespace),this.dataProperties=[],this.navigationProperties=[],this.complexProperties=[],this.keyProperties=[],this.foreignKeyProperties=[],this.inverseForeignKeyProperties=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.validators=[],this.warnings=[],this._mappedPropertiesCount=0,this.subtypes=[],bb(this,a.dataProperties,Hb),bb(this,a.navigationProperties,Ib)},n=l.prototype,o=zb.parseRawValue;return n._$typeName="EntityType",l.qualifyTypeName=ab,n.setProperties=function(a){lb(a).whereParam("autoGeneratedKeyType").isEnumOf(Jb).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this),a.defaultResourceName&&(this.defaultResourceName=a.defaultResourceName)},n.isSubtypeOf=function(a){jb(a,"entityType").isInstanceOf(Fb).check();var b=this;do{if(b===a)return!0;b=b.baseEntityType}while(b);return!1},n.getSelfAndSubtypes=function(){var a=[this];return this.subtypes.forEach(function(b){var c=b.getSelfAndSubtypes();a.push.apply(a,c)}),a},n.getAllValidators=function(){for(var a=this.validators.slice(0),b=this.baseEntityType;b;)a.push.apply(a,b.validators),b=b.baseEntityType;return a},n.addProperty=function(a){return jb(a,"property").isInstanceOf(Hb).or().isInstanceOf(Ib).check(),this._addPropertyCore(a,!0)},n._updateFromBase=function(a){this.baseEntityType=a,this.autoGeneratedKeyType===Jb.None&&(this.autoGeneratedKeyType=a.autoGeneratedKeyType),a.dataProperties.forEach(function(a){var b=new Hb(a);b.validators=[],b.baseProperty=a,this._addPropertyCore(b)},this),a.navigationProperties.forEach(function(a){var b=new Ib(a);b.validators=[],b.baseProperty=a,this._addPropertyCore(b)},this),a.subtypes.push(this)},n._addPropertyCore=function(a,b){if(this.isFrozen)throw new Error("The '"+this.name+"' EntityType/ComplexType has been frozen. You can only add properties to an EntityType/ComplexType before any instances of that type have been created and attached to an entityManager.");var c=a.parentType;if(c){if(c!==this)throw new Error("This property: "+a.name+" has already been added to "+a.parentType.name);return this}a.parentType=this;var e=this.metadataStore;return a.isDataProperty?this._addDataProperty(a):(this._addNavigationProperty(a),b&&e&&i(a,e)),!e||a.name&&a.nameOnServer||d(e.namingConvention,a,"name"),this},n.createEntity=function(b){if(b&&b._$eref&&!b._$eref.entityAspect.entityManager)return b._$eref;var c=this._createInstanceCore();return b&&(this.keyProperties.every(function(a){return null!=b[a.name]})&&(b._$eref=c),this._updateTargetFromRaw(c,b,a),this.navigationProperties.forEach(function(a){var d,e=b[a.name];if(void 0!=e){var f=a.entityType;if(a.isScalar)d=e.entityAspect?e:f.createEntity(e),c.setProperty(a.name,d);else{var g=c.getProperty(a.name);e.forEach(function(a){d=a.entityAspect?a:f.createEntity(a),g.push(d)})}}})),this._initializeInstance(c),c},n._createInstanceCore=function(){var a=this.getEntityCtor(),b=new a;return new vb(b),b},n._initializeInstance=function(a){this.baseEntityType&&this.baseEntityType._initializeInstance(a);var b=this.initFn;b&&("string"==typeof b&&(b=a[b]),b(a)),this.complexProperties&&this.complexProperties.forEach(function(b){var c=a.getProperty(b.name);Array.isArray(c)?c.forEach(function(a){b.dataType._initializeInstance(a)}):b.dataType._initializeInstance(c)}),a.entityAspect&&(a.entityAspect._initialized=!0)},n.getCtor=n.getEntityCtor=function(a){if(this._ctor&&!a)return this._ctor;var c=this.metadataStore._ctorRegistry,d=c[this.name]||c[this.shortName]||{},e=d.ctor||this._ctor,f=e&&e.prototype&&(e.prototype.entityType||e.prototype.complexType);if(f&&f.metadataStore!==this.metadataStore)throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.");if(d.ctor&&a&&(this._extra=void 0),!e){var g=pb.getDefaultInstance().createCtor;e=g?g(this):b(this)}return this.initFn=d.initFn,this.noTrackingFn=d.noTrackingFn,e.prototype._$typeName=this.name,this._setCtor(e),e},n._setCtor=function(a,b){var c=a.prototype;this._extra=this._extra||{};var d=new a;j(this,d),"EntityType"===this._$typeName?c.entityType=this:c.complexType=this,c._$interceptor=b||V,pb.getDefaultInstance().initializeEntityPrototype(c),this._ctor=a},n.addValidator=function(a,b){jb(a,"validator").isInstanceOf(rb).check(),jb(b,"property").isOptional().isString().or().isEntityProperty().check(),b?("string"==typeof b&&(b=this.getProperty(b,!0)),b.validators.push(a)):this.validators.push(a)},n.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},n.getPropertyNames=function(){return this.getProperties().map(h("name"))},n.getDataProperty=function(a){return r(this.dataProperties,g("name",a))},n.getNavigationProperty=function(a){return r(this.navigationProperties,g("name",a))},n.getProperty=function(a,b){var c=this.getPropertiesOnPath(a,!1,b);return c?c[c.length-1]:null},n.getPropertiesOnPath=function(a,b,c){c=c||!1;var d=Array.isArray(a)?a:a.trim().split("."),e=!0,f=this,h=b?"nameOnServer":"name",i=d.map(function(a){var b=r(f.getProperties(),g(h,a));if(b)f=b.isNavigationProperty?b.entityType:b.dataType;else{if(c)throw new Error("unable to locate property: "+a+" on entityType: "+f.name);e=!1}return b});return e?i:null},n.clientPropertyPathToServer=function(a,b){var c,b=b||".";if(this.isAnonymous){var d=this.metadataStore.namingConvention.clientPropertyNameToServer;c=a.split(".").map(function(a){return d(a)})}else c=this.getPropertiesOnPath(a,!1,!0).map(function(a){return a.nameOnServer});return c.join(b)},n.getEntityKeyFromRawEntity=function(a,b){var c=this.keyProperties.map(function(c){var d=b(a,c);return o(d,c.dataType)});return new xb(this,c)},n._updateTargetFromRaw=function(a,b,c){this.dataProperties.forEach(function(d){if(d.isSettable){var e=c(b,d);if(void 0!==e){var f,g=d.dataType;if(d.isComplexProperty){if(null===e)return;f=a.getProperty(d.name),d.isScalar?g._updateTargetFromRaw(f,e,c):(f.length=0,Array.isArray(e)&&e.forEach(function(b){var e=g._createInstanceCore(a,d);g._updateTargetFromRaw(e,b,c),g._initializeInstance(e),f.push(e)}))}else{var h;d.isScalar?(h=o(e,g),a.setProperty(d.name,h)):(f=a.getProperty(d.name),f.length=0,Array.isArray(e)&&e.forEach(function(a){h=o(a,g),f.push(h)}))}}}});var d=b.entityAspect||b.complexAspect;if(d){var e=a.entityAspect||a.complexAspect;d.originalValuesMap&&(e.originalValues=d.originalValuesMap),d.extraMetadata&&(e.extraMetadata=d.extraMetadata)}},n.toString=function(){return this.name},n.toJSON=function(){return m(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:c,navigationProperties:c,validators:null,custom:null})},n._updateNames=function(a){var b=this.metadataStore.namingConvention;d(b,a,"name"),a.isNavigationProperty&&(d(b,a,"foreignKeyNames"),d(b,a,"invForeignKeyNames"))},n._checkNavProperty=function(a){if(a.isNavigationProperty){if(a.parentType!==this)throw new Error(T("The navigationProperty '%1' is not a property of entity type '%2'",a.name,this.name));return a}if("string"==typeof a){var b=this.getProperty(a);if(b&&b.isNavigationProperty)return b}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")},n._addDataProperty=function(a){this.dataProperties.push(a),a.isPartOfKey&&this.keyProperties.push(a),a.isComplexProperty&&this.complexProperties.push(a),a.concurrencyMode&&"None"!==a.concurrencyMode&&this.concurrencyProperties.push(a),a.isUnmapped&&this.unmappedProperties.push(a)},n._addNavigationProperty=function(a){this.navigationProperties.push(a),_(a.entityTypeName)||(a.entityTypeName=ab(a.entityTypeName,this.namespace))},n._updateCps=function(){var a=this.metadataStore,b=a._incompleteComplexTypeMap;this.complexProperties.forEach(function(c){c.complexType||f(c,a)||x(b,c.complexTypeName).push(c)}),this.isComplexType&&((b[this.name]||[]).forEach(function(b){f(b,a)}),delete b[this.name])},n._updateNps=function(){var a=this.metadataStore;this.navigationProperties.forEach(function(b){i(b,a)});var b=a._incompleteTypeMap;(b[this.name]||[]).forEach(function(b){i(b,a)}),delete b[this.name]},l}(),Gb=function(){var a=function(a){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");lb(a).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().applyAll(this),this.name=ab(this.shortName,this.namespace),this.isComplexType=!0,this.dataProperties=[],this.complexProperties=[],this.validators=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.navigationProperties=[],this.keyProperties=[],bb(this,a.dataProperties,Hb)},b=a.prototype;return b.setProperties=function(a){lb(a).whereParam("custom").isOptional().applyAll(this)},b.getAllValidators=function(){return this.validators},b._createInstanceCore=function(a,b){var c=this.getCtor(),d=new c;return new wb(d,a,b),d},b.addProperty=function(a){return jb(a,"dataProperty").isInstanceOf(Hb).check(),this._addPropertyCore(a)},b.getProperties=function(){return this.dataProperties},b=j(b,Fb.prototype,["addValidator","getProperty","getPropertiesOnPath","getPropertyNames","_addPropertyCore","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_setCtor"]),b.createInstance=Fb.prototype.createEntity,b.getCtor=Fb.prototype.getEntityCtor,b.toJSON=function(){return m(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})},b._$typeName="ComplexType",a}(),Hb=function(){var a=function(a){lb(a).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(zb).isOptional().or().isString().or().isInstanceOf(Gb).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("isSettable").isBoolean().isOptional().withDefault(!0).whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(rb).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this);var b=!(!this.name&&!this.nameOnServer);if(!b)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){var c=zb.fromName(this.dataType);if(!c)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=c}else this.dataType||(this.dataType=zb.String);if(null==this.defaultValue){if(this.isNullable)this.defaultValue=null;else if(this.isComplexProperty);else if(this.dataType===zb.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+(this.name||this.nameOnServer))}else this.dataType.isNumeric&&"string"==typeof this.defaultValue&&(this.defaultValue=parseFloat(this.defaultValue));this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},b=a.prototype;return b._$typeName="DataProperty",a.getRawValueFromServer=function(a,b){if(b.isUnmapped)return a[b.nameOnServer||b.name];var c=a[b.nameOnServer];return void 0!==c?c:b.defaultValue},a.getRawValueFromClient=function(a,b){var c=a[b.name];return void 0!==c?c:b.defaultValue},b.isDataProperty=!0,b.isNavigationProperty=!1,b.resolveProperty=function(a){for(var b=this[a],c=this.baseProperty;void 0==b&&null!=c;)b=c[a],c=c.baseProperty;return b},b.formatName=function(){return this.parentType.name+"--"+this.name},b.setProperties=function(a){lb(a).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this)
},b.getAllValidators=function(){for(var a=this.validators.slice(0),b=this.baseProperty;b;)a.push.apply(a,b.validators),b=b.baseProperty;return a},b.toJSON=function(){return m(this,{name:null,dataType:function(a){return a&&a.parentEnum?a.name:void 0},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,isSettable:!0,concurrencyMode:null,maxLength:null,validators:null,displayName:null,enumType:null,rawTypeName:null,isScalar:!0,custom:null})},a.fromJSON=function(a){return a.dataType=zb.fromName(a.dataType),a.defaultValue&&a.dataType&&a.dataType.isDate&&(a.defaultValue=new Date(Date.parse(a.defaultValue))),a.validators&&(a.validators=a.validators.map(rb.fromJSON)),new Hb(a)},a}(),Ib=function(){function a(a,b){throw new Error("Cannot set the inverse property for: "+a.formatName()+". "+b)}function b(a,b){throw new Error("Cannot create inverse for: "+a.formatName()+". The entityType for this navigation property "+b)}function c(a){var b=a.foreignKeyNames;if(0!==b.length){var c=a.parentType,d=b.map(function(a){return c.getDataProperty(a)}),e=c.foreignKeyProperties;d.forEach(function(b){t(e,b),b.relatedNavigationProperty=a,t(a.entityType.inverseForeignKeyProperties,b),a.relatedDataProperties?t(a.relatedDataProperties,b):a.relatedDataProperties=[b]})}}var d=function(a){lb(a).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(!0).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(rb).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this);var b=!(!this.name&&!this.nameOnServer);if(!b)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")},e=d.prototype;return e._$typeName="NavigationProperty",e.isDataProperty=!1,e.isNavigationProperty=!0,j(e,Hb.prototype,["formatName","getAllValidators","resolveProperty"]),e.setProperties=function(a){if(!this.parentType)throw new Error("Cannot call NavigationProperty.setProperties until the parent EntityType of the NavigationProperty has been set.");var b=a.inverse;b&&delete a.inverse,lb(a).whereParam("displayName").isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this),this.parentType._updateNames(this),this._resolveNp(),b&&this.setInverse(b)},e.setInverse=function(b){var c;if(c="string"==typeof b?this.entityType.getNavigationProperty(b):b,!c)throw a(this,"Unable to find inverse property: "+invNpName);(this.inverse||c.inverse)&&a(this,"It has already been set on one side or the other."),c.entityType!=this.parentType&&a(this,c.formatName+" is not a valid inverse property for this."),this.associationName?c.associationName=this.associationName:(c.associationName||(c.associationName=this.formatName()+"_"+c.formatName()),this.associationName=c.associationName),this._resolveNp(),c._resolveNp()},e.createInverse=function(a){this.entityType||b(this,"has not yet been defined."),this.entityType.isFrozen&&b(this,"is frozen.");var c=this.entityType.metadataStore;null==c&&b(this,"has not yet been added to the metadataStore."),a.entityTypeName=this.parentEntityType.name,a.associationName=this.associationName;var d=new Ib(a);return this.parentEntityType.addNavigationProperty(d),d},e.toJSON=function(){return m(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,displayName:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})},d.fromJSON=function(a){return a.validators&&(a.validators=a.validators.map(rb.fromJSON)),new Ib(a)},e._resolveNp=function(){var a=this,b=a.entityType,d=r(b.navigationProperties,function(b){return b.associationName===a.associationName&&(b.name!==a.name||b.entityTypeName!==a.entityTypeName)});a.inverse=d,d||a.invForeignKeyNames.forEach(function(c){var d=b.getDataProperty(c);if(!d)throw new Error("EntityType '"+a.entityTypeName+"' has no foreign key matching '"+c+"'");var e=a.parentType;d.inverseNavigationProperty=r(e.navigationProperties,function(a){return a.invForeignKeyNames&&a.invForeignKeyNames.indexOf(d.name)>=0&&a.entityType===d.parentType}),t(b.foreignKeyProperties,d)}),c(a)},d}(),Jb=function(){var a=new mb("AutoGeneratedKeyType");return a.None=a.addSymbol(),a.Identity=a.addSymbol(),a.KeyGenerator=a.addSymbol(),a.resolveSymbols(),a}();!function(){function a(a,b){return null==b?!1:void 0!==b.entityType}function b(a,b){return null==b?!1:b.isDataProperty||b.isNavigationProperty}var c=ib.prototype;c.isEntity=function(){return this._addContext({fn:a,msg:" must be an entity"})},c.isEntityProperty=function(){return this._addContext({fn:b,msg:" must be either a DataProperty or a NavigationProperty"})}}(),db.MetadataStore=Db,db.EntityType=Fb,db.ComplexType=Gb,db.DataProperty=Hb,db.NavigationProperty=Ib,db.AutoGeneratedKeyType=Jb,Db.normalizeTypeName=Eb.normalizeTypeName;var Kb=function(){function a(a,b,c){var d=b.name+".."+b.parentType.name,e=a._tempIdMap[d];return e||c&&(e={entityType:b.parentType,propertyName:b.name,keyMap:{}},a._tempIdMap[d]=e),e}var b=function(){this._tempIdMap={}},c=b.prototype;return c.generateTempKeyValue=function(b,c){var d=b.keyProperties;if(d.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");var e,f=d[0],g=a(this,f,!0);if(null!=c&&(g.keyMap[c.toString()]||(e=c)),void 0===e){var h=f.dataType;if(!h.getNext)throw new Error("Cannot use a property with a dataType of: "+h.toString()+" for id generation");for(e=h.getNext(this);null!=g.keyMap[e.toString()];)e=h.getNext(this)}return g.keyMap[e.toString()]=!0,e},c.getTempKeys=function(){var a=[];for(var b in this._tempIdMap){var c=this._tempIdMap[b],d=c.entityType;for(var e in c.keyMap)a.push(new xb(d,[e]))}return a},c.isTempKey=function(b){var c=b.entityType.keyProperties;if(c.length>1)return!1;var d=c[0],e=a(this,d);return e?void 0!==e.keyMap[b.values[0].toString()]:!1},ob.registerType(b,"KeyGenerator"),b}();db.KeyGenerator=Kb;var Lb=function(){var a=function(a){lb(a||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this),this.name||(this.name=D()),ob._storeObject(this,b._$typeName,this.name)},b=a.prototype;return b._$typeName="LocalQueryComparisonOptions",a.caseInsensitiveSQL=new a({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),a.defaultInstance=new a(a.caseInsensitiveSQL),b.setAsDefault=function(){return l(this,a)},a}();db.LocalQueryComparisonOptions=Lb;var Mb=function(){var a=function(a){lb(a||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this),this.name||(this.name=D()),ob._storeObject(this,b._$typeName,this.name)},b=a.prototype;return b._$typeName="NamingConvention",a.none=new a({name:"noChange",serverPropertyNameToClient:function(a){return a},clientPropertyNameToServer:function(a){return a}}),a.camelCase=new a({name:"camelCase",serverPropertyNameToClient:function(a){return a.substr(0,1).toLowerCase()+a.substr(1)},clientPropertyNameToServer:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)}}),a.defaultInstance=new a(a.none),b.setAsDefault=function(){return l(this,a)},a}();db.NamingConvention=Mb;var Nb=function(){function a(a,d){var e=d.entityType;if(Array.isArray(a)){if(!d.isRHS)throw new Error("Array expressions are only permitted on the right hand side of a BinaryPredicate");return new m(a,d.dataType)}if(!L(a)){if(null!=a&&M(a)&&!I(a)){if(void 0===a.value)throw new Error("Unable to resolve an expression for: "+a+" on entityType: "+e.name);return a.isProperty?new n(a.value):new m(a.value,a.dataType||d.dataType,!0)}return new m(a,d.dataType)}if(d.isRHS)return null==e||e.isAnonymous?new m(a,d.dataType):c(a,d);for(var f,g=/\([^()]*\)/,h=[],i=0;f=g.exec(a);){var j=f[0];h.push(j);var k=s+i++;a=a.replace(j,k)}var l=b(a,h,d);return l._validate(e,d.usesNameOnServer),l}function b(a,b,e){var f=a.split(s);return 1===f.length?c(f[0],e):d(a,f,b,e)}function c(a,b){a=a.trim();var c=a.substr(0,1),d=("'"===c||'"'===c)&&a.length>1&&a.substr(a.length-1)===c;if(d){var e=a.substr(1,a.length-2);return new m(e,b.dataType||zb.String)}var f=b.entityType;if(null==f||f.isAnonymous)return new n(a);var g=p.test(a);return g&&null!=f.getPropertiesOnPath(a,b.usesNameOnServer,!1)?new n(a):new m(a,b.dataType)}function d(a,c,d,e){try{var f=c[0].trim().toLowerCase(),g=d[c[1]].trim();"("===g.substr(0,1)&&(g=g.substr(1,g.length-2));var h=a.indexOf("'")>=0?q:r,i=g.match(h),k=j({},e);k.dataType=zb.Undefined,k.isFnArg=!0;var l=i.map(function(a){return b(a,d,k)});return new o(f,l)}catch(m){return null}}var e=function(){function a(a,b,c){var d=b.toLowerCase();c.key=d,a[d]=c,c.aliases&&c.aliases.forEach(function(b){a[b.toLowerCase()]=c})}function b(a){var d={},e={};d[a[0]]=e;var f=a[1];return f=f.operator||f,e[f]=3==a.length?a[2]:b(a.splice(2)),c(d)}function c(a){if(a instanceof e)return a;if("object"!=typeof a)throw new Error("Unable to convert to a Predicate: "+a);var b=Object.keys(a),c=b.map(function(b){return d(b,a[b])});return 1===c.length?c[0]:new i("and",c)}function d(a,b){if(i.prototype._resolveOp(a,!0))return new i(a,b);if(g.prototype._resolveOp(a,!0))return new g(a,b);if("object"!=typeof b||null==b||I(b))return new h("eq",a,b);if(eb(b,"value"))return new h("eq",a,b);if(Array.isArray(b))throw new Error("Unable to resolve predicate after the phrase: "+a);var c=a,d=Object.keys(b),e=d.map(function(a){if(k.prototype._resolveOp(a,!0))return new k(a,c,b[a]);if(h.prototype._resolveOp(a,!0))return new h(a,c,b[a]);if(eb(b[a],"value"))return new h("eq",c,b[a]);var d=T("Unable to resolve predicate after the phrase: '%1' for operator: '%2'  and value: '%3'",c,a,b[a]);throw new Error(d)});return 1===e.length?e[0]:new i("and",e)}var j=function(){if(0!==arguments.length){if(1===arguments.length){var a=arguments[0];return Array.isArray(a)?1===a.length?e(a[0]):b(a):a instanceof e?a:"string"==typeof a?new f(a):c(a)}return b(Array.prototype.slice.call(arguments,0))}},l=j.prototype;return j.create=j,j.and=function(){var a=new i("and",fb(arguments));return a.op&&a},j.or=function(){var a=new i("or",fb(arguments));return a.op&&a},j.not=function(a){return a.not()},j.extendBinaryPredicateFn=function(b,c){var d=t.binaryPredicate;for(var e in b||{}){var f=b[e];f.visitorFn=c,a(h.prototype.aliasMap,e,b[e])}t.isExtended||(t.binaryPredicate=function(a,b,c){var e=this.aliasMap[this.op.key].visitorFn;return e?e(a,b,c):d(a,b,c)},t.isExtended=!0)},l.and=function(){var a=e(fb(arguments));return new i("and",[this,a])},l.or=function(){var a=e(fb(arguments));return new i("or",[this,a])},l.not=function(){return new g("not",this)},l.toJSON=function(){return this.toJSONExt({entityType:this._entityType})},l.toJSONExt=function(a){return this.visit(a,u)},l.toFunction=function(a){return this.visit(a,t)},l.toString=function(){return JSON.stringify(this)},l.visit=function(a,b){if(P(a))a={entityType:null};else if(a instanceof Fb)a={entityType:a};else if(!eb(a,"entityType"))throw new Error("All visitor methods must be called with a context object containing at least an 'entityType' property");b?a.visitor=b:b=a.visitor;var c=b[this.visitorMethodName];if(null==c)throw new Error("Unable to locate method: "+this.visitorMethodName+" on visitor");var d=a.entityType;(this._validate&&null==d||this._entityType!==d)&&(this._validate(d,a.usesNameOnServer),this._entityType=d);Array.prototype.slice.call(arguments,1);return c.call(this,a)},l._initialize=function(b,c){this.visitorMethodName=b;var d=this.aliasMap={};for(var e in c||{})a(d,e,c[e])},l._resolveOp=function(a,b){a=a.operator||a;var c=this.aliasMap[a.toLowerCase()];if(!c&&!b)throw new Error("Unable to resolve operator: "+a);return c},j}(),f=function(){var a=function(a){this.value=a},b=a.prototype=new e;return b._initialize("passthruPredicate"),b._validate=F,a}(),g=function(){var a=function(a,b){this.op=this._resolveOp(a),this.pred=e(b)},b=a.prototype=new e;return b._initialize("unaryPredicate",{not:{aliases:["!","~"]}}),b._validate=function(a,b){this.pred._validate(a,b)},a}(),h=function(){var b=function(a,b,c){this.op=this._resolveOp(a),this.expr1Source=b,this.expr2Source=c},c=b.prototype=new e;return c._initialize("binaryPredicate",{eq:{aliases:["=="]},ne:{aliases:["!=","~="]},lt:{aliases:["<"]},le:{aliases:["<="]},gt:{aliases:[">"]},ge:{aliases:[">="]},startswith:{isFunction:!0},endswith:{isFunction:!0},contains:{aliases:["substringof"],isFunction:!0},"in":{}}),c._validate=function(b,c){var d={entityType:b,usesNameOnServer:c};if(this.expr1=a(this.expr1Source,d),null==this.expr1)throw new Error("Unable to validate 1st expression: "+this.expr1Source);if(this.expr1 instanceof m)throw new Error("The left hand side of a binary predicate cannot be a literal expression, it must be a valid property or functional predicate expression: "+this.expr1Source);if("in"==this.op.key&&!Array.isArray(this.expr2Source))throw new Error("The 'in' operator requires that its right hand argument be an array");var e=j(d,{isRHS:!0,dataType:this.expr1.dataType});if(this.expr2=a(this.expr2Source,e),null==this.expr2)throw new Error("Unable to validate 2nd expression: "+this.expr2Source);null==this.expr1.dataType&&(this.expr1.dataType=this.expr2.dataType)},b}(),i=function(){var a=function(a,b){return this.op=this._resolveOp(a),1==b.length&&Array.isArray(b[0])&&(b=b[0]),this.preds=b.filter(function(a){return null!=a}).map(function(a){return e(a)}),0==this.preds.length&&(this.op=null),1==this.preds.length?this.preds[0]:void 0},b=a.prototype=new e;return b._initialize("andOrPredicate",{and:{aliases:["&&"]},or:{aliases:["||"]}}),b._validate=function(a,b){this.preds.every(function(c){c._validate(a,b)})},a}(),k=function(){var b=function(a,b,c){this.op=this._resolveOp(a),this.exprSource=b,this.pred=e(c)},c=b.prototype=new e;return c._initialize("anyAllPredicate",{any:{aliases:["some"]},all:{aliases:["every"]}}),c._validate=function(b,c){this.expr=a(this.exprSource,{entityType:b,usesNameOnServer:c}),(null==b||b.isAnonymous)&&(this.expr.dataType=null),this.pred._validate(this.expr.dataType,c)},b}(),l=function(a){this.visitorMethodName=a,this.visit=e.prototype.visit,this._validate=F},m=function(){function a(a){if(null==a)return a;if(zb.contains(a))return a;if(L(a)){var b=zb.fromName(a);if(b)return b;throw new Error("Unable to resolve a dataType named: "+a)}throw new Error("The dataType parameter passed into this literal expression is not a 'DataType'"+a)}var b=function(b,c,d){c=a(c),c=c||zb.fromValue(b),this.value=c&&c.parse?Array.isArray(b)?b.map(function(a){return c.parse(a,typeof a)}):c.parse(b,typeof b):b,this.dataType=c,this.hasExplicitDataType=d},c=b.prototype=new l("litExpr");return c.toString=function(){return" LitExpr - value: "+this.value.toString()+" dataType: "+this.dataType.toString()},b}(),n=function(){var a=function(a){this.propertyPath=a},b=a.prototype=new l("propExpr");return b.toString=function(){return" PropExpr - "+this.propertyPath},b._validate=function(a,b){if(null!=a&&!a.isAnonymous){var c=a.getPropertiesOnPath(this.propertyPath,b,!1);if(!c){var d=T("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",a.name,this.propertyPath);throw new Error(d)}var e=c[c.length-1];this.dataType=e.isDataProperty?e.dataType:e.entityType}},a}(),o=function(){var a=function(a,b){this.fnName=a,this.exprs=b;var d=c[a];if(null==d)throw new Error("Unknown function: "+a);this.localFn=d.fn,this.dataType=d.dataType},b=a.prototype=new l("fnExpr");b.toString=function(){var a=this.exprs.map(function(a){a.toString()}).toString();return"FnExpr - "+this.fnName+"("+a+")"},b._validate=function(a,b){this.exprs.forEach(function(c){c._validate(a,b)})};var c=a.funcMap={toupper:{fn:function(a){return a.toUpperCase()},dataType:zb.String},tolower:{fn:function(a){return a.toLowerCase()},dataType:zb.String},substring:{fn:function(a,b,c){return a.substring(b,c)},dataType:zb.String},substringof:{fn:function(a,b){return b.indexOf(a)>=0},dataType:zb.Boolean},length:{fn:function(a){return a.length},dataType:zb.Int32},trim:{fn:function(a){return a.trim()},dataType:zb.String},concat:{fn:function(a,b){return a.concat(b)},dataType:zb.String},replace:{fn:function(a,b,c){return a.replace(b,c)},dataType:zb.String},startswith:{fn:function(a,b){return R(a,b)},dataType:zb.Boolean},endswith:{fn:function(a,b){return S(a,b)},dataType:zb.Boolean},indexof:{fn:function(a,b){return a.indexOf(b)},dataType:zb.Int32},round:{fn:function(a){return Math.round(a)},dataType:zb.Int32},ceiling:{fn:function(a){return Math.ceil(a)},dataType:zb.Int32},floor:{fn:function(a){return Math.floor(a)},dataType:zb.Int32},second:{fn:function(a){return a.getSeconds()},dataType:zb.Int32},minute:{fn:function(a){return a.getMinutes()},dataType:zb.Int32},day:{fn:function(a){return a.getDate()},dataType:zb.Int32},month:{fn:function(a){return a.getMonth()+1},dataType:zb.Int32},year:{fn:function(a){return a.getFullYear()},dataType:zb.Int32}};return a}(),p=/^[a-z_][\w.$]*$/i,q=/('[^']*'|[^,]+)/g,r=/("[^"]*"|[^,]+)/g,s=String.fromCharCode(191),t=function(){function a(a){switch(a.key){case"any":return function(a,b){return a.some(function(a){return b(a)})};case"all":return function(a,b){return a.every(function(a){return b(a)})};default:throw new Error("Unknown operator: "+a.key)}}function b(a,b,g){var h,i=a.op,j=zb.getComparableFn(b);switch(i.key){case"eq":h=function(a,b){return a&&"string"==typeof a?c(a,b,g):j(a)==j(b)};break;case"ne":h=function(a,b){return a&&"string"==typeof a?!c(a,b,g):j(a)!=j(b)};break;case"gt":h=function(a,b){return j(a)>j(b)};break;case"ge":h=function(a,b){return j(a)>=j(b)};break;case"lt":h=function(a,b){return j(a)<j(b)};break;case"le":h=function(a,b){return j(a)<=j(b)};break;case"startswith":h=function(a,b){return d(a,b,g)};break;case"endswith":h=function(a,b){return e(a,b,g)};break;case"contains":h=function(a,b){return f(a,b,g)};break;case"in":h=function(a,b){return a=j(a),b=b.map(function(a){return j(a)}),b.indexOf(a)>=0};break;default:return null}return h}function c(a,b,c){return null==b?!1:("string"!=typeof b&&(b=b.toString()),c.usesSql92CompliantStringComparison&&(a=(a||"").trim(),b=(b||"").trim()),c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),a===b)}function d(a,b,c){return c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),R(a,b)}function e(a,b,c){return c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),S(a,b)}function f(a,b,c){return c.isCaseSensitive||(a=(a||"").toLowerCase(),b=(b||"").toLowerCase()),a.indexOf(b)>=0}var g={passthruPredicate:function(){throw new Error("Cannot execute an PassthruPredicate expression against the local cache: "+this.value)},unaryPredicate:function(a){var b=this.pred.visit(a);switch(this.op.key){case"not":return function(a){return!b(a)};default:throw new Error("Invalid unary operator:"+this.op.key)}},binaryPredicate:function(a){var c=this.expr1.visit(a),d=this.expr2.visit(a),e=this.expr1.dataType||this.expr2.dataType,f=a.entityType.metadataStore.localQueryComparisonOptions,g=b(this,e,f);if(null==g)throw new Error("Invalid binaryPredicate operator:"+this.op.key);return function(a){return g(c(a),d(a))}},andOrPredicate:function(a){var b=this.preds.map(function(b){return b.visit(a)});switch(this.op.key){case"and":return function(a){var c=b.reduce(function(b,c){return b&&c(a)},!0);return c};case"or":return function(a){var c=b.reduce(function(b,c){return b||c(a)},!1);return c};default:throw new Error("Invalid boolean operator:"+op.key)}},anyAllPredicate:function(b){var c=this.expr.visit(b),d=j({},b);d.entityType=this.expr.dataType;var e=this.pred.visit(d),f=a(this.op);return function(a){return f(c(a),e)}},litExpr:function(){var a=this.value;return function(){return a}},propExpr:function(){var a=this.propertyPath,b=a.split(".");return 1===b.length?function(b){return b.getProperty(a)}:function(a){return cb(a,b)}},fnExpr:function(a){var b=this.exprs.map(function(b){return b.visit(a)}),c=this;return function(a){var d=b.map(function(b){var c=b(a);return c}),e=c.localFn.apply(null,d);return e}}};return g}(),u=function(){function a(b,c){var d=Object.keys(c).every(function(d){if(b.hasOwnProperty(d)){if("object"!=typeof c[d])return!1;if(null==a(b[d],c[d]))return!1}else b[d]=c[d];return!0});return d?b:null}var b={passthruPredicate:function(){return this.value},unaryPredicate:function(a){var b=this.pred.visit(a),c={};return c[this.op.key]=b,c},binaryPredicate:function(a){var b=this.expr1.visit(a),c=this.expr2.visit(a),d={};if(this.expr2 instanceof n&&(c={value:c,isProperty:!0}),"eq"===this.op.key)d[b]=c;else{var e={};d[b]=e,e[this.op.key]=c}return d},andOrPredicate:function(b){var c,d=this.preds.map(function(a){return a.visit(b)});return"and"!==this.op.key||2!==d.length||d.some(L)||(c=d.reduce(a)),null==c&&(c={},c[this.op.key]=d),c},anyAllPredicate:function(a){var b=this.expr.visit(a),c=j({},a);c.entityType=this.expr.dataType;var d=this.pred.visit(c),e={},f={};return f[this.op.key]=d,e[b]=f,e},litExpr:function(a){return this.hasExplicitDataType||a.useExplicitDataType?{value:this.value,dataType:this.dataType.name}:this.value},propExpr:function(a){return a.toNameOnServer?a.entityType.clientPropertyPathToServer(this.propertyPath):this.propertyPath},fnExpr:function(a){var b=this.exprs.map(function(b){return b.visit(a)});return this.fnName+"("+b.join(",")+")"}};return b}();return e}();db.Predicate=Nb;var Ob=function(){function a(a,b){return m(b,{"resourceName,from":null,"resultEntityType,toType":null,"wherePredicate,where":function(a){return a?new Nb(a):void 0},"orderByClause,orderBy":function(a){return a?new Qb(a):void 0},"selectClause,select":function(a){return a?new Rb(a):void 0},"expandClause,expand":function(a){return a?new Sb(a):void 0},"skipCount,skip":null,"takeCount,take":null,parameters:function(a){return P(a)?void 0:a},"inlineCountEnabled,inlineCount":!1,"noTrackingEnabled,noTracking":!1,queryOptions:function(a){return a?Vb.fromJSON(a):void 0}},a),a}function c(a,b,c){if(b&&a[b]===c)return a;var d=j(new Ob,a,["resourceName","fromEntityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","usesNameOnServer","queryOptions","entityManager","dataService","resultEntityType"]);return d.parameters=j({},a.parameters),b&&(d[b]=c),d}function d(a,c,e,f){var g=e._$typeName||e.parentEnum&&e.parentEnum.name,h=g&&g.substr(0,1).toLowerCase()+g.substr(1);if(f&&h!=f)throw new Error("Invalid value for property: "+f);if(h){var i=c[h];if(void 0===i)throw new Error("Invalid config property: "+h);null===i?a[h]=e:i(a,e)}else b(e,function(b,e){d(a,c,e,b)})}function e(a){return jb(a,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof a&&(a=a.split(",")),a=a.map(function(a){return a.trim()})}function f(a){var b=a.entityType,c=b.keyProperties.map(function(b){return Nb.create(b.name,Pb.Equals,a.getProperty(b.name))}),d=Nb.and(c);return d}function g(a){var b=a.entityType.keyProperties,c=v(b,a.values,function(a,b){return Nb.create(a.name,Pb.Equals,b)}),d=Nb.and(c);return d}function h(a,b){if(b.isScalar){if(0===b.foreignKeyNames.length)return null;var c=b.foreignKeyNames.map(function(b){return a.getProperty(b)}),d=new xb(b.entityType,c);return g(d)}var e=b.inverse,f=e?e.foreignKeyNames:b.invForeignKeyNames;if(0===f.length)return null;var h=a.entityAspect.getKey().values,i=v(f,h,function(a,b){return Nb.create(a,Pb.Equals,b)});return Nb.and(i)}var i=function(b){return null==b||L(b)?(this.resourceName=b,this.fromEntityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.noTrackingEnabled=!1,void(this.entityManager=null)):a(this,b)},k=i.prototype;return k._$typeName="EntityQuery",k.from=function(a){return jb(a,"resourceName").isString().check(),c(this,"resourceName",a)},i.from=function(a){return jb(a,"resourceName").isString().check(),new Ob(a)},k.toType=function(a){return jb(a,"entityType").isString().or().isInstanceOf(Fb).check(),c(this,"resultEntityType",a)},k.where=function(a){return null!=a&&(a=Nb.create(fb(arguments)),this.fromEntityType&&a._validate(this.fromEntityType),this.wherePredicate&&(a=this.wherePredicate.and(a))),c(this,"wherePredicate",a)},k.orderBy=function(a,b){var d=null==a?null:new Qb(e(a),b);return this.orderByClause&&d&&(d=new Qb([this.orderByClause,d])),c(this,"orderByClause",d)},k.orderByDesc=function(a){return this.orderBy(a,!0)},k.select=function(a){var b=null==a?null:new Rb(e(a));return c(this,"selectClause",b)},k.skip=function(a){return jb(a,"count").isOptional().isNumber().check(),c(this,"skipCount",null==a?null:a)},k.top=function(a){return this.take(a)},k.take=function(a){return jb(a,"count").isOptional().isNumber().check(),c(this,"takeCount",null==a?null:a)},k.expand=function(a){var b=null==a?null:new Sb(e(a));return c(this,"expandClause",b)},k.withParameters=function(a){return jb(a,"parameters").isObject().check(),c(this,"parameters",a)},k.inlineCount=function(a){return jb(a,"enabled").isBoolean().isOptional().check(),a=void 0===a?!0:!!a,c(this,"inlineCountEnabled",a)},k.useNameOnServer=function(a){return jb(a,"usesNameOnServer").isBoolean().isOptional().check(),a=void 0===a?!0:!!a,c(this,"usesNameOnServer",a)},k.noTracking=function(a){return jb(a,"enabled").isBoolean().isOptional().check(),a=void 0===a?!0:!!a,c(this,"noTrackingEnabled",a)},k.using=function(a){if(!a)return this;var b=c(this);return d(b,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(a,b){a.queryOptions=(a.queryOptions||new Vb).using(b)},mergeStrategy:function(a,b){a.queryOptions=(a.queryOptions||new Vb).using(b)},jsonResultsAdapter:function(a,b){a.dataService=(a.dataService||new Ab).using({jsonResultsAdapter:b})}},a),b},k.execute=function(a,b){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,a,b)},k.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},k.toJSON=function(){return this.toJSONExt()},k.toJSONExt=function(a){a=a||{},a.entityType=a.entityType||this.fromEntityType,a.propertyPathFn=a.toNameOnServer?a.entityType.clientPropertyPathToServer.bind(a.entityType):G;var b=function(b){return b?b.toJSONExt(a):void 0};return m(this,{"from,resourceName":null,"toType,resultEntityType":function(a){return a?L(a)?a:a.name:void 0},"where,wherePredicate":b,"orderBy,orderByClause":b,"select,selectClause":b,"expand,expandClause":b,"skip,skipCount":null,"take,takeCount":null,parameters:function(a){return P(a)?void 0:a},"inlineCount,inlineCountEnabled":!1,"noTracking,noTrackingEnabled":!1,queryOptions:null})},i.fromEntities=function(a){jb(a,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(a)||(a=fb(arguments));var b=a[0],c=new Ob(b.entityType.defaultResourceName),d=a.map(function(a){return f(a)}),e=Nb.or(d);c=c.where(e);var g=b.entityAspect.entityManager;return g&&(c=c.using(g)),c},i.fromEntityKey=function(a){jb(a,"entityKey").isInstanceOf(xb).check();var b=new Ob(a.entityType.defaultResourceName),c=g(a);return b=b.where(c).toType(a.entityType)},i.fromEntityNavigation=function(a,b){jb(a,"entity").isEntity().check();var c=a.entityType._checkNavProperty(b),d=new Ob(c.entityType.defaultResourceName),e=h(a,c);d=d.where(e);var f=a.entityAspect.entityManager;return f?d.using(f):d},k._getFromEntityType=function(a,b){var c=this.fromEntityType;if(c)return c;var d=this.resourceName;if(!d)throw new Error("There is no resourceName for this query");if(a.isEmpty()){if(b)throw new Error("There is no metadata available for this query. Are you querying the local cache before you've fetched metadata?");return null}var e=a.getEntityTypeNameForResourceName(d);if(c=e?a._getEntityType(e):this._getToEntityType(a,!0),!c){if(b)throw new Error(T("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",d));return null}return this.fromEntityType=c,c},k._getToEntityType=function(a,b){return this.resultEntityType instanceof Fb?this.resultEntityType:this.resultEntityType?(this.resultEntityType=a._getEntityType(this.resultEntityType,!1),this.resultEntityType):b?null:!this.selectClause&&this._getFromEntityType(a,!1)},k._toUri=function(a){var b=Ab.resolve([a.dataService]);return b.uriBuilder.buildUri(this,a.metadataStore)},i}(),Pb=function(){var a=new mb("FilterQueryOp");return a.Equals=a.addSymbol({operator:"eq"}),a.NotEquals=a.addSymbol({operator:"ne"}),a.GreaterThan=a.addSymbol({operator:"gt"}),a.LessThan=a.addSymbol({operator:"lt"}),a.GreaterThanOrEqual=a.addSymbol({operator:"ge"}),a.LessThanOrEqual=a.addSymbol({operator:"le"}),a.Contains=a.addSymbol({operator:"contains"}),a.StartsWith=a.addSymbol({operator:"startswith"}),a.EndsWith=a.addSymbol({operator:"endswith"}),a.Any=a.addSymbol({operator:"any"}),a.All=a.addSymbol({operator:"all"}),a.IsTypeOf=a.addSymbol({operator:"isof"}),a.resolveSymbols(),a._map=function(){var b={};return a.getSymbols().forEach(function(a){b[a.name.toLowerCase()]=a,b[a.operator.toLowerCase()]=a,a.aliases&&a.aliases.forEach(function(c){b[c.toLowerCase()]=a})}),b}(),a.from=function(b){return a.contains(b)?b:a._map[b.toLowerCase()]},a}(),Qb=(function(){var a=new mb("BooleanQueryOp");return a.And=a.addSymbol({operator:"and"}),a.Or=a.addSymbol({operator:"or"}),a.Not=a.addSymbol({operator:"not"}),a.resolveSymbols(),a._map=function(){var b={};return a.getSymbols().forEach(function(a){b[a.name.toLowerCase()]=a,b[a.operator.toLowerCase()]=a,a.aliases&&a.aliases.forEach(function(c){b[c.toLowerCase()]=a})}),b}(),a.from=function(b){return a.contains(b)?b:a._map[b.toLowerCase()]},a}(),function(){var a=function(a,b){if(a.length>1){if(a[0]instanceof Qb)return void(this.items=Array.prototype.concat.apply(a[0].items,a.slice(1).map(h("items"))));var d=a.map(function(a){return new c(a,b)})}else var d=[new c(a[0],b)];this.items=d},b=a.prototype;b.validate=function(a){null==a||a.isAnonymous||this.items.forEach(function(b){b.validate(a)})},b.getComparer=function(a){var b=this.items.map(function(b){return b.getComparer(a)});return function(a,c){for(var d=0;d<b.length;d++){var e=b[d](a,c);if(0!==e)return e}return 0}},b.toJSONExt=function(a){return this.items.map(function(b){return a.propertyPathFn(b.propertyPath)+(b.isDesc?" desc":"")})};var c=function(a,b){if("string"!=typeof a)throw new Error("propertyPath is not a string");a=a.trim();var c=a.split(" ");if(c.length>1&&b!==!0&&b!==!1&&(b=R(c[1].toLowerCase(),"desc"),!b)){var d=R(c[1].toLowerCase(),"asc");if(!d)throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}this.propertyPath=c[0],this.isDesc=b},d=c.prototype;return d.validate=function(a){null==a||a.isAnonymous||(this.lastProperty=a.getProperty(this.propertyPath,!0))},d.getComparer=function(a){if(this.lastProperty||this.validate(a),this.lastProperty)var b=this.lastProperty.dataType,c=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive;
var d=this.propertyPath,e=this.isDesc;return function(a,f){var g=cb(a,d),h=cb(f,d),i=b||g&&zb.fromValue(g)||zb.fromValue(h);if(i===zb.String)c?(g=g||"",h=h||""):(g=(g||"").toLowerCase(),h=(h||"").toLowerCase());else{var j=zb.getComparableFn(i);g=j(g),h=j(h)}return g===h?0:g>h||void 0===h?e?-1:1:e?1:-1}},a}()),Rb=function(){var a=function(a){this.propertyPaths=a,this._pathNames=a.map(function(a){return a.replace(".","_")})},b=a.prototype;return b.validate=function(a){null==a||a.isAnonymous||this.propertyPaths.forEach(function(b){a.getProperty(b,!0)})},b.toFunction=function(){var a=this;return function(b){var c={};return a.propertyPaths.forEach(function(d,e){c[a._pathNames[e]]=cb(b,d)}),c}},b.toJSONExt=function(a){return this.propertyPaths.map(function(b){return a.propertyPathFn(b)})},a}(),Sb=function(){var a=function(a){this.propertyPaths=a},b=a.prototype;return b.toJSONExt=function(a){return this.propertyPaths.map(function(b){return a.propertyPathFn(b)})},a}();db.FilterQueryOp=Pb,db.EntityQuery=Ob,db.OrderByClause=Qb;var Tb=function(){var a=new mb("MergeStrategy");return a.PreserveChanges=a.addSymbol(),a.OverwriteChanges=a.addSymbol(),a.SkipMerge=a.addSymbol(),a.Disallowed=a.addSymbol(),a.resolveSymbols(),a}(),Ub=function(){var a=new mb("FetchStrategy");return a.FromServer=a.addSymbol(),a.FromLocalCache=a.addSymbol(),a.resolveSymbols(),a}(),Vb=function(){function a(a,b){return b&&lb(b).whereParam("fetchStrategy").isEnumOf(Ub).isOptional().whereParam("mergeStrategy").isEnumOf(Tb).isOptional().whereParam("includeDeleted").isBoolean().isOptional().applyAll(a),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="QueryOptions",b.resolve=function(a){return new Vb(o(a,["fetchStrategy","mergeStrategy","includeDeleted"]))},b.defaultInstance=new b({fetchStrategy:Ub.FromServer,mergeStrategy:Tb.PreserveChanges,includeDeleted:!1}),c.using=function(b){if(!b)return this;var c=new Vb(this);return Tb.contains(b)?b={mergeStrategy:b}:Ub.contains(b)&&(b={fetchStrategy:b}),a(c,b)},c.setAsDefault=function(){return l(this,b)},c.toJSON=function(){return m(this,{fetchStrategy:null,mergeStrategy:null,includeDeleted:!1})},b.fromJSON=function(a){return new Vb({fetchStrategy:Ub.fromName(a.fetchStrategy),mergeStrategy:Tb.fromName(a.mergeStrategy),includeDeleted:a.includeDeleted===!0})},b}();db.QueryOptions=Vb,db.FetchStrategy=Ub,db.MergeStrategy=Tb;var Wb=function(){function a(a){if(a){if(1===a.length){var b=a[0];return function(a){return a?a.entityAspect.entityState===b:!1}}return function(b){return b?a.some(function(a){return b.entityAspect.entityState===a}):!1}}return function(a){return!!a}}var b=a([yb.Added,yb.Modified,yb.Deleted]),c=function(a,b){this.entityManager=a,this.entityType=b,this.entityType.isFrozen=!0,this._indexMap={},this._entities=[],this._emptyIndexes=[]},d=c.prototype;return d.attachEntity=function(a,b,c){var d=a.entityAspect;d._initialized||this.entityType._initializeInstance(a),delete d._initialized;var e=d.getKey()._keyInGroup,f=this._indexMap[e];if(f>=0){var g=this._entities[f],h=g.entityAspect.entityState,i=h.isUnchanged();if(g===a)d.entityState=b;else{if(c===Tb.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+d.getKey());if(c===Tb.OverwriteChanges||c===Tb.PreserveChanges&&i){var j=this.entityManager.helper.unwrapInstance(a);this.entityType._updateTargetFromRaw(g,j,Hb.getRawValueFromServer),g.entityAspect.setEntityState(b)}}return g}return 0===this._emptyIndexes.length?f=this._entities.push(a)-1:(f=this._emptyIndexes.pop(),this._entities[f]=a),this._indexMap[e]=f,d.entityState=b,d.entityGroup=this,d.entityManager=this.entityManager,a},d.detachEntity=function(a){var b=a.entityAspect,c=b.getKey()._keyInGroup,d=this._indexMap[c];if(void 0===d)throw new Error("internal error - entity cannot be found in group");return delete this._indexMap[c],this._emptyIndexes.push(d),this._entities[d]=null,a},d.findEntityByKey=function(a){var b;b=a instanceof xb?a._keyInGroup:xb.createKeyString(a);var c=this._indexMap[b];return void 0!==c?this._entities[c]:null},d.hasChanges=function(){return this._entities.some(b)},d.getEntities=function(b){var c=a(b);return this._entities.filter(c)},d._checkOperation=function(a){return this._entities.forEach(function(b){b&&b.entityAspect._checkOperation(a)}),this},d._clear=function(){this._entities.forEach(function(a){null!=a&&a.entityAspect._detach()}),this._entities=null,this._indexMap=null,this._emptyIndexes=null},d._updateFkVal=function(a,b,c){var d=a.name;this._entities.forEach(function(a){null!=a&&a.getProperty(d)==b&&a.setProperty(d,c)})},d._fixupKey=function(a,b){var c=this._indexMap[a];if(void 0===c)throw new Error("Internal Error in key fixup - unable to locate entity");var d=this._entities[c],e=d.entityType.keyProperties[0].name;d.setProperty(e,b),delete d.entityAspect.hasTempKey,delete this._indexMap[a],this._indexMap[b]=c},d._replaceKey=function(a,b){var c=this._indexMap[a._keyInGroup];delete this._indexMap[a._keyInGroup],this._indexMap[b._keyInGroup]=c},c}(),Xb=function(){function a(a,b,c){var d=c?Vb.defaultInstance:a.queryOptions,e=c?Zb.defaultInstance:a.saveOptions,f=c?tb.defaultInstance:a.validationOptions,g=lb(b).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(Ab).whereParam("queryOptions").isInstanceOf(Vb).isOptional().withDefault(d).whereParam("saveOptions").isInstanceOf(Zb).isOptional().withDefault(e).whereParam("validationOptions").isInstanceOf(tb).isOptional().withDefault(f).whereParam("keyGeneratorCtor").isFunction().isOptional();c&&(g=g.whereParam("metadataStore").isInstanceOf(Db).isOptional().withDefault(new Db)),g.applyAll(a),k(a.queryOptions,d),k(a.saveOptions,e),k(a.validationOptions,f),b.serviceName&&(a.dataService=new Ab({serviceName:a.serviceName})),a.serviceName=a.dataService&&a.dataService.serviceName,a.keyGeneratorCtor=a.keyGeneratorCtor||Kb,(c||b.keyGeneratorCtor)&&(a.keyGenerator=new a.keyGeneratorCtor)}function d(a){a.forEach(function(a){var c=[],d=a.entityAspect;b(d._validationErrors,function(a,b){b.isServerError&&c.push(a)}),0!==c.length&&d._processValidationOpAndPublish(function(){c.forEach(function(a){d._removeValidationError(a)})})})}function e(a){var c=[];return a.forEach(function(a){b(a.entityAspect._validationErrors,function(b,d){var e=j({entity:a,errorName:d.validator.name},d,["errorMessage","propertyName","isServerError"]);c.push(e)})}),c}function f(a,b){var c=b.entityErrors;if(c){var d=a.entityManager,e=d.metadataStore;b.entityErrors=c.map(function(a){var b=null;if(a.keyValues){var c=e._getEntityType(a.entityTypeName),f=new xb(c,a.keyValues);b=d.findEntityByKey(f)}if(b){var g=a.propertyName?{propertyName:a.propertyName,property:c.getProperty(a.propertyName)}:{},h=sb.getKey(a.errorName||a.errorMessage,a.propertyName),i=new sb(null,g,a.errorMessage,h);i.isServerError=!0,b.entityAspect.addValidationError(i)}var k=j({entity:b,isServerError:!0},a,["errorName","errorMessage","propertyName"]);return k})}}function g(a,b){var c,d=m(a,b),e=d.entityKey,f=0===d.remainingArgs.length?!1:!!d.remainingArgs[0],g=!1;return f&&(c=a.getEntityByKey(e),g=!!c,g&&!a.queryOptions.includeDeleted&&c.entityAspect.entityState.isDeleted()&&(c=null,g=a.queryOptions.mergeStrategy!==Tb.OverwriteChanges)),g?Cb.resolve({entity:c,entityKey:e,fromCache:!0}):Ob.fromEntityKey(e).using(a).execute().then(function(a){return c=0===a.results.length?null:a.results[0],Cb.resolve({entity:c,entityKey:e,fromCache:!1})})}function h(a,b){return jb(b,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(Fb).or().isNonEmptyArray().isInstanceOf(Fb).check(),"string"==typeof b?b=a.metadataStore._getEntityType(b,!1):Array.isArray(b)&&"string"==typeof b[0]&&(b=b.map(function(b){return a.metadataStore._getEntityType(b,!1)})),b}function l(a,b,c){var d,e=H(a,b);return e.forEach(function(a){if(a){var b=a.getEntities(c);d?d.push.apply(d,b):d=b}}),d||[]}function m(a,b){try{if(b[0]instanceof xb)return{entityKey:b[0],remainingArgs:fb(b,1)};if(b.length>=2){var c="string"==typeof b[0]?a.metadataStore._getEntityType(b[0],!1):b[0];return{entityKey:new xb(c,b[1]),remainingArgs:fb(b,2)}}}catch(d){}throw new Error("Must supply an EntityKey OR an EntityType name or EntityType followed by a key value or an array of key values.")}function o(a,b){a.forEach(function(a){a.entityAspect.isBeingSaved=b})}function s(a,c){var d;c?(d={},c.forEach(function(a){var b=d[a.entityType.name];b||(b={},b.entityType=a.entityType,b._entities=[],d[a.entityType.name]=b),b._entities.push(a)})):d=a._entityGroupMap;var e=[],f={};return b(d,function(a,b){f[a]=t(b,e)}),{entityGroupMap:f,tempKeys:e}}function t(a,b){var c={},d=a.entityType,e=d.dataProperties,f=Y(d),g=[];return a._entities.forEach(function(a){if(a){var c=w(a,e,f,b);g.push(c)}}),c.entities=g,c}function w(a,b,c,d){var e={};b.forEach(function(b){var d=b.name,f=a.getProperty(d);if(null!=f||null!=b.defaultValue){if(f&&b.isComplexProperty){var g=b.dataType.dataProperties;f=q(f,function(a){return w(a,g,c)})}else f=c?c(b,f):f,b.isUnmapped&&(f=n(f));void 0!==f&&(e[d]=f)}});var f,g;if(a.entityAspect){f=a.entityAspect;var h=f.entityState;g={tempNavPropNames:y(f,d),entityState:h.name},f.extraMetadata&&(g.extraMetadata=f.extraMetadata),(h.isModified()||h.isDeleted())&&(g.originalValuesMap=f.originalValues),e.entityAspect=g}else f=a.complexAspect,g={},f.originalValues&&!P(f.originalValues)&&(g.originalValuesMap=f.originalValues),e.complexAspect=g;return e}function y(a,b){var c=a.entity;a.hasTempKey&&b.push(a.getKey().toJSON());var d;return c.entityType.navigationProperties.forEach(function(a){if(a.relatedDataProperties){var b=c.getProperty(a.name);b&&b.entityAspect.hasTempKey&&(d=d||[],d.push(a.name))}}),d}function z(a,b,c){var d=c.tempKeyMap,e=a.entityType,f=c.mergeStrategy,g=null,h=a.entityManager,i=h.entityChanged,j=[],k=Hb.getRawValueFromClient;return b.entities.forEach(function(b){var c=b.entityAspect,l=e.getEntityKeyFromRawEntity(b,k),m=yb.fromName(c.entityState),n=m.isAdded()&&C(d,l);if(g=n?null:a.findEntityByKey(l))if(f===Tb.SkipMerge);else{if(f===Tb.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+l.toString()+" from being merged");var o=g.entityAspect.entityState,p=o.isUnchanged();(f===Tb.OverwriteChanges||p)&&(e._updateTargetFromRaw(g,b,k),g.entityAspect.setEntityState(m),i.publish({entityAction:ub.MergeOnImport,entity:g}))}else g=e._createInstanceCore(),e._updateTargetFromRaw(g,b,k),n&&(g.entityAspect.hasTempKey=!0,g.setProperty(e.keyProperties[0].name,n.values[0]),c.tempNavPropNames&&c.tempNavPropNames.forEach(function(a){var b=e.getNavigationProperty(a),c=b.relatedDataProperties[0].name,f=g.getProperty(c),h=new xb(b.entityType,[f]),i=C(d,h);g.setProperty(c,i.values[0])})),g=a.attachEntity(g,m),i.publish({entityAction:ub.AttachOnImport,entity:g}),m.isUnchanged()||h._notifyStateChange(g,!0);j.push(g)}),j}function C(a,b){var c=a[b.toString()];if(c)return c;var d=b._subtypes;if(!d)return null;for(var e=0,f=d.length;f>e;e++)if(c=a[b.toString(d[e])])return c;return null}function E(a,b,c){return a=a.then(function(a){return b&&b(a),Cb.resolve(a)},function(a){return c&&c(a),Cb.reject(a)})}function F(a,b){var c;return c=b?b.filter(function(b){if(b.entityAspect.entityManager!==a)throw new Error("Only entities in this entityManager may be saved");return!b.entityAspect.entityState.isDetached()}):a.getChanges()}function G(a,b){a._inKeyFixup=!0,b.forEach(function(b){var c=a._entityGroupMap[b.entityTypeName];if(!c)throw new Error("Unable to locate the following fully qualified EntityType name: "+b.entityTypeName);c._fixupKey(b.tempValue,b.realValue)}),a._inKeyFixup=!1}function H(a,b){var c=a._entityGroupMap;return b?p(b).map(function(a){if(a instanceof Fb)return c[a.name];throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}):i(c)}function I(a,b){var c=b.entityAspect.getKey(),d=v(b.entityType.keyProperties,c.values,function(a,b){return a.defaultValue===b?a:null}).filter(function(a){return null!==a});if(d.length)if(b.entityType.autoGeneratedKeyType!==Jb.None)a.generateTempKeyValue(b);else if(d.length===c.values.length)throw new Error("Cannot attach an object of type  ("+b.entityType.name+") to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}function J(a,b){return b?(b=p(b),b.forEach(function(a){if(!yb.contains(a))throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}),b):null}function K(a,b,c,d){var e=b.entityType.navigationProperties;e.forEach(function(e){var f=b.getProperty(e.name);if(e.isScalar){if(!f)return;a.attachEntity(f,c,d)}else f.forEach(function(b){a.attachEntity(b,c,d)})})}function L(a,b,d,e){try{var f,g=a.metadataStore;if(g.isEmpty()&&e.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(d.fetchStrategy===Ub.FromLocalCache)try{return f=a.executeQueryLocally(b),Cb.resolve({results:f,query:b})}catch(h){return Cb.reject(h)}var i=new Yb({query:b,entityManager:a,dataService:e,mergeOptions:{mergeStrategy:d.mergeStrategy,noTracking:!!b.noTrackingEnabled,includeDeleted:d.includeDeleted}}),j=a.validationOptions.validateOnQuery;return e.adapterInstance.executeQuery(i).then(function(d){var g=B(function(){var b={isLoading:a.isLoading};return a.isLoading=!0,a._pendingPubs=[],b},function(c){a.isLoading=c.isLoading,a._pendingPubs.forEach(function(a){a()}),a._pendingPubs=null,a._hasChangesAction&&a._hasChangesAction(),b=null,i=null,c.error&&Cb.reject(c.error)},function(){var g=e.jsonResultsAdapter.extractResults(d);g=p(g),f=i.visitAndMerge(g,{nodeType:"root"}),j&&f.forEach(function(a){a.entityAspect&&a.entityAspect.validateEntity()}),i.processDeferred(),M(f,b);var h=c(i.refMap);return{results:f,query:b,entityManager:a,httpResponse:d.httpResponse,inlineCount:d.inlineCount,retrievedEntities:h}});return Cb.resolve(g)},function(c){return c&&(c.query=b,c.entityManager=a),Cb.reject(c)})}catch(h){return h&&(h.query=b),Cb.reject(h)}}function M(a,b){if(!b.noTrackingEnabled){var c=b.expandClause;null!=c&&c.propertyPaths.forEach(function(b){var c=b.split(".");N(a,c)})}}function N(a,b){var c=b[0];a.forEach(function(a){var d=a.entityAspect;if(d&&(d._markAsLoaded(c),1!==b.length)){var e=a.getProperty(c);e&&(e.arrayChanged||(e=[e]),N(e,b.slice(1)))}})}function O(a){var b=a.filter(function(a){return a.entityAspect.isBeingSaved=!0,a.entityAspect.entityState.isModified()&&a.entityType.concurrencyProperties.length>0});0!==b.length&&b.forEach(function(a){a.entityType.concurrencyProperties.forEach(function(b){Q(a,b)})})}function Q(a,b){if(!a.entityAspect.originalValues[b.name]){var c=a.getProperty(b.name);if(c||(c=b.dataType.defaultValue),b.dataType.isNumeric)a.setProperty(b.name,c+1);else if(b.dataType.isDate){for(var d=new Date,e=new Date;d.getTime()===e.getTime();)e=new Date;a.setProperty(b.name,e)}else{if(b.dataType!==zb.Guid){if(b.dataType===zb.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+b.name)}a.setProperty(b.name,D())}}}function R(a,b){var c=a._entityGroupMap[b.name];return c||(c=new Wb(a,b),a._entityGroupMap[b.name]=c),c}function S(a,b){var c=b.getSelfAndSubtypes();return c.map(function(b){return R(a,b)})}function T(a,b){var c={},d=a.entityType||a.complexType,e=Y(d),f={};return d.dataProperties.forEach(function(d){if(d.isComplexProperty)c[d.nameOnServer]=q(a.getProperty(d.name),function(a){return T(a,b)});else{var g=a.getProperty(d.name);if(g=b?b(d,g):g,void 0===g)return;g=e?e(d,g):g,void 0!==g&&(d.isUnmapped?f[d.nameOnServer]=n(g):c[d.nameOnServer]=g)}}),P(f)||(c.__unmapped=f),c}function U(a,c,d){var e=a.entityType||a.complexType,f=a.entityAspect||a.complexAspect,g=c.namingConvention.clientPropertyNameToServer,h={};return b(f.originalValues,function(a,b){var c=e.getProperty(a);b=d?d(c,b):b,void 0!==b&&(h[g(a,c)]=b)}),e.complexProperties.forEach(function(b){var e=a.getProperty(b.name);if(b.isScalar){var f=U(e,c,d);P(f)||(h[g(b.name,b)]=f)}else{var i=e.map(function(a){return U(a,c,d)});h[g(b.name,b)]=i}}),h}function V(a,c,d){var e=a.entityType,f=Y(e),g=c.namingConvention.clientPropertyNameToServer,h={};return b(a.entityAspect.originalValues,function(b){var c=e.getProperty(b),i=a.getProperty(b);i=d?d(c,i):i,void 0!==i&&(i=f?f(c,i):i,void 0!==i&&(h[g(b,c)]=i))}),e.complexProperties.forEach(function(b){if(W(a,b)){var c=a.getProperty(b.name);h[g(b.name,b)]=q(c,function(a){return T(a,d)})}}),h}function W(a,b){var c=a.getProperty(b.name);return b.isScalar?X(c):c._origValues?!0:c.some(function(a){return X(a)})}function X(a){return P(a.complexAspect.originalValues)?a.complexType.complexProperties.some(function(b){return W(a,b)}):!0}function Y(a){return a.serializerFn||a.metadataStore&&a.metadataStore.serializerFn}function Z(){this.map={}}var $=function(b){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?b={serviceName:""}:"string"==typeof b&&(b={serviceName:b}),a(this,b,!0),this.entityChanged=new nb("entityChanged",this),this.validationErrorsChanged=new nb("validationErrorsChanged",this),this.hasChangesChanged=new nb("hasChangesChanged",this),this.clear()},_=$.prototype;return _._$typeName="EntityManager",nb.bubbleEvent(_,null),_.setProperties=function(b){a(this,b,!1)},_.createEntity=function(a,b,c,d){jb(a,"entityType").isString().or().isInstanceOf(Fb).check(),jb(c,"entityState").isEnumOf(yb).isOptional().check(),jb(d,"mergeStrategy").isEnumOf(Tb).isOptional().check(),"string"==typeof a&&(a=this.metadataStore._getEntityType(a)),c=c||yb.Added;var e;return A(this,"isLoading",!0,function(){e=a.createEntity(b)}),c!==yb.Detached&&(e=this.attachEntity(e,c,d)),e},$.importEntities=function(a,b){var c=new Xb;return c.importEntities(a,b),c},_.acceptChanges=function(){this.getChanges().map(function(a){return a.entityAspect._checkOperation("acceptChanges")}).forEach(function(a){a.acceptChanges()})},_.exportEntities=function(a,b){jb(b,"includeMetadata").isBoolean().isOptional().check(),b=null==b?!0:b;var c=s(this,a),d=j({},c,["tempKeys","entityGroupMap"]);b?(d=j(d,this,["dataService","saveOptions","queryOptions","validationOptions"]),d.metadataStore=this.metadataStore.exportMetadata()):(d.metadataVersion=db.metadataVersion,d.metadataStoreName=this.metadataStore.name);var e=JSON.stringify(d,null,ob.stringifyPad);return e},_.importEntities=function(a,c){c=c||{},lb(c).whereParam("mergeStrategy").isEnumOf(Tb).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().applyAll(c);var d=this,e="string"==typeof a?JSON.parse(a):a;e.metadataStore?(this.metadataStore.importMetadata(e.metadataStore),this.dataService=e.dataService&&Ab.fromJSON(e.dataService)||new Ab({serviceName:e.serviceName}),this.saveOptions=new Zb(e.saveOptions),this.queryOptions=Vb.fromJSON(e.queryOptions),this.validationOptions=new tb(e.validationOptions)):c.metadataVersionFn&&c.metadataVersionFn({metadataVersion:e.metadataVersion,metadataStoreName:e.metadataStoreName});var f={};e.tempKeys.forEach(function(a){var b=xb.fromJSON(a,d.metadataStore);f[b.toString()]=new xb(b.entityType,d.keyGenerator.generateTempKeyValue(b.entityType,b.values[0]))});var g=[];return c.tempKeyMap=f,B(function(){d._pendingPubs=[]},function(){d._pendingPubs.forEach(function(a){a()}),d._pendingPubs=null,d._hasChangesAction&&d._hasChangesAction()},function(){b(e.entityGroupMap,function(a,b){var e=d.metadataStore._getEntityType(a,!0),f=R(d,e),h=z(f,b,c);Array.prototype.push.apply(g,h)}),g.forEach(function(a){d._linkRelatedEntities(a)})}),{entities:g,tempKeyMapping:f}},_.clear=function(){c(this._entityGroupMap,function(a,b){return b._checkOperation()}).forEach(function(a){a._clear()}),this._entityGroupMap={},this._unattachedChildrenMap=new Z,this.keyGenerator=new this.keyGeneratorCtor,this.entityChanged.publish({entityAction:ub.Clear}),this._setHasChanges(!1)},_.createEmptyCopy=function(){var a=new $(j({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]));return a},_.addEntity=function(a){return this.attachEntity(a,yb.Added)},_.attachEntity=function(a,b,c){if(jb(a,"entity").isRequired().check(),this.metadataStore._checkEntityType(a),b=jb(b,"entityState").isEnumOf(yb).isOptional().check(yb.Unchanged),c=jb(c,"mergeStrategy").isEnumOf(Tb).isOptional().check(Tb.Disallowed),a.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType ("+a.entityType.name+") and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");var d=a.entityAspect;if(d){if(d._inProcessEntity)return d._inProcessEntity}else d=new vb(a);var e=d.entityManager;if(e){if(e===this)return a;throw new Error("This entity already belongs to another EntityManager")}var f,g=this;return A(this,"isLoading",!0,function(){b.isAdded()&&I(g,a),f=g._attachEntityCore(a,b,c),d._inProcessEntity=f;try{K(g,a,b,c)}finally{d._inProcessEntity=null}}),this.validationOptions.validateOnAttach&&f.entityAspect.validateEntity(),b.isUnchanged()||this._notifyStateChange(f,!0),this.entityChanged.publish({entityAction:ub.Attach,entity:f}),f},_.detachEntity=function(a){jb(a,"entity").isEntity().check();var b=a.entityAspect;if(!b)return!1;if(b.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return b.setDetached()},_.fetchMetadata=function(a,b,c){"function"==typeof a?(c=b,b=a,a=null):(jb(a,"dataService").isInstanceOf(Ab).isOptional().check(),jb(b,"callback").isFunction().isOptional().check(),jb(c,"errorCallback").isFunction().isOptional().check());var d=this.metadataStore.fetchMetadata(a||this.dataService);return E(d,b,c)},_.executeQuery=function(a,b,c){jb(a,"query").isInstanceOf(Ob).or().isString().check(),jb(b,"callback").isFunction().isOptional().check(),jb(c,"errorCallback").isFunction().isOptional().check();var d,e=Vb.resolve([a.queryOptions,this.queryOptions,Vb.defaultInstance]),f=Ab.resolve([a.dataService,this.dataService]);if(!f.hasServerMetadata||this.metadataStore.hasMetadataFor(f.serviceName))d=L(this,a,e,f);else{var g=this;d=this.fetchMetadata(f).then(function(){return L(g,a,e,f)})}return E(d,b,c)},_.executeQueryLocally=function(a){jb(a,"query").isInstanceOf(Ob).check();var b=this.metadataStore,c=a._getFromEntityType(b,!0),d=S(this,c),e=a.wherePredicate&&a.wherePredicate.toFunction({entityType:c}),f=Vb.resolve([a.queryOptions,this.queryOptions,Vb.defaultInstance]),g=f.includeDeleted===!0,h=function(a){return a&&(g||!a.entityAspect.entityState.isDeleted())&&(e?e(a):!0)},i=[];d.forEach(function(a){i.push.apply(i,a._entities.filter(h))});var j=a.orderByClause&&a.orderByClause.getComparer(c);j&&i.sort(j);var k=a.skipCount;k&&(i=i.slice(k));var l=a.takeCount;l&&(i=i.slice(0,l));var m=a.selectClause;if(m){var n=m.toFunction();i=i.map(n)}return i},_.saveChanges=function(a,b,c,g){function h(a){var b=s.entityManager;o(k,!1);a.entities=s.processSavedEntities(a);return b._setHasChanges(null),c&&c(a),Cb.resolve(a)}function i(a){var b=a.entities;if(0===b.length)return[];var c=a.keyMappings,d=s.entityManager;return G(d,c),A(d,"isLoading",!0,function(){var a=new Yb({query:null,entityManager:d,mergeOptions:{mergeStrategy:Tb.OverwriteChanges},dataService:r});b=a.visitAndMerge(b,{nodeType:"root"})}),b}function j(a){return o(k,!1),f(s,a),g&&g(a),Cb.reject(a)}jb(a,"entities").isOptional().isArray().isEntity().check(),jb(b,"saveOptions").isInstanceOf(Zb).isOptional().check(),jb(c,"callback").isFunction().isOptional().check(),jb(g,"errorCallback").isFunction().isOptional().check(),b=b||this.saveOptions||Zb.defaultInstance;var k=F(this,a);if(0===k.length){var l={entities:[],keyMappings:[]};return c&&c(l),Cb.resolve(l)}if(!b.allowConcurrentSaves){var m=k.some(function(a){return a.entityAspect.isBeingSaved});if(m){var n=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");return g&&g(n),Cb.reject(n)}}if(d(k),this.validationOptions.validateOnSave){var p=k.filter(function(a){var b=a.entityAspect,c=b.entityState.isDeleted()||b.validateEntity();return!c});if(p.length>0){var q=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail");return q.entityErrors=e(p),g&&g(q),Cb.reject(q)}}var r=Ab.resolve([b.dataService,this.dataService]),s={entityManager:this,dataService:r,processSavedEntities:i,resourceName:b.resourceName||this.saveOptions.resourceName||"SaveChanges"},t={entities:k,saveOptions:b};try{return O(k),r.adapterInstance.saveChanges(s,t).then(h).then(null,j)}catch(n){return o(k,!1),g&&g(n),Cb.reject(n)}},_._findEntityGroup=function(a){return this._entityGroupMap[a.name]},_.getEntityByKey=function(){var a=m(this,arguments).entityKey,b=a._subtypes||[a.entityType],c=null;return b.some(function(b){var d=this._findEntityGroup(b);return c=d&&d.findEntityByKey(a)},this),c},_.fetchEntityByKey=function(){var a=Ab.resolve([this.dataService]);if(!a.hasServerMetadata||this.metadataStore.hasMetadataFor(a.serviceName))return g(this,arguments);var b=this,c=arguments;return this.fetchMetadata(a).then(function(){return g(b,c)})},_.findEntityByKey=function(a){return this.getEntityByKey(a)},_.generateTempKeyValue=function(a){jb(a,"entity").isEntity().check();var b=a.entityType,c=this.keyGenerator.generateTempKeyValue(b),d=b.keyProperties[0];return a.setProperty(d.name,c),a.entityAspect.hasTempKey=!0,c},_.hasChanges=function(a){return this._hasChanges?void 0===a?this._hasChanges:this._hasChangesCore(a):!1},_._hasChangesCore=function(a){a=h(this,a);var b=H(this,a);return b.some(function(a){return a.hasChanges()})},_.getChanges=function(a){a=h(this,a);var b=[yb.Added,yb.Modified,yb.Deleted];return l(this,a,b)},_.rejectChanges=function(){if(!this._hasChanges)return[];var a=[yb.Added,yb.Modified,yb.Deleted],b=l(this,null,a),c=b.map(function(a){return a.entityAspect._checkOperation("rejectChanges")});return this._hasChanges=!1,c.forEach(function(a){a.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),b},_.getEntities=function(a,b){return a=h(this,a),jb(b,"entityStates").isOptional().isEnumOf(yb).or().isNonEmptyArray().isEnumOf(yb).check(),b=b&&J(this,b),l(this,a,b)},_._notifyStateChange=function(a,b){var c={entityAction:ub.EntityStateChange,entity:a};if(b)this._hasChanges||this._setHasChanges(!0);else if(this._hasChanges){if(this.isLoading)return void(this._hasChangesAction=this._hasChangesAction||function(){this._setHasChanges(null),this.entityChanged.publish(c)}.bind(this));this._setHasChanges(null)}this.entityChanged.publish(c)},_._setHasChanges=function(a){null==a&&(a=this._hasChangesCore());var b=this._hasChanges;this._hasChanges=a,a!=b&&this.hasChangesChanged.publish({entityManager:this,hasChanges:a}),this._hasChangesAction=null},_._linkRelatedEntities=function(a){var b=this,c=a.entityAspect;A(b,"isLoading",!0,function(){var d=b._unattachedChildrenMap,e=c.getKey(),f=d.getTuples(e);f&&f.slice(0).forEach(function(b){var c,f,g=b.children.filter(function(a){return a.entityAspect.entityState!==yb.Detached}),h=b.navigationProperty;if(h.inverse)if(c=h,f=h.inverse,f.isScalar){var i=g[0];a.setProperty(f.name,i),i.setProperty(c.name,a)}else{var j=a.getProperty(f.name);g.forEach(function(b){j.push(b),b.setProperty(c.name,a)})}else if(h.parentType===a.entityType)if(f=h,f.isScalar)a.setProperty(f.name,g[0]);else{var j=a.getProperty(f.name);g.forEach(function(a){j._push(a)})}else c=h,g.forEach(function(b){b.setProperty(c.name,a)});d.removeChildren(e,c)}),a.entityType.navigationProperties.forEach(function(e){if(e.isScalar){var f=a.getProperty(e.name);if(f)return}var g=c.getParentKey(e);if(g){if(g._isEmpty())return;var h=b.findEntityByKey(g);h?a.setProperty(e.name,h):d.addChild(g,e,a)}}),a.entityType.foreignKeyProperties.forEach(function(c){var e=c.inverseNavigationProperty;if(e){var f=a.getProperty(c.name),g=new xb(e.parentType,[f]),h=b.findEntityByKey(g);h?e.isScalar?h.setProperty(e.name,a):b.isLoading?h.getProperty(e.name)._push(a):h.getProperty(e.name).push(a):d.addChild(g,e,a)}})})},_._attachEntityCore=function(a,b,c){var d=R(this,a.entityType),e=d.attachEntity(a,b,c);return this._linkRelatedEntities(e),e},_._updateFkVal=function(a,b,c){var d=this._entityGroupMap[a.parentType.name];d&&d._updateFkVal(a,b,c)},_.helper={unwrapInstance:T,unwrapOriginalValues:U,unwrapChangedValues:V},Z.prototype.addChild=function(a,b,c){var d=this.getTuple(a,b);d||(d={navigationProperty:b,children:[]},x(this.map,a.toString()).push(d)),d.children.push(c)},Z.prototype.removeChildren=function(a,b){var c=this.getTuples(a);c&&(u(c,function(a){return a.navigationProperty===b}),c.length||delete this.map[a.toString()])},Z.prototype.getChildren=function(a,b){var c=this.getTuple(a,b);return c?c.children.filter(function(a){return!a.entityAspect.entityState.isDetached()}):null},Z.prototype.getTuple=function(a,b){var c=this.getTuples(a);if(!c)return null;var d=r(c,function(a){return a.navigationProperty===b});return d},Z.prototype.getTuples=function(a){for(var b=this.map[a.toString()],c=a.entityType;!b&&c.baseEntityType;){c=c.baseEntityType;var d=a.toString(c);b=this.map[d]}return b},$}();db.EntityManager=Xb;var Yb=function(){function a(a,b,e,g){if(e.ignore||null==b)return null;if(e.nodeRefId){var i=f(a,e.nodeRefId);return"function"==typeof i&&null!=g?void a.deferredFns.push(function(){g(i)}):i}if(e.entityType){var j=e.entityType;return a.mergeOptions.noTracking?(b=c(a,j,b),j.noTrackingFn&&(b=j.noTrackingFn(b,j)),e.nodeId&&(a.refMap[e.nodeId]=b),b):j.isComplexType?c(a,j,b):h(a,b,e)}return"object"!=typeof b||I(b)||(b=d(a,b)),e.nodeId&&(a.refMap[e.nodeId]=b),b}function c(a,b,d){var f={};return b.dataProperties.forEach(function(b){f[b.name]=b.isComplexProperty?q(d[b.nameOnServer],function(d){return c(a,b.dataType,d)}):u(d[b.nameOnServer],b.dataType)}),b.navigationProperties&&b.navigationProperties.forEach(function(b){var c={nodeType:"navProp",navigationProperty:b};e(d[b.nameOnServer],a,c,f,b.name)}),f}function d(a,c){var d=a.metadataStore.namingConvention.serverPropertyNameToClient,f={};return b(c,function(b,c){var g=d(b),h={nodeType:"anonProp",propertyName:g};e(c,a,h,f,g)}),f}function e(b,c,d,e,f){var g=c.jsonResultsAdapter,h=g.visitNode(b,c,d)||{};b=h.node||b,h.ignore||(Array.isArray(b)?(d.nodeType=d.nodeType+"Item",e[f]=b.map(function(b,i){return h=g.visitNode(b,c,d)||{},b=h.node||b,a(c,b,h,function(a){e[f][i]=a()})})):e[f]=a(c,b,h,function(a){e[f]=a()}))}function f(a,b){var c=a.refMap[b];return void 0===c?function(){return a.refMap[b]}:c}function g(a,b,c){var d=c._$meta.nodeId;null!=d&&(a.refMap[d]=b)}function h(a,b,c){b._$meta=c;var d=a.entityManager,e=c.entityType;"string"==typeof e&&(e=a.metadataStore._getEntityType(e,!1)),b.entityType=e;var f=a.mergeOptions.mergeStrategy,g=null==a.query,h=e.getEntityKeyFromRawEntity(b,a.rawValueFn),j=d.findEntityByKey(h);if(j){if(g&&j.entityAspect.entityState.isDeleted())return d.detachEntity(j),j;var l=j.entityAspect.entityState;if(f===Tb.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+h.toString()+" from being merged");if(f===Tb.SkipMerge)i(a,j,b);else if(f===Tb.OverwriteChanges||l.isUnchanged()){k(a,j,b),j.entityAspect.wasLoaded=!0,c.extraMetadata&&(j.entityAspect.extraMetadata=c.extraMetadata),j.entityAspect.entityState=yb.Unchanged,j.entityAspect.originalValues={},j.entityAspect.propertyChanged.publish({entity:j,propertyName:null});var m=g?ub.MergeOnSave:ub.MergeOnQuery;d.entityChanged.publish({entityAction:m,entity:j}),l.isUnchanged()||d._notifyStateChange(j,!1)}else{if(l==yb.Deleted&&!a.mergeOptions.includeDeleted)return null;i(a,j,b)}}else j=e._createInstanceCore(),k(a,j,b),c.extraMetadata&&(j.entityAspect.extraMetadata=c.extraMetadata),d._attachEntityCore(j,yb.Unchanged,f),j.entityAspect.wasLoaded=!0,d.entityChanged.publish({entityAction:ub.AttachOnQuery,entity:j});
return j}function i(a,b,c){g(a,b,c),c.entityType.navigationProperties.forEach(function(b){b.isScalar?n(a,c,b):o(a,c,b)})}function k(a,b,c){g(a,b,c);var d=b.entityType;d._updateTargetFromRaw(b,c,a.rawValueFn),d.navigationProperties.forEach(function(d){d.isScalar?l(a,d,b,c):m(a,d,b,c)})}function l(a,b,c,d){var e=n(a,d,b);null!=e&&("function"==typeof e?a.deferredFns.push(function(){e=e(),p(e,c,b)}):p(e,c,b))}function m(a,b,c,d){var e=o(a,d,b);if(null!=e){var f=b.inverse;if(f){var g=c.getProperty(b.name);g.wasLoaded=!0,e.forEach(function(b){"function"==typeof b?a.deferredFns.push(function(){b=b(),r(b,g,c,f)}):r(b,g,c,f)})}}}function n(a,b,c){var d=b[c.nameOnServer];if(!d)return null;var e=a.visitAndMerge(d,{nodeType:"navProp",navigationProperty:c});return e}function o(a,b,c){var d=b[c.nameOnServer];if(!d)return null;if(!Array.isArray(d)&&(d=d.results,!d))return null;var e=a.visitAndMerge(d,{nodeType:"navPropItem",navigationProperty:c});return e}function p(a,b,c){if(a){var d=c.name,e=b.getProperty(d);if(e!==a){b.setProperty(d,a);var f=c.inverse;if(!f)return;if(f.isScalar)a.setProperty(f.name,b);else{var g=a.getProperty(f.name);g.push(b)}}}}function r(a,b,c,d){if(a){var e=a.getProperty(d.name);e!==c&&(b.push(a),a.setProperty(d.name,c))}}var s=function(a){j(this,a,["query","entityManager","dataService","mergeOptions"]),this.refMap={},this.deferredFns=[],this.jsonResultsAdapter=this.dataService.jsonResultsAdapter,this.metadataStore=this.entityManager.metadataStore,this.rawValueFn=Hb.getRawValueFromServer},t=s.prototype,u=zb.parseRawValue;return t._$typeName="MappingContext",t.getUrl=function(){var a=this.query;if(!a)throw new Error("query cannot be empty");var b;if("string"==typeof a)b=a;else{if(!(a instanceof Ob))throw new Error("unable to recognize query parameter as either a string or an EntityQuery");b=this.dataService.uriBuilder.buildUri(a,this.metadataStore)}return this.dataService.qualifyUrl(b)},t.visitAndMerge=function(b,c){var d=this.query,e=this.jsonResultsAdapter;c=c||{};var f=this;return q(b,function(b){if(null==d&&b.entityAspect)return b.entityAspect.entityState.isDeleted()?f.entityManager.detachEntity(b):b.entityAspect.acceptChanges(),b;var g=e.visitNode(b,f,c)||{};return b=g.node||b,d&&"root"===c.nodeType&&!g.entityType&&(g.entityType=d._getToEntityType&&d._getToEntityType(f.metadataStore)),a(f,b,g)},this.mergeOptions.includeDeleted)},t.processDeferred=function(){this.deferredFns.length>0&&this.deferredFns.forEach(function(a){a()})},s}(),Zb=function(){function a(a,b){return b&&lb(b).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(Ab).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(a),a}var b=function(b){a(this,b)},c=b.prototype;return c._$typeName="SaveOptions",c.setAsDefault=function(){return l(this,b)},c.using=function(b){return a(this,b)},b.defaultInstance=new b({allowConcurrentSaves:!1}),b}();db.SaveOptions=Zb,db.AbstractDataServiceAdapter=function(){function a(){this.getRequest=function(a){return a},this.done=function(){}}function b(a,b,d){var e=c(b);return f._catchNoConnectionError(e),d&&(e.message=d+"; "+e.message),a.reject(e)}function c(a){var b=new Error;b.httpResponse=a,b.status=a.status;var c=a.data;if(!c)return b.message=a.error&&a.error.toString(),b;if("string"==typeof c)try{c=JSON.parse(c)}catch(d){return b.message=c,b}var e,f,g=a.saveContext,h=c.Message||c.ExceptionMessage||c.EntityErrors||c.Errors,i=!!h;if(i){var h=c;do e=h.ExceptionMessage||h.Message,h=h.InnerException;while(h);f=c.Errors||c.EntityErrors,f=f&&f.map(function(a){return{errorName:a.ErrorName,entityTypeName:Db.normalizeTypeName(a.EntityTypeName),keyValues:a.KeyValues,propertyName:a.PropertyName,errorMessage:a.ErrorMessage}})}else e=c.message,f=c.errors||c.entityErrors;if(g&&f){var j=g.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;f.forEach(function(a){a.propertyName=a.propertyName&&j(a.propertyName)}),b.entityErrors=f}return b.message=e||"Server side errors encountered - see the entityErrors collection on this object for more detail",b}var d,e=function(){},f=e.prototype;return f.checkForRecomposition=function(a){"ajax"===a.interfaceName&&a.isDefault&&this.initialize()},f.initialize=function(){if(d=db.config.getAdapterInstance("ajax"),!d||!d.ajax)throw new Error("Unable to find ajax adapter for dataservice adapter '"+(this.name||"")+"'.")},f.fetchMetadata=function(a,c){var e=c.serviceName,f=c.qualifyUrl("Metadata"),g=Cb.defer();return d.ajax({type:"GET",url:f,dataType:"json",success:function(d){if(a.hasMetadataFor(e))return g.resolve("already fetched");var h=d.data;try{var i="string"==typeof h?JSON.parse(h):h;a.importMetadata(i)}catch(j){var k="Unable to either parse or import metadata: "+j.message;return b(g,d,"Metadata query failed for: "+f+". "+k)}return a.hasMetadataFor(e)||a.addDataService(c),g.resolve(i)},error:function(a){b(g,a,"Metadata query failed for: "+f)}}),g.promise},f.executeQuery=function(a){var c=Cb.defer(),e=a.getUrl(),f={type:"GET",url:e,params:a.query.parameters,dataType:"json",success:function(a){var d=a.data;try{var e,f=d&&(d.results||d.Results);e=f?{results:f,inlineCount:d.inlineCount||d.InlineCount,httpResponse:a}:{results:d,httpResponse:a},c.resolve(e)}catch(g){g instanceof Error?c.reject(g):b(c,a)}},error:function(a){b(c,a)}};return a.dataService.useJsonp&&(f.dataType="jsonp",f.crossDomain=!0),d.ajax(f),c.promise},f.saveChanges=function(a,c){var e=a.adapter=this,f=Cb.defer();c=e._prepareSaveBundle(a,c);var g=JSON.stringify(c),h=a.dataService.qualifyUrl(a.resourceName);return d.ajax({type:"POST",url:h,dataType:"json",contentType:"application/json",data:g,success:function(c){c.saveContext=a;var d=c.data;if(d.Errors||d.errors)b(f,c);else{var g=e._prepareSaveResult(a,d);g.httpResponse=c,f.resolve(g)}},error:function(c){c.saveContext=a,b(f,c)}}),f.promise},f._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle")},f.changeRequestInterceptor=a,f._createChangeRequestInterceptor=function(b,c){var d=b.adapter,e=K,f=d.changeRequestInterceptor,g=d.name+" DataServiceAdapter's ChangeRequestInterceptor",h=" is missing or not a function.";if(e(f)){var i=new f(b,c);if(!e(i.getRequest))throw new Error(g+".getRequest"+h);if(!e(i.done))throw new Error(g+".done"+h);return i}return new a(b,c)},f._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult")},f.jsonResultsAdapter=new Bb({name:"noop",visitNode:function(){return{}}}),f._catchNoConnectionError=function(a){0==a.status&&null==a.message&&(a.message="HTTP response status 0 and no message.  Likely did not or could not reach server. Is the server running?")},e}(),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],a)}(function(a){function b(a){var c,d,e,f="";for(var g in a){var h=a[g];if(h instanceof Array)for(var i=0;i<h.length;++i)c=h[i],e=g+"["+i+"]",d={},d[e]=c,f+=b(d)+"&";else if(h instanceof Date)f+=encodeURIComponent(g)+"="+encodeURIComponent(h.toISOString())+"&";else if(h instanceof Object)for(var j in h)c=h[j],e=g+"["+j+"]",d={},d[e]=c,f+=b(d)+"&";else null===h?f+=encodeURIComponent(g)+"=&":void 0!==h&&(f+=encodeURIComponent(g)+"="+encodeURIComponent(h)+"&")}return f.length?f.substr(0,f.length-1):f}var c=a.core,d=function(){this.name="angular",this.defaultSettings={},this.requestInterceptor=null,this.$http,this.$rootScope},e=d.prototype;e.initialize=function(){var a=c.requireLib("angular");if(a){var b,d,e=a.injector(["ng"]);e.invoke(["$http","$rootScope",function(a,c){b=a,d=c}]),this.$http=b,this.$rootScope=d}},e.setHttp=function(a){this.$http=a,this.$rootScope=null},e.ajax=function(a){function d(b,c,d,e,f){"null"===b&&(b=null);var g={config:a,data:b,getHeaders:d,status:c,statusText:f};a.success(g)}function e(b,c,d,e,f){0===c&&null==b&&(b="timeout");var g={config:a,data:b,getHeaders:d,status:c,statusText:f};a.error(g)}if(!this.$http)throw new Error("Unable to locate angular for ajax adapter");var f={method:a.type,url:a.url,dataType:a.dataType,contentType:a.contentType,crossDomain:a.crossDomain,headers:a.headers||{}};if(a.params){var g=f.url.indexOf("?")>=0?"&":"?";f.url=f.url+g+b(a.params)}if(a.data&&(f.data=a.data),!c.isEmpty(this.defaultSettings)){var h=c.extend({},this.defaultSettings);f=c.extend(h,f);var i=c.extend({},this.defaultSettings.headers);f.headers=c.extend(i,f.headers)}var j={adapter:this,config:f,zConfig:a,success:d,error:e};c.isFunction(this.requestInterceptor)&&(this.requestInterceptor(j),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),j.config&&(this.$http(j.config).success(j.success).error(j.error),this.$rootScope&&this.$rootScope.$digest())},a.config.registerAdapter("ajax",d)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],a)}(function(a){function b(a){return 0===a.status?function(a){return a&&a.length>0?"":{}}:function(b){return b&&b.length>0?a.getResponseHeader(b):a.getAllResponseHeaders()}}var c,d=a.core,e=function(){this.name="jQuery",this.defaultSettings={},this.requestInterceptor=null},f=e.prototype;f.initialize=function(){c=d.requireLib("jQuery")},f.ajax=function(a){function e(c,d,e){var f={config:a,data:c,getHeaders:b(e),status:e.status,statusText:d};a.success(f),e.onreadystatechange=null,e.abort=null}function f(c,d,e){var f={config:a,data:c.responseText,error:e,getHeaders:b(c),status:c.status,statusText:d};a.error(f),c.onreadystatechange=null,c.abort=null}if(!c)throw new Error("Unable to locate jQuery");var g={type:a.type,url:a.url,data:a.params||a.data,dataType:a.dataType,contentType:a.contentType,crossDomain:a.crossDomain,headers:a.headers||{}};if(!d.isEmpty(this.defaultSettings)){var h=d.extend({},this.defaultSettings);g=d.extend(h,g);var i=d.extend({},this.defaultSettings.headers);g.headers=d.extend(i,g.headers)}var j={adapter:this,config:g,zConfig:a,success:e,error:f};d.isFunction(this.requestInterceptor)&&(this.requestInterceptor(j),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),j.config&&(j.jqXHR=c.ajax(j.config).done(j.success).fail(j.error))},a.config.registerAdapter("ajax",e)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!db&&define(["breeze"],a)}(function(a){function b(a,b){return a.isUnmapped?void 0:(a.dataType===zb.DateTimeOffset?b=b&&new Date(b.getTime()-6e4*b.getTimezoneOffset()):a.dataType.quoteJsonOData&&(b=null!=b?b.toString():b),b)}function c(a,c){var e=a.adapter._createChangeRequestInterceptor(a,c),f=[],g=[],h=[],i=a.entityManager,j=i.helper,k=0,l=a.routePrefix;return c.entities.forEach(function(a,c){var m=a.entityAspect;k+=1;var n={headers:{"Content-ID":k,DataServiceVersion:"2.0"}};if(h[k]=a,m.entityState.isAdded())n.requestUri=l+a.entityType.defaultResourceName,n.method="POST",n.data=j.unwrapInstance(a,b),g[k]=m.getKey();else if(m.entityState.isModified())d(n,m,l),n.method="MERGE",n.data=j.unwrapChangedValues(a,i.metadataStore,b);else{if(!m.entityState.isDeleted())return;d(n,m,l),n.method="DELETE"}n=e.getRequest(n,a,c),f.push(n)}),a.contentKeys=h,a.tempKeys=g,e.done(f),{__batchRequests:[{__changeRequests:f}]}}function d(a,b,c){var d,f=b.extraMetadata;null==f?(d=e(b),b.extraMetadata={uriKey:d}):(d=f.uriKey,f.etag&&(a.headers["If-Match"]=f.etag)),a.requestUri=d.indexOf("//")>0?d:c+d}function e(a){var b=a.entity.entityType,c=b.defaultResourceName,d=b.keyProperties,e=c+"(";if(1===d.length)e=e+f(d[0],a)+")";else{var g="";d.forEach(function(b){e=e+g+b.nameOnServer+"="+f(b,a),g=","}),e+=")"}return e}function f(a,b){return a.dataType.fmtOData(b.getPropertyValue(a.name))}function g(a,b){var c=new Error,d=a&&a.response;if(!d)return c.message=a,c.statusText=a,c;if(c.message=d.statusText,c.statusText=d.statusText,c.status=d.statusCode,b&&(c.url=b),c.body=d.body,d.body){var e;try{var f=JSON.parse(d.body);c.body=f,f["odata.error"]&&(f=f["odata.error"]);var g="";do e=f.error||f.innererror,e||(g+=h(f)),e=e||f.internalexception,f=e||f;while(e);g.length>0&&(c.message=g)}catch(i){}}return o._catchNoConnectionError(c),c}function h(a){var b=a.message||"";return("string"==typeof b?b:b.value)+"; "}var i,j=a.core,k=a.MetadataStore,l=a.JsonResultsAdapter,m=a.DataProperty,n=function(){this.name="OData"},o=n.prototype;o.initialize=function(){i=j.requireLib("OData","Needed to support remote OData services"),i.jsonHandler.recognizeDates=!0};var p=a.AbstractDataServiceAdapter.prototype;o._catchNoConnectionError=p._catchNoConnectionError,o.changeRequestInterceptor=p.changeRequestInterceptor,o._createChangeRequestInterceptor=p._createChangeRequestInterceptor,o.headers={DataServiceVersion:"2.0"},o.executeQuery=function(a){var b=Cb.defer(),c=a.getUrl();return i.read({requestUri:c,headers:this.headers},function(a,c){var d;return a.__count&&(d=parseInt(a.__count,10)),b.resolve({results:a.results,inlineCount:d,httpResponse:c})},function(a){return b.reject(g(a,c))}),b.promise},o.fetchMetadata=function(a,b){var c=Cb.defer(),d=b.serviceName,e=b.qualifyUrl("$metadata");return i.read({requestUri:e,headers:{Accept:"application/json;odata.metadata=full"}},function(f){if(!f||!f.dataServices){var g=new Error("Metadata query failed for: "+e);return c.reject(g)}var h=f.dataServices;if(!a.hasMetadataFor(d)){try{a.importMetadata(h)}catch(i){return c.reject(new Error("Metadata query failed for "+e+"; Unable to process returned metadata: "+i.message))}a.addDataService(b)}return c.resolve(h)},function(a){var b=g(a,e);return b.message="Metadata query failed for: "+e+"; "+(b.message||""),c.reject(b)},i.metadataHandler),c.promise},o.getRoutePrefix=function(){return""},o.saveChanges=function(a,b){var d=a.adapter=this,e=Cb.defer();a.routePrefix=d.getRoutePrefix(a.dataService);var f=a.dataService.qualifyUrl("$batch"),h=c(a,b),j=a.tempKeys,k=a.contentKeys;return i.request({headers:{DataServiceVersion:"2.0"},requestUri:f,method:"POST",data:h},function(a){var b=[],c=[],d={entities:b,keyMappings:c};return a.__batchResponses.forEach(function(a){a.__changeResponses.forEach(function(a){var d=a.response||a,h=d.statusCode;if(!h||h>=400)return void e.reject(g(a,f));var i=a.headers["Content-ID"],l=a.data;if(l){var n=j[i];if(n){var o=n.entityType;if(o.autoGeneratedKeyType!==Jb.None){var p=n.values[0],q=o.getEntityKeyFromRawEntity(l,m.getRawValueFromServer),r={entityTypeName:o.name,tempValue:p,realValue:q.values[0]};c.push(r)}}b.push(l)}else{var s=k[i];b.push(s)}})}),e.resolve(d)},function(a){return e.reject(g(a,f))},i.batchHandler),e.promise},o.jsonResultsAdapter=new l({name:"OData_default",visitNode:function(a,b,c){var d={};if(null==a)return d;var e=a.__metadata;if(null!=e){var f=k.normalizeTypeName(e.type),g=f&&b.entityManager.metadataStore.getEntityType(f,!0);if(g&&g._mappedPropertiesCount<=Object.keys(a).length-1){d.entityType=g;var h=e.uri||e.id;if(h){var i=new RegExp("^"+b.dataService.serviceName,"i");h=h.replace(i,"")}d.extraMetadata={uriKey:h,etag:e.etag}}}a.results&&(d.node=a.results);var l=c.propertyName;return d.ignore=null!=a.__deferred||"__metadata"===l||"EntityKey"===l&&a.$type&&j.stringStartsWith(a.$type,"System.Data"),d}}),a.config.registerAdapter("dataService",n);var q=function(){this.name="webApiOData"};a.core.extend(q.prototype,o),q.prototype.getRoutePrefix=function(a){if("object"==typeof document){var b=document.createElement("a");b.href=a.serviceName}else b=url.parse(a.serviceName);var c=b.pathname;return"/"===c[0]&&(c=c.substr(1)),"/"!==c.substr(-1)&&(c+="/"),c},a.config.registerAdapter("dataService",q);var r=function(){this.name="webApiOData4"};a.core.extend(r.prototype,q.prototype),r.prototype.initialize=function(){var a=j.requireLib("datajs","Needed to support remote OData v4 services");i=a.V4.oData,i.json.jsonHandler.recognizeDates=!0},r.prototype.headers={"OData-Version":"4.0"},a.config.registerAdapter("dataService",r)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!db&&define(["breeze"],a)}(function(a){var b=a.MetadataStore,c=a.JsonResultsAdapter,d=a.AbstractDataServiceAdapter,e=function(){this.name="webApi"},f=e.prototype=new d;f._prepareSaveBundle=function(a,b){var c=this._createChangeRequestInterceptor(a,b),d=a.entityManager,e=d.metadataStore,f=d.helper;return b.entities=b.entities.map(function(a,b){var d=f.unwrapInstance(a),g=null;a.entityType.autoGeneratedKeyType!==Jb.None&&(g={propertyName:a.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:a.entityType.autoGeneratedKeyType.name});var h=f.unwrapOriginalValues(a,e);return d.entityAspect={entityTypeName:a.entityType.name,defaultResourceName:a.entityType.defaultResourceName,entityState:a.entityAspect.entityState.name,originalValuesMap:h,autoGeneratedKey:g},d=c.getRequest(d,a,b)}),b.saveOptions={tag:b.saveOptions.tag},c.done(b.entities),b},f._prepareSaveResult=function(a,c){if(c.entities)return c;var d=c.KeyMappings.map(function(a){var c=b.normalizeTypeName(a.EntityTypeName);return{entityTypeName:c,tempValue:a.TempValue,realValue:a.RealValue}});return{entities:c.Entities,keyMappings:d}},f.jsonResultsAdapter=new c({name:"webApi_default",visitNode:function(a,c,d){if(null==a)return{};var e=b.normalizeTypeName(a.$type),f=e&&c.entityManager.metadataStore._getEntityType(e,!0),g=d.propertyName,h=g&&"$"===g.substr(0,1);return{entityType:f,nodeId:a.$id,nodeRefId:a.$ref,ignore:h}}}),a.config.registerAdapter("dataService",e)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!db&&define(["breeze"],a)}(function(a){function b(a){var b=a.entityType||a.complexType,c=b._extra,e=c.alreadyWrappedProps||{};b.getProperties().forEach(function(b){var c=b.name;if(!e[c]){var g;g=c in a?f(a,b):d(a,b),null!=g&&Object.defineProperty(a,c,g),e[c]=!0}}),c.alreadyWrappedProps=e}function c(a){var b=g(a),c=Object.getPrototypeOf(a),e=c.entityType||c.complexType;return e.getProperties().forEach(function(b){var e=b.name;if(b.isUnmapped&&!j.getPropertyDescriptor(c,e)){var f=d(c,b);Object.defineProperty(c,e,f)}if(a.hasOwnProperty(e)){var g=a[e];delete a[e],a[e]=g}}),b}function d(a,b){var c=b.name,d=a._pendingBackingStores;d||(d=[],a._pendingBackingStores=d);var f={get:function(){var a=this._backingStore||g(this);return a[c]},set:function(a){var d=this._backingStore||h(this),f=e(d,c);this._$interceptor(b,a,f)},enumerable:!0,configurable:!0};return f.set.rawSet=function(a){var b=this._backingStore||h(this),d=e(b,c);d(a)},f}function e(a,b){return function(){return 0==arguments.length?a[b]:void(a[b]=arguments[0])}}function f(a,b){if(!a.hasOwnProperty(b.name)){var c=Object.getPrototypeOf(a);return f(c,b)}var d=Object.getOwnPropertyDescriptor(a,b.name);if(d.configurable&&!d.value&&d.set){var e=function(a){return function(){if(0==arguments.length)return d.get.bind(a)();var b=d.set,c=b.rawSet||b;c.bind(a)(arguments[0])}},g={get:function(){return d.get.bind(this)()},set:function(a){this._$interceptor(b,a,e(this))},enumerable:d.enumerable,configurable:!0};return g.set.rawSet=d.set,g}}function g(a){var b=Object.getPrototypeOf(a);i(b);var c=a._backingStore;return c||(c={},a._backingStore=c),c}function h(a){var b=Object.getPrototypeOf(a),c=b._pendingBackingStores,d=j.arrayFirst(c,function(b){return b.entity===a});if(d)return d.backingStore;var e={};return c.push({entity:a,backingStore:e}),e}function i(a){var b=a._pendingBackingStores;b&&(b.forEach(function(a){a.entity._backingStore=a.backingStore}),b.length=0)}var j=a.core,k=function(){this.name="backingStore"},l=k.prototype;l.initialize=function(){},l.getTrackablePropertyNames=function(a){var b=[];for(var c in a)if("entityType"!==c&&"_$typeName"!==c&&"_pendingSets"!==c&&"_backingStore"!==c){var d=a[c];j.isFunction(d)||b.push(c)}return b},l.initializeEntityPrototype=function(a){a.getProperty=function(a){return this[a]},a.setProperty=function(a,b){return this[a]=b,this},b(a)},l.startTracking=function(b){var d=c(b),e=b.entityType||b.complexType;e.getProperties().forEach(function(c){var e=c.name,f=b[e];if(c.isDataProperty)c.isComplexProperty?f=c.isScalar?c.dataType._createInstanceCore(b,c):a.makeComplexArray([],b,c):c.isScalar?void 0===f&&(f=c.defaultValue):f=a.makePrimitiveArray([],b,c);else{if(!c.isNavigationProperty)throw new Error("unknown property: "+e);if(void 0!==f)throw new Error("Cannot assign a navigation property in an entity ctor.: "+c.Name);f=c.isScalar?null:a.makeRelationArray([],b,c)}(c.isSettable||c.isNavigationProperty)&&(d[e]=f)})},a.config.registerAdapter("modelLibrary",k)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!db&&define(["breeze"],a)}(function(a){function b(){try{return Object.getPrototypeOf&&Object.defineProperty({},"x",{})}catch(a){return!1}}function c(a){var b=a.entityType||a.complexType,c={};if(b.getProperties().forEach(function(b){var e=d(a,b.name);e&&(c[b.name]=e)}),!P(c)){var e=b._extra;e.es5Descriptors=c,b._koDummy=h.observable(null)}}function d(a,c){if(!b())return null;if(a.hasOwnProperty(c))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(a,c);var e=Object.getPrototypeOf(a);return e?d(e,c):null}function e(b,c,d){if(c.isDataProperty)c.isComplexProperty?d=c.isScalar?c.dataType._createInstanceCore(b,c):a.makeComplexArray([],b,c):c.isScalar?void 0===d&&(d=c.defaultValue):d=a.makePrimitiveArray([],b,c);else{if(!c.isNavigationProperty)throw new Error("unknown property: "+c.name);if(void 0!==d)throw new Error("Cannot assign a navigation property in an entity ctor.: "+c.name);d=c.isScalar?null:a.makeRelationArray([],b,c)}return d}function f(a){a._koObj._suppressBreeze=!0}function g(a){var b=a.array._koObj;b._suppressBreeze?b._suppressBreeze=!1:b.valueHasMutated()}var h,i=a.core,j=function(){this.name="ko"},k=j.prototype;k.initialize=function(){h=i.requireLib("ko","The Knockout library"),h.extenders.intercept=function(a,b){var c,d=b.instance,e=b.property;return c=h.computed(a.splice?{read:a}:{read:a,write:function(b){return d._$interceptor(e,b,a),d}})}},k.getTrackablePropertyNames=function(a){var b=[];for(var c in a)if("entityType"!==c&&"_$typeName"!==c){var e=d(a,c);if(e&&e.get)b.push(c);else{var f=a[c];h.isObservable(f)?b.push(c):i.isFunction(f)||b.push(c)}}return b},k.initializeEntityPrototype=function(a){a.getProperty=function(a){return this[a]()},a.setProperty=function(a,b){return this[a](b),this},b()&&c(a)},k.startTracking=function(a){var b=a.entityType||a.complexType,c=b._extra.es5Descriptors||{};b.getProperties().sort(function(a,b){var c=a.isUnmapped?1:0,d=b.isUnmapped?1:0;return c-d}).forEach(function(d){var i,j=d.name,k=a[j],l=c[j];if(l){var m=l.get.bind(a);if(l.set){var n=l.set.bind(a),o=function(a){return 0===arguments.length?m():void n(a)};i=h.computed({read:function(){return b._koDummy(),m()},write:function(c){return a._$interceptor(d,c,o),b._koDummy.valueHasMutated(),a}})}else i=h.computed({read:m,write:function(){}})}else if(h.isObservable(k)){if(d.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+j);i=k}else k=e(a,d,k),i=d.isScalar?h.observable(k):h.observableArray(k);if(d.isScalar)if(l)Object.defineProperty(a,j,{enumerable:!0,configurable:!0,writable:!0,value:i});else{var p=i.extend({intercept:{instance:a,property:d}});a[j]=p}else k._koObj=i,i.subscribe(f,null,"beforeChange"),k.arrayChanged.subscribe(g),i.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.")},a[j]=i})},a.config.registerAdapter("modelLibrary",j)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!db&&define(["breeze"],a)}(function(a){var b=function(){this.name="json"},c=b.prototype;c.initialize=function(){},c.buildUri=function(a,b){var c=a._getFromEntityType(b,!1);c||(c=new Fb(b));var d=a.toJSONExt({entityType:c,toNameOnServer:!0});d.from=void 0,d.queryOptions=void 0;var e=JSON.stringify(d),f=encodeURIComponent(e);return a.resourceName+"?"+f},a.config.registerAdapter("uriBuilder",b)}),function(a){db?a(db):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("breeze")):"function"==typeof define&&define.amd&&!db&&define(["breeze"],a)}(function(a){var b=a.EntityType,c=function(){this.name="odata"},d=c.prototype;d.initialize=function(){},d.buildUri=function(a,c){function d(a){return a?a.visit({entityType:j},e):void 0}function f(a){if(a){a.validate(j);var b=a.items.map(function(a){return j.clientPropertyPathToServer(a.propertyPath,"/")+(a.isDesc?" desc":"")});return b.join(",")}}function g(a){if(a){a.validate(j);var b=a.propertyPaths.map(function(a){return j.clientPropertyPathToServer(a,"/")}).join(",");return b}}function h(a){if(a){var b=a.propertyPaths.map(function(a){return j.clientPropertyPathToServer(a,"/")}).join(",");return b}}function i(a){var b=[];for(var c in a){var d=a[c];void 0!==d&&(d instanceof Array?d.forEach(function(a){b.push(c+"="+encodeURIComponent(a))}):b.push(c+"="+encodeURIComponent(d)))}return b.length>0?"?"+b.join("&"):""}var j=a._getFromEntityType(c,!1);j||(j=new b(c));var k={};k.$filter=d(a.wherePredicate),k.$orderby=f(a.orderByClause),a.skipCount&&(k.$skip=a.skipCount),null!=a.takeCount&&(k.$top=a.takeCount),k.$expand=h(a.expandClause),k.$select=g(a.selectClause),a.inlineCountEnabled&&(k.$inlinecount="allpages");var l=i(k);return a.resourceName+l},a.Predicate.prototype.toODataFragment=function(a){return this.visit(a,e)};var e=function(){function b(a){var b=a.op.key,c=d[b];return c||b}var c={passthruPredicate:function(){return this.value},unaryPredicate:function(a){var c=this.pred.visit(a);return b(this)+" ("+c+")"},binaryPredicate:function(a){var c=this.expr1.visit(a),d=this.expr2.visit(a),e=a.prefix;e&&(c=e+"/"+c);var f=b(this);if("in"==this.op.key){var g=d.map(function(a){return"("+c+" eq "+a+")"}).join(" or ");return g}return this.op.isFunction?"substringof"==f?f+"("+d+","+c+") eq true":f+"("+c+","+d+") eq true":c+" "+f+" "+d},andOrPredicate:function(a){var c=this.preds.map(function(b){var c=b.visit(a);return"("+c+")"}).join(" "+b(this)+" ");return c},anyAllPredicate:function(c){var d=this.expr.visit(c),e=c.prefix;e?(d=e+"/"+d,e="x"+(parseInt(e.substring(1))+1)):e="x1";var f=a.core.extend({},c);f.entityType=this.expr.dataType,f.prefix=e;var g=this.pred.visit(f);return d+"/"+b(this)+"("+e+": "+g+")"},litExpr:function(){return Array.isArray(this.value)?this.value.map(function(a){return this.dataType.fmtOData(a)},this):this.dataType.fmtOData(this.value)},propExpr:function(a){var b=a.entityType;return b?b.clientPropertyPathToServer(this.propertyPath,"/"):this.propertyPath},fnExpr:function(a){var b=this.exprs.map(function(b){return b.visit(a)});return this.fnName+"("+b.join(",")+")"}},d={contains:"substringof"};return c}();a.config.registerAdapter("uriBuilder",c)}),db.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery",uriBuilder:"odata"});var $b=z("ko");return $b?db.config.initializeAdapterInstance("modelLibrary","ko"):db.config.initializeAdapterInstance("modelLibrary","backingStore"),db});